        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTrain.csv"

fileName <- "FluTrain.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the training data set")
FluTrain <- read.table("../data/FluTrain.csv", sep = ",", header = TRUE)
str(FluTrain)
summary(FluTrain)
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$ILI), ]
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$Queries), ]
'org_babel_R_eoe'
FluTrend1 <- lm(log(ILI) ~ Queries, data = FluTrain)
summary(FluTrend1)
'org_babel_R_eoe'
summary(FluTrend1)
'org_babel_R_eoe'
writeLines("\n :: Relationship between R^2 and Correlation")
Correlation <- cor(log(FluTrain$ILI), FluTrain$Queries)
Correlation^2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTest.csv"

fileName <- "FluTest.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the testing data set")
FluTest <- read.table("../data/FluTest.csv", sep = ",", header = TRUE)
str(FluTest)
summary(FluTest)
'org_babel_R_eoe'
PredTest1 = exp(predict(FluTrend1, newdata = FluTest))
summary(PredTest1)
'org_babel_R_eoe'
writeLines("\n :: estimate for the percentage of ILI-related physician\nvisits for the week of March 11, 2012:")

FluPredictTest <- cbind(FluTest, PredTest1)
names(FluPredictTest)
FluPredictTest[which(FluPredictTest$Week == "2012-03-11 - 2012-03-17"), 4]
'org_babel_R_eoe'
stmILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 4]
obsILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 2]

writeLines("\n :: Relative error for our observation:")
relError <- (obsILI - stmILI) / obsILI
relError
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set is:")
sqrt(mean((FluPredictTest$PredTest1 - FluPredictTest$ILI)^2))
'org_babel_R_eoe'
library(zoo)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTrain$ILI), -2, na.pad = TRUE)
FluTrain$ILILag2 <- coredata(ILILag2)
'org_babel_R_eoe'
summary(ILILag2)
'org_babel_R_eoe'
FluTrend2 <- lm(log(ILI) ~ Queries + log(ILILag2), data = FluTrain)
summary(FluTrend2)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTest$ILI), -2, na.pad = TRUE)
FluTest$ILILag2 <- coredata(ILILag2)
summary(FluTest$ILILag2)
'org_babel_R_eoe'
tail(FluTrain, 10)
head(FluTest, 10)
'org_babel_R_eoe'
writeLines("\n :: Old values for the FluTest$ILILag2 first two values:")
tail(FluTrain)
head(FluTest)

writeLines("\n :: New first two values for the FluTest$ILILag2:")
FluTest$ILILag2[1] <- FluTrain$ILI[416]
FluTest$ILILag2[2] <- FluTrain$ILI[417]
tail(FluTrain)
head(FluTest)
'org_babel_R_eoe'
PredTest2 <- exp(predict(FluTrend2, newdata = FluTest))
summary(PredTest2)
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set and the new model is:")
sqrt(mean((PredTest2 - FluTest$ILI)^2))
'org_babel_R_eoe'
q()
n
data(state)
statedata = cbind(data.frame(state.x77), state.abb, state.area,
                  state.center,  state.division, state.name,
                  state.region)
'org_babel_R_eoe'
data(state)
statedata <- cbind(data.frame(state.x77), state.abb, state.area,
                   state.center, state.division, state.name,
                   state.region)
writeLines("\n :: data set loaded...")
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <-
        c("https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/climate_change.csv")

fileName <- c("climate_change.csv")

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read in data")
climateChange <- read.table("../data/climate_change.csv", sep = ",", header = TRUE)
str(climateChange)
summary(climateChange)
'org_babel_R_eoe'
training <- subset(climateChange, Year <= 2006)

writeLines("\n :: Exploratory data analysis for the training dataframe")
str(training)
summary(training)
'org_babel_R_eoe'
test <- subset(climateChange, Year > 2006)
str(test)
summary(test)
'org_babel_R_eoe'
writeLines("\n :: Linear regression model for Climate Change")
tempReg <- lm(Temp ~ MEI + CO2 + CH4 + N2O + CFC.11 + CFC.12 + TSI +
                      Aerosols, data = training)
summary(tempReg)
'org_babel_R_eoe'
cor(training, use="complete.obs")
'org_babel_R_eoe'
writeLines("\n :: Linear regression model for Climate Change")
tempReg2 <- lm(Temp ~ MEI + TSI + Aerosols + N2O, data = training)
summary(tempReg2)
'org_babel_R_eoe'
writeLines("\n :: Optimizing the linear regression model for Climate Change")
tempReg3 <- step(tempReg)
summary(tempReg3)
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predictTest <- predict(tempReg3, newdata = test)
predictTest
'org_babel_R_eoe'
writeLines("\n :: Compute out-of-sample R^2")
SSE <- sum((predictTest - test$Temp)^2)
SST <- sum((mean(training$Temp) - test$Temp)^2)
R2 <- 1 - (SSE/SST)
R2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <-
        c("https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/pisa2009train.csv", "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/pisa2009test.csv")

fileName <- c("pisa2009train.csv", "pisa2009test.csv")

dataPath <- "../data"

for(i in 1:2) {
        filePath <- paste(dataPath, fileName[i], sep = "/")

        if(!file.exists(filePath)) {
                download.file(fileUrl[i], destfile = filePath, method = "curl")
        }
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the training data set")
pisaTrain <- read.table("../data/pisa2009train.csv", sep = ",", header = TRUE)
str(pisaTrain)
summary(pisaTrain)

writeLines("\n\n :: Read the test data set: DO NOT SEE THE DATA!")
pisaTest <- read.table("../data/pisa2009test.csv", sep = ",", header = TRUE)
'org_babel_R_eoe'
writeLines("\n :: Number of students in the training data set")
nrow(pisaTrain)
'org_babel_R_eoe'
tapply(pisaTrain$readingScore, pisaTrain$male, mean)
'org_babel_R_eoe'
writeLines("\n :: any NA in the features")
summary(pisaTrain)
'org_babel_R_eoe'
writeLines("\n :: Omiting the non complete observations")
pisaTrain <- na.omit(pisaTrain)
pisaTest <- na.omit(pisaTest)
'org_babel_R_eoe'
writeLines("\n :: Number of observations in the training set")
nrow(pisaTrain)
'org_babel_R_eoe'
writeLines("\n :: Number of observations in the testing set")
nrow(pisaTest)
'org_babel_R_eoe'
class(pisaTrain$grade)
class(pisaTrain$male)
class(pisaTrain$raceeth)
str(pisaTrain$raceeth)
'org_babel_R_eoe'
class(pisaTrain$raceeth)
str(pisaTrain$raceeth)
summary(pisaTrain$raceeth)
'org_babel_R_eoe'
writeLines("\n :: Exploring the raceeth feature:")
sort(table(pisaTrain$raceeth), decreasing = TRUE)
'org_babel_R_eoe'
writeLines("\n :: Setting the reference level of the factor to white")
pisaTrain$raceeth <- relevel(pisaTrain$raceeth, "White")
pisaTest$raceeth <- relevel(pisaTest$raceeth, "White")
'org_babel_R_eoe'
lmScore <- lm(readingScore ~ ., data = pisaTrain)
summary(lmScore)
'org_babel_R_eoe'
writeLines("\n :: Sum of Squared Errors")
SSE = sum(lmScore$residuals^2)
SSE

writeLines("\n :: The training-set root-mean squared error (RMSE):")
sqrt(SSE / nrow(pisaTrain))

writeLines("\n :: A alternative way of getting the RMSE value:")
sqrt(mean(lmScore$residuals^2))
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predictRScoreDF <- rbind(pisaTrain[1, ], pisaTrain[1, ])
predictRScoreDF[2, 1] <- 9
predictRScoreDF

predict01 <- predict(lmScore, newdata = predictRScoreDF)
predict01[1] - predict01[2]
'org_babel_R_eoe'
summary(lmScore)
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predTest <- predict(lmScore, newdata = pisaTest)
summary(predTest)
637.7 - 353.2
'org_babel_R_eoe'
writeLines("\n :: Sum of Squared Errors in the testing set")
SSE <- sum((predTest - pisaTest$readingScore)^2)
SSE
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set is:")
RMSE <- sqrt(SSE / nrow(pisaTest))
RMSE

writeLines("\n :: An alternative for calculation:")
sqrt(mean((predTest-pisaTest$readingScore)^2))
'org_babel_R_eoe'
SSE <- sum((predTest - pisaTest$readingScore)^2)

writeLines("\n :: The predicted test score used in the baseline model:")
mean(pisaTrain$readingScore)

SST <- sum((mean(pisaTrain$readingScore) - pisaTest$readingScore)^2)
R2 <- 1 - (SSE/SST)

writeLines("\n :: The SST for the training pisa data set")
SST
'org_babel_R_eoe'
writeLines("\n :: The test-set R-squared value:")
SSE <- sum((predTest - pisaTest$readingScore)^2)
SST <- sum((mean(pisaTrain$readingScore) - pisaTest$readingScore)^2)
R2 <- 1 - (SSE/SST)
R2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTrain.csv"

fileName <- "FluTrain.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the training data set")
FluTrain <- read.table("../data/FluTrain.csv", sep = ",", header = TRUE)
str(FluTrain)
summary(FluTrain)
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$ILI), ]
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$Queries), ]
'org_babel_R_eoe'
FluTrend1 <- lm(log(ILI) ~ Queries, data = FluTrain)
summary(FluTrend1)
'org_babel_R_eoe'
summary(FluTrend1)
'org_babel_R_eoe'
writeLines("\n :: Relationship between R^2 and Correlation")
Correlation <- cor(log(FluTrain$ILI), FluTrain$Queries)
Correlation^2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTest.csv"

fileName <- "FluTest.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the testing data set")
FluTest <- read.table("../data/FluTest.csv", sep = ",", header = TRUE)
str(FluTest)
summary(FluTest)
'org_babel_R_eoe'
PredTest1 = exp(predict(FluTrend1, newdata = FluTest))
summary(PredTest1)
'org_babel_R_eoe'
writeLines("\n :: estimate for the percentage of ILI-related physician\nvisits for the week of March 11, 2012:")

FluPredictTest <- cbind(FluTest, PredTest1)
names(FluPredictTest)
FluPredictTest[which(FluPredictTest$Week == "2012-03-11 - 2012-03-17"), 4]
'org_babel_R_eoe'
stmILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 4]
obsILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 2]

writeLines("\n :: Relative error for our observation:")
relError <- (obsILI - stmILI) / obsILI
relError
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set is:")
sqrt(mean((FluPredictTest$PredTest1 - FluPredictTest$ILI)^2))
'org_babel_R_eoe'
library(zoo)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTrain$ILI), -2, na.pad = TRUE)
FluTrain$ILILag2 <- coredata(ILILag2)
'org_babel_R_eoe'
summary(ILILag2)
'org_babel_R_eoe'
FluTrend2 <- lm(log(ILI) ~ Queries + log(ILILag2), data = FluTrain)
summary(FluTrend2)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTest$ILI), -2, na.pad = TRUE)
FluTest$ILILag2 <- coredata(ILILag2)
summary(FluTest$ILILag2)
'org_babel_R_eoe'
tail(FluTrain, 10)
head(FluTest, 10)
'org_babel_R_eoe'
writeLines("\n :: Old values for the FluTest$ILILag2 first two values:")
tail(FluTrain)
head(FluTest)

writeLines("\n :: New first two values for the FluTest$ILILag2:")
FluTest$ILILag2[1] <- FluTrain$ILI[416]
FluTest$ILILag2[2] <- FluTrain$ILI[417]
tail(FluTrain)
head(FluTest)
'org_babel_R_eoe'
PredTest2 <- exp(predict(FluTrend2, newdata = FluTest))
summary(PredTest2)
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set and the new model is:")
sqrt(mean((PredTest2 - FluTest$ILI)^2))
'org_babel_R_eoe'
data(state)
statedata <- cbind(data.frame(state.x77), state.abb, state.area,
                   state.center, state.division, state.name,
                   state.region)
writeLines("\n :: data set loaded...")
'org_babel_R_eoe'
str(statedata)
'org_babel_R_eoe'
?state
ls()
plot()
'org_babel_R_eoe'
plot(statedata$x, statedata$y)
'org_babel_R_eoe'
tapply(statedata$HS.Grad, statedata$state.region, mean)
'org_babel_R_eoe'
tapply(statedata$HS.Grad, statedata$state.region, mean)
which.max(tapply(statedata$HS.Grad, statedata$state.region, mean))
'org_babel_R_eoe'
q()
n
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <-
        c("https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/climate_change.csv")

fileName <- c("climate_change.csv")

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read in data")
climateChange <- read.table("../data/climate_change.csv", sep = ",", header = TRUE)
str(climateChange)
summary(climateChange)
'org_babel_R_eoe'
training <- subset(climateChange, Year <= 2006)

writeLines("\n :: Exploratory data analysis for the training dataframe")
str(training)
summary(training)
'org_babel_R_eoe'
test <- subset(climateChange, Year > 2006)
str(test)
summary(test)
'org_babel_R_eoe'
writeLines("\n :: Linear regression model for Climate Change")
tempReg <- lm(Temp ~ MEI + CO2 + CH4 + N2O + CFC.11 + CFC.12 + TSI +
                      Aerosols, data = training)
summary(tempReg)
'org_babel_R_eoe'
cor(training, use="complete.obs")
'org_babel_R_eoe'
writeLines("\n :: Linear regression model for Climate Change")
tempReg2 <- lm(Temp ~ MEI + TSI + Aerosols + N2O, data = training)
summary(tempReg2)
'org_babel_R_eoe'
writeLines("\n :: Optimizing the linear regression model for Climate Change")
tempReg3 <- step(tempReg)
summary(tempReg3)
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predictTest <- predict(tempReg3, newdata = test)
predictTest
'org_babel_R_eoe'
writeLines("\n :: Compute out-of-sample R^2")
SSE <- sum((predictTest - test$Temp)^2)
SST <- sum((mean(training$Temp) - test$Temp)^2)
R2 <- 1 - (SSE/SST)
R2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <-
        c("https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/pisa2009train.csv", "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/pisa2009test.csv")

fileName <- c("pisa2009train.csv", "pisa2009test.csv")

dataPath <- "../data"

for(i in 1:2) {
        filePath <- paste(dataPath, fileName[i], sep = "/")

        if(!file.exists(filePath)) {
                download.file(fileUrl[i], destfile = filePath, method = "curl")
        }
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the training data set")
pisaTrain <- read.table("../data/pisa2009train.csv", sep = ",", header = TRUE)
str(pisaTrain)
summary(pisaTrain)

writeLines("\n\n :: Read the test data set: DO NOT SEE THE DATA!")
pisaTest <- read.table("../data/pisa2009test.csv", sep = ",", header = TRUE)
'org_babel_R_eoe'
writeLines("\n :: Number of students in the training data set")
nrow(pisaTrain)
'org_babel_R_eoe'
tapply(pisaTrain$readingScore, pisaTrain$male, mean)
'org_babel_R_eoe'
writeLines("\n :: any NA in the features")
summary(pisaTrain)
'org_babel_R_eoe'
writeLines("\n :: Omiting the non complete observations")
pisaTrain <- na.omit(pisaTrain)
pisaTest <- na.omit(pisaTest)
'org_babel_R_eoe'
writeLines("\n :: Number of observations in the training set")
nrow(pisaTrain)
'org_babel_R_eoe'
writeLines("\n :: Number of observations in the testing set")
nrow(pisaTest)
'org_babel_R_eoe'
class(pisaTrain$grade)
class(pisaTrain$male)
class(pisaTrain$raceeth)
str(pisaTrain$raceeth)
'org_babel_R_eoe'
class(pisaTrain$raceeth)
str(pisaTrain$raceeth)
summary(pisaTrain$raceeth)
'org_babel_R_eoe'
writeLines("\n :: Exploring the raceeth feature:")
sort(table(pisaTrain$raceeth), decreasing = TRUE)
'org_babel_R_eoe'
writeLines("\n :: Setting the reference level of the factor to white")
pisaTrain$raceeth <- relevel(pisaTrain$raceeth, "White")
pisaTest$raceeth <- relevel(pisaTest$raceeth, "White")
'org_babel_R_eoe'
lmScore <- lm(readingScore ~ ., data = pisaTrain)
summary(lmScore)
'org_babel_R_eoe'
writeLines("\n :: Sum of Squared Errors")
SSE = sum(lmScore$residuals^2)
SSE

writeLines("\n :: The training-set root-mean squared error (RMSE):")
sqrt(SSE / nrow(pisaTrain))

writeLines("\n :: A alternative way of getting the RMSE value:")
sqrt(mean(lmScore$residuals^2))
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predictRScoreDF <- rbind(pisaTrain[1, ], pisaTrain[1, ])
predictRScoreDF[2, 1] <- 9
predictRScoreDF

predict01 <- predict(lmScore, newdata = predictRScoreDF)
predict01[1] - predict01[2]
'org_babel_R_eoe'
summary(lmScore)
'org_babel_R_eoe'
writeLines("\n :: Make test set predictions")
predTest <- predict(lmScore, newdata = pisaTest)
summary(predTest)
637.7 - 353.2
'org_babel_R_eoe'
writeLines("\n :: Sum of Squared Errors in the testing set")
SSE <- sum((predTest - pisaTest$readingScore)^2)
SSE
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set is:")
RMSE <- sqrt(SSE / nrow(pisaTest))
RMSE

writeLines("\n :: An alternative for calculation:")
sqrt(mean((predTest-pisaTest$readingScore)^2))
'org_babel_R_eoe'
SSE <- sum((predTest - pisaTest$readingScore)^2)

writeLines("\n :: The predicted test score used in the baseline model:")
mean(pisaTrain$readingScore)

SST <- sum((mean(pisaTrain$readingScore) - pisaTest$readingScore)^2)
R2 <- 1 - (SSE/SST)

writeLines("\n :: The SST for the training pisa data set")
SST
'org_babel_R_eoe'
writeLines("\n :: The test-set R-squared value:")
SSE <- sum((predTest - pisaTest$readingScore)^2)
SST <- sum((mean(pisaTrain$readingScore) - pisaTest$readingScore)^2)
R2 <- 1 - (SSE/SST)
R2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTrain.csv"

fileName <- "FluTrain.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the training data set")
FluTrain <- read.table("../data/FluTrain.csv", sep = ",", header = TRUE)
str(FluTrain)
summary(FluTrain)
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$ILI), ]
'org_babel_R_eoe'
FluTrain[which.max(FluTrain$Queries), ]
'org_babel_R_eoe'
FluTrend1 <- lm(log(ILI) ~ Queries, data = FluTrain)
summary(FluTrend1)
'org_babel_R_eoe'
summary(FluTrend1)
'org_babel_R_eoe'
writeLines("\n :: Relationship between R^2 and Correlation")
Correlation <- cor(log(FluTrain$ILI), FluTrain$Queries)
Correlation^2
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/FluTest.csv"

fileName <- "FluTest.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}
list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Read the testing data set")
FluTest <- read.table("../data/FluTest.csv", sep = ",", header = TRUE)
str(FluTest)
summary(FluTest)
'org_babel_R_eoe'
PredTest1 = exp(predict(FluTrend1, newdata = FluTest))
summary(PredTest1)
'org_babel_R_eoe'
writeLines("\n :: estimate for the percentage of ILI-related physician\nvisits for the week of March 11, 2012:")

FluPredictTest <- cbind(FluTest, PredTest1)
names(FluPredictTest)
FluPredictTest[which(FluPredictTest$Week == "2012-03-11 - 2012-03-17"), 4]
'org_babel_R_eoe'
stmILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 4]
obsILI <- FluPredictTest[which(FluPredictTest$Week ==
                                       "2012-03-11 - 2012-03-17"), 2]

writeLines("\n :: Relative error for our observation:")
relError <- (obsILI - stmILI) / obsILI
relError
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set is:")
sqrt(mean((FluPredictTest$PredTest1 - FluPredictTest$ILI)^2))
'org_babel_R_eoe'
## install.packages("zoo")
library(zoo)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTrain$ILI), -2, na.pad = TRUE)
FluTrain$ILILag2 <- coredata(ILILag2)
'org_babel_R_eoe'
summary(ILILag2)
'org_babel_R_eoe'
FluTrend2 <- lm(log(ILI) ~ Queries + log(ILILag2), data = FluTrain)
summary(FluTrend2)
'org_babel_R_eoe'
ILILag2 <- lag(zoo(FluTest$ILI), -2, na.pad = TRUE)
FluTest$ILILag2 <- coredata(ILILag2)
summary(FluTest$ILILag2)
'org_babel_R_eoe'
tail(FluTrain, 10)
head(FluTest, 10)
'org_babel_R_eoe'
writeLines("\n :: Old values for the FluTest$ILILag2 first two values:")
tail(FluTrain)
head(FluTest)

writeLines("\n :: New first two values for the FluTest$ILILag2:")
FluTest$ILILag2[1] <- FluTrain$ILI[416]
FluTest$ILILag2[2] <- FluTrain$ILI[417]
tail(FluTrain)
head(FluTest)
'org_babel_R_eoe'
PredTest2 <- exp(predict(FluTrend2, newdata = FluTest))
summary(PredTest2)
'org_babel_R_eoe'
writeLines("\n :: The RMSE of the testing data set and the new model is:")
sqrt(mean((PredTest2 - FluTest$ILI)^2))
'org_babel_R_eoe'
data(state)
statedata <- cbind(data.frame(state.x77), state.abb, state.area,
                   state.center, state.division, state.name,
                   state.region)
writeLines("\n :: data set loaded...")
'org_babel_R_eoe'
str(statedata)
'org_babel_R_eoe'
tapply(statedata$HS.Grad, statedata$state.region, mean)
which.max(tapply(statedata$HS.Grad, statedata$state.region, mean))
'org_babel_R_eoe'
q()
n
