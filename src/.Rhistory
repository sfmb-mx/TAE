OverallAccuracy <- (TN + TP) / nrow(test)
OverallAccuracy

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity

writeLines("\n :: Overall error rate:")
OverallErrorRate <- (FP + FN) / nrow(test)
OverallErrorRate

writeLines("\n :: False Negative Error Rate:")
FalseNegativeErrorRate <- FN / (TP + FN)
FalseNegativeErrorRate

writeLines("\n :: False Positive Error Rate:")
FalsePositiveErrorRate <- FP / ( TN + FP)
FalsePositiveErrorRate
'org_babel_R_eoe'
writeLines("\n :: Confusion matrix for threshold of 0.2:")
table(test$violator, predictTest >= 0.2)

TN <- 154; FP <- 25;
FN <- 6;  TP <- 17;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(test)
OverallAccuracy

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity

writeLines("\n :: Overall error rate:")
OverallErrorRate <- (FP + FN) / nrow(test)
OverallErrorRate

writeLines("\n :: False Negative Error Rate:")
FalseNegativeErrorRate <- FN / (TP + FN)
FalseNegativeErrorRate

writeLines("\n :: False Positive Error Rate:")
FalsePositiveErrorRate <- FP / ( TN + FP)
FalsePositiveErrorRate
'org_babel_R_eoe'
writeLines("\n :: Install package only once")
library(ROCR)

writeLines("\n :: Prediction function")
ROCRpred = prediction(predictTest, test$violator)

writeLines("\n :: Performance function")
ROCRperf = performance(ROCRpred, "tpr", "fpr")
'org_babel_R_eoe'
writeLines("\n :: Install package only once")
library(ROCR)

writeLines("\n :: Prediction function")
ROCRpred = prediction(predictTest, test$violator)

writeLines("\n :: Performance function")
ROCRperf = performance(ROCRpred, "tpr", "fpr")
'org_babel_R_eoe'
writeLines("\n :: Install package only once")
library(ROCR)

writeLines("\n :: Prediction function")
ROCRpred = prediction(predictTest, test$violator)

writeLines("\n :: The AUC for the prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans.csv"

fileName <- "loans.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans.csv"

fileName <- "loans.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading data into their data frames.")
loan <- read.csv("../data/loans.csv")
str(loan)
summary(loan)
'org_babel_R_eoe'
writeLines("\n :: Proportion of not fully paid loans:")
nrow(subset(loan, loan$not.fully.paid == 1)) / nrow(loan)
'org_babel_R_eoe'
writeLines("\n :: Variables with NA instances:")
summary(loan)
'org_babel_R_eoe'
head(loan[!is.na(loan$pub.rec), ])
length(complete.cases(loan))
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
length(complete.cases(loan))
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])

writeLines("\n :: Non complete cases analysis:")
loan$int.rate[!complete.cases(loan)]
'org_babel_R_eoe'
loan[!complete.cases(loan), ]
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])

writeLines("\n :: Non complete cases analysis:")
nrow(loan[!complete.cases(loan), ])
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])

writeLines("\n :: Non complete cases:")
nrow(loan[!complete.cases(loan), ])
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])

writeLines("\n :: Non complete cases:")
nrow(loan[!complete.cases(loan), ])

table(missing$not.fully.paid)
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loan)

writeLines("\n :: Number of observations with complete information:")
nrow(loan[complete.cases(loan), ])

writeLines("\n :: Non complete cases:")
nrow(loan[!complete.cases(loan), ])

table(loan[!complete.cases(loan), ]$not.fully.paid)
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans_imputed.csv"

fileName <- "loans_imputed.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans_imputed.csv"

fileName <- "loans_imputed.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans.csv")
str(loans)
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Loading data into their data frame.")
loans <- read.csv("../data/loans.csv")
str(loans)
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Proportion of not fully paid loans:")
nrow(subset(loans, loans$not.fully.paid == 1)) / nrow(loans)
'org_babel_R_eoe'
writeLines("\n :: Variables with NA instances:")
summary(loan)
'org_babel_R_eoe'
writeLines("\n :: Variables with NA instances:")
summary(loans)
'org_babel_R_eoe'
rm(loan)
writeLines("\n :: Variables with NA instances:")
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loans)

writeLines("\n :: Number of observations with complete information:")
nrow(loans[complete.cases(loans), ])

writeLines("\n :: Non complete cases:")
nrow(loans[!complete.cases(loans), ])

table(loans[!complete.cases(loans), ]$not.fully.paid)
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans_imputed.csv")
str(loans)
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans_imputed.csv")
anyNA(loans)
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans_imputed.csv")

writeLines("\n :: Verifying non NA existance:")
anyNA(loans)
'org_babel_R_eoe'
library(mice)
set.seed(144)
vars.for.imputation = setdiff(names(loans), "not.fully.paid")
vars.for.imputation
q()
n
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans_imputed.csv"

fileName <- "loans_imputed.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans_imputed.csv")

writeLines("\n :: Verifying non NA existance:")
anyNA(loans)
'org_babel_R_eoe'
library(mice)
writeLines("\n :: Split the loans dataset in training and testing datasets:")
set.seed(144)
library(caTools)
split <- sample.split(loans$not.fully.paid, SplitRatio = 0.7)
loansTraining <- subset(loans, split == TRUE)
loansTest <- subset(loans, split == FALSE)
'org_babel_R_eoe'
writeLines("\n :: Split the loans dataset in training and testing datasets:")
set.seed(144)
library(caTools)
split <- sample.split(loans$not.fully.paid, SplitRatio = 0.7)
loansTrain <- subset(loans, split == TRUE)
loansTest <- subset(loans, split == FALSE)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 1")
LoansLog1 = glm(not.fully.paid ~ ., data = loansTrain, family = binomial)
summary(LoansLog1)
'org_babel_R_eoe'
writeLines("\n :: The value of Logit(A) - Logit(B)")
LogitAMinusLogitB <- -9.317e-03 * (700 - 710)
LogitAMinusLogitB
'org_babel_R_eoe'
writeLines("\n :: The value of O(A) / O(B):")
exp(LogitAMinusLogitB)
'org_babel_R_eoe'
writeLines("\n :: Predicting the probability of the testing set loans not being paid:")
predicted.risk <- predict(LoansLog1, type = "response", newdata = loansTest)
predicted.risk
'org_babel_R_eoe'
writeLines("\n :: Predicting the probability of the testing set loans not being paid:")
predicted.risk <- predict(LoansLog1, type = "response", newdata = loansTest)
loansTest$predicted.risk <- predicted.risk

writeLines("\n :: Calculate the confusion matrix:")
table(loansTest$not.fully.paid, loans$predicted.risk >= 0.5)
'org_babel_R_eoe'
writeLines("\n :: Predicting the probability of the testing set loans not being paid:")
predicted.risk <- predict(LoansLog1, type = "response", newdata = loansTest)
loansTest$predicted.risk <- predicted.risk

writeLines("\n :: Calculate the confusion matrix:")
table(loansTest$not.fully.paid, loansTest$predicted.risk >= 0.5)
'org_babel_R_eoe'
TN <- 2400; FP <- 13;
FN <- 457; TP <- 3;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(SongsTest)
OverallAccuracy
'org_babel_R_eoe'
TN <- 2400; FP <- 13;
FN <- 457; TP <- 3;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(loansTest)
OverallAccuracy
'org_babel_R_eoe'
writeLines("\n :: Naive Baseline")
table(loansTest$not.fully.paid)

writeLines("\n :: The accuracy of the simple model:")
2413 / (2413 + 460)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
library(ROCR)

writeLines("\n :: Prediction function:")
ROCRpred = prediction(predicted.risk, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
library(ROCR)

writeLines("\n :: Prediction function:")
ROCRpred = prediction(predicted.risk, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 2")
LoansLog2 <- glm(not.fully.paid ~ int.rate, data = loansTrain, family = binomial)
summary(LoansLog2)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 2")
LoansLog2 <- glm(not.fully.paid ~ int.rate, data = loansTrain, family = binomial)
summary(LoansLog2)

writeLines("\n :: Remembering the Model 1: Loanslog1:")
summary(LoansLog1)
'org_babel_R_eoe'
writeLines("\n :: Correlation between int.rate and fico features:")
cor(train$int.rate, train$fico)
'org_babel_R_eoe'
writeLines("\n :: Correlation between int.rate and fico features:")
cor(loansTrain$int.rate, loansTrain$fico)
'org_babel_R_eoe'
q()
n
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/songs.csv"

fileName <- "songs.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading data into their data frames.")
songs <- read.csv("../data/songs.csv")
str(songs)
table(songs$Year)
summary(songs)
'org_babel_R_eoe'
writeLines("\n :: Number of songs in 2010:")
nrow(subset(songs, songs$year == 2010))

writeLines("\n :: Other way to calculate:")
table(songs$year)
'org_babel_R_eoe'
writeLines("\n :: Number of songs of Michael Jackson:")
nrow(subset(songs, songs$artistname == "Michael Jackson"))
'org_babel_R_eoe'
writeLines("\n :: Songs of Michael Jackson in the Top 10:")
sort(subset(songs, songs$artistname == "Michael Jackson" & songs$Top10
            == 1)$songtitle, decreasing = TRUE)
'org_babel_R_eoe'
writeLines("\n :: The values of the timesignature variable in the dataset:")
table(songs$timesignature)
'org_babel_R_eoe'
writeLines("\n :: the song with the highest tempo is:")
songs[which.max(songs$tempo), 2]

writeLines("\n :: Other way to calculate:")
songs$songtitle[which.max(songs$tempo)]
'org_babel_R_eoe'
writeLines("\n :: Building the training and testing sets:")
SongsTrain <- subset(songs, songs$year <= 2009)
writeLines("\n :: Number of observations in the training set:")
nrow(SongsTrain)

SongsTest <- subset(songs, songs$year >= 2010)
writeLines("\n :: Number of observations on the test set:")
nrow(SongsTest)
'org_babel_R_eoe'
writeLines("\n :: To remove variables from your training and testing sets:")
nonvars <- c("year", "songtitle", "artistname", "songID", "artistID")
SongsTrain <- SongsTrain[ , !(names(SongsTrain) %in% nonvars) ]
SongsTest <- SongsTest[ , !(names(SongsTest) %in% nonvars) ]

writeLines("\n :: Build the logistic regression model:")
SongsLog1 <- glm(Top10 ~ ., data=SongsTrain, family=binomial)
summary(SongsLog1)
'org_babel_R_eoe'
writeLines("\n :: The summary of the model 1:")
summary(SongsLog1)
'org_babel_R_eoe'
writeLines("\n :: The summary of the model 1:")
summary(SongsLog1)
'org_babel_R_eoe'
writeLines("\n :: The correlation between variables loudness and energy:")
cor(SongsTrain$loudness, SongsTrain$energy)
'org_babel_R_eoe'
writeLines("\n :: Model 2 omiting the loudness variable:")
SongsLog2 <- glm(Top10 ~ . -loudness, data = SongsTrain, family = binomial)
summary(SongsLog2)
'org_babel_R_eoe'
writeLines("\n :: Model 3 omiting the energy variable:")
SongsLog3 <- glm(Top10 ~ . - energy, data = SongsTrain, family = binomial)
summary(SongsLog3)
'org_babel_R_eoe'
writeLines("\n :: Test set predictions:")
SongsTestPrediction <- predict(SongsLog3, newdata = SongsTest, type = "response")
table(SongsTest$Top10, SongsTestPrediction >= 0.45)
'org_babel_R_eoe'
TN <- 309; FP <- 5;
FN <- 40; TP <- 19;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(SongsTest)
OverallAccuracy
'org_babel_R_eoe'
writeLines("\n :: Baseline accuracy:")
table(SongsTest$Top10)
'org_babel_R_eoe'
writeLines("\n :: Baseline model accuracy:")
BaselineModelAcc <- 314 / (314 + 59)
BaselineModelAcc
'org_babel_R_eoe'
writeLines("\n :: Test set predictions for 2010:")
table(SongsTest$Top10, SongsTestPrediction >= 0.45)
'org_babel_R_eoe'
TN <- 309; FP <- 5;
FN <- 40; TP <- 19;

writeLines("\n :: Prediction in Top 10 in 2010:")
PredTop10.2010 <- TP
PredTop10.2010
'org_babel_R_eoe'
writeLines("\n :: Prediction in NON hits in 2010:")
PredNonHits2010 <- FP
PredNonHits2010
'org_babel_R_eoe'
TN <- 309; FP <- 5;
FN <- 40; TP <- 19;

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity
'org_babel_R_eoe'
TN <- 309; FP <- 5;
FN <- 40; TP <- 19;

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity

writeLines("\n :: Test set predictions for 2010:")
table(SongsTest$Top10, SongsTestPrediction >= 0.45)
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/parole.csv"

fileName <- "parole.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading data into their data frames.")
parole <- read.csv("../data/parole.csv")
str(parole)
summary(parole)
'org_babel_R_eoe'
writeLines("\n :: Parelee violator in the data set")
nrow(subset(parole, parole$violator == 1))

writeLines("\n :: Other way to calculate the same result:")
table(parole$violator)
'org_babel_R_eoe'
str(parole)
'org_babel_R_eoe'
writeLines("\n :: Parole data set original:")
paroleOrig <- parole

writeLines("\n :: str() function over state and crime feature:")
str(paroleOrig$state)
str(paroleOrig$crime)

writeLines("\n :: table() function over state and crime feature:")
table(paroleOrig$state)
table(paroleOrig$crime)

writeLines("\n :: Converting state and crime features to factor...")
parole$state <- as.factor(parole$state)
parole$crime <- as.factor(parole$crime)
summary(parole)
'org_babel_R_eoe'
set.seed(144)
library(caTools)
split <- sample.split(parole$violator, SplitRatio = 0.7)
train <- subset(parole, split == TRUE)
test <- subset(parole, split == FALSE)
'org_babel_R_eoe'
writeLines("\n :: Training set proportion:")
nrow(train) / (nrow(train) + nrow(test))

writeLines("\n :: Testing set proportion:")
nrow(test) / (nrow(train) + nrow(test))
'org_babel_R_eoe'
set.seed(144)
library(caTools)
split <- sample.split(parole$violator, SplitRatio = 0.7)
train <- subset(parole, split == TRUE)
test <- subset(parole, split == FALSE)

writeLines("\n :: Training set proportion:")
nrow(train) / (nrow(train) + nrow(test))

writeLines("\n :: Testing set proportion:")
nrow(test) / (nrow(train) + nrow(test))
'org_babel_R_eoe'
split2 <- sample.split(parole$violator, SplitRatio = 0.7)
train2 <- subset(parole, split2 == TRUE)
test2 <- subset(parole, split2 == FALSE)

writeLines("\n :: Differences between both sets of splits:")
## install.packages('compare', repos='http://cran.rstudio.com/')
library(compare)
compare(train, train2)
compare(test, test2)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 1")
ParoleLog1 = glm(violator ~ ., data = train, family = binomial)
summary(ParoleLog1)
'org_babel_R_eoe'
beta0 <- -4.2411574; beta1 <- 1.6119919;
x1 <- c(0, 1, 2, 3, 4);

writeLines("\n :: The step in odds units:")
exp(beta1)

logit <- beta0 + (beta1 * x1)
writeLines("\n :: The value of logit is:")
logit
'org_babel_R_eoe'
writeLines("\n :: Building the new test set:")
newObservation <- c(1, 1, 50, 1, 3, 12, 0, 2, 1)
newTest <- rbind(test, newObservation)
newTest <- newTest[203, ]
newTest
'org_babel_R_eoe'
logit <- -4.2411574 + (0.3869904 * 1) + (0.8867192 * 1) + (-0.0001756
        * 50) + (-0.1238867 * 3) + (0.0802954 * 12) + (0.6837143 * 1)

writeLines("\n :: The Odds are:")
exp(logit)
'org_babel_R_eoe'
writeLines("\n :: Predicting the probability of this individual is a violator:")
predictNewTest <- predict(ParoleLog1, type = "response", newdata = newTest)
predictNewTest
'org_babel_R_eoe'
writeLines("\n :: Predicting the maximum probability of a violation:")
predictTest <- predict(ParoleLog1, type = "response", newdata = test)
head(sort(predictTest, decreasing = TRUE), 1)
'org_babel_R_eoe'
predictTest <- predict(ParoleLog1, type = "response", newdata = test)

writeLines("\n :: Confusion matrix for threshold of 0.5:")
table(test$violator, predictTest >= 0.5)

TN <- 167; FP <- 12;
FN <- 11;  TP <- 12;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(test)
OverallAccuracy

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity

writeLines("\n :: Overall error rate:")
OverallErrorRate <- (FP + FN) / nrow(test)
OverallErrorRate

writeLines("\n :: False Negative Error Rate:")
FalseNegativeErrorRate <- FN / (TP + FN)
FalseNegativeErrorRate

writeLines("\n :: False Positive Error Rate:")
FalsePositiveErrorRate <- FP / ( TN + FP)
FalsePositiveErrorRate
'org_babel_R_eoe'
writeLines("\n :: Naive Baseline")
table(test$violator)

writeLines("\n :: The accuracy of the simple model:")
179 / (179 + 23)
'org_babel_R_eoe'
writeLines("\n :: Confusion matrix for threshold of 0.2:")
table(test$violator, predictTest >= 0.2)

TN <- 154; FP <- 25;
FN <- 6;  TP <- 17;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(test)
OverallAccuracy

writeLines("\n :: Sensitivity:")
Sensitivity <- TP / (TP + FN)
Sensitivity

writeLines("\n :: Specificity:")
Specificity <- TN / (TN + FP)
Specificity

writeLines("\n :: Overall error rate:")
OverallErrorRate <- (FP + FN) / nrow(test)
OverallErrorRate

writeLines("\n :: False Negative Error Rate:")
FalseNegativeErrorRate <- FN / (TP + FN)
FalseNegativeErrorRate

writeLines("\n :: False Positive Error Rate:")
FalsePositiveErrorRate <- FP / ( TN + FP)
FalsePositiveErrorRate
'org_babel_R_eoe'
writeLines("\n :: Install package only once")
## install.packages('ROCR', repos='http://cran.rstudio.com/')
library(ROCR)

writeLines("\n :: Prediction function")
ROCRpred = prediction(predictTest, test$violator)

writeLines("\n :: The AUC for the prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans.csv"

fileName <- "loans.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading data into their data frame.")
loans <- read.csv("../data/loans.csv")
str(loans)
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Proportion of not fully paid loans:")
nrow(subset(loans, loans$not.fully.paid == 1)) / nrow(loans)
'org_babel_R_eoe'
writeLines("\n :: Variables with NA instances:")
summary(loans)
'org_babel_R_eoe'
writeLines("\n :: Number of loans:")
nrow(loans)

writeLines("\n :: Number of observations with complete information:")
nrow(loans[complete.cases(loans), ])

writeLines("\n :: Non complete cases:")
nrow(loans[!complete.cases(loans), ])

table(loans[!complete.cases(loans), ]$not.fully.paid)
'org_babel_R_eoe'
library(parallel)

if(!file.exists("../data")) {
        dir.create("../data")
}

fileUrl <- "https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/loans_imputed.csv"

fileName <- "loans_imputed.csv"

dataPath <- "../data"

filePath <- paste(dataPath, fileName, sep = "/")

if(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = "curl")
}

list.files("../data")
'org_babel_R_eoe'
writeLines("\n :: Loading imputed data into their data frame.")
loans <- read.csv("../data/loans_imputed.csv")

writeLines("\n :: Verifying non NA existance:")
anyNA(loans)
'org_babel_R_eoe'
writeLines("\n :: Split the loans dataset in training and testing datasets:")
set.seed(144)
library(caTools)
split <- sample.split(loans$not.fully.paid, SplitRatio = 0.7)
loansTrain <- subset(loans, split == TRUE)
loansTest <- subset(loans, split == FALSE)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 1")
LoansLog1 = glm(not.fully.paid ~ ., data = loansTrain, family = binomial)
summary(LoansLog1)
'org_babel_R_eoe'
writeLines("\n :: The value of Logit(A) - Logit(B)")
LogitAMinusLogitB <- -9.317e-03 * (700 - 710)
LogitAMinusLogitB
'org_babel_R_eoe'
writeLines("\n :: The value of O(A) / O(B):")
exp(LogitAMinusLogitB)
'org_babel_R_eoe'
writeLines("\n :: Predicting the probability of the testing set loans not being paid:")
predicted.risk <- predict(LoansLog1, type = "response", newdata = loansTest)
loansTest$predicted.risk <- predicted.risk

writeLines("\n :: Calculate the confusion matrix:")
table(loansTest$not.fully.paid, loansTest$predicted.risk >= 0.5)
'org_babel_R_eoe'
TN <- 2400; FP <- 13;
FN <- 457; TP <- 3;

writeLines("\n :: Overall accuracy:")
OverallAccuracy <- (TN + TP) / nrow(loansTest)
OverallAccuracy
'org_babel_R_eoe'
writeLines("\n :: Naive Baseline")
table(loansTest$not.fully.paid)

writeLines("\n :: The accuracy of the simple model:")
2413 / (2413 + 460)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
## install.packages('ROCR', repos='http://cran.rstudio.com/')
library(ROCR)

writeLines("\n :: Prediction function:")
ROCRpred = prediction(predicted.risk, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
writeLines("\n :: Building the logistic regression model 2")
LoansLog2 <- glm(not.fully.paid ~ int.rate, data = loansTrain, family = binomial)
summary(LoansLog2)

writeLines("\n :: Remembering the Model 1: Loanslog1:")
summary(LoansLog1)
'org_babel_R_eoe'
writeLines("\n :: Correlation between int.rate and fico features:")
cor(loansTrain$int.rate, loansTrain$fico)
'org_babel_R_eoe'
names(loansTest)
writeLines("\n :: Test set predictions:")
LoansTestPrediction <- predict(LoansLog2, newdata = loansTest, type = "response")
table(loansTest$not.fully.paid, loansTest$predicted.risk >= 0.5)
'org_babel_R_eoe'
writeLines("\n :: Test set predictions:")
LoansTestPrediction <- predict(LoansLog2, newdata = loansTest, type = "response")
table(loansTest$not.fully.paid, loansTest$predicted.risk > 0.5)
'org_babel_R_eoe'
writeLines("\n :: Test set predictions:")
LoansTestPrediction <- predict(LoansLog2, newdata = loansTest, type = "response")
summary(LoansTestPrediction)
## table(loansTest$not.fully.paid, loansTest$predicted.risk > 0.5)
'org_babel_R_eoe'
writeLines("\n :: Number of loans not fully paid prediction:")
table(loansTest$not.fully.paid, loansTest$predicted.risk > 0.5)
'org_babel_R_eoe'
writeLines("\n :: Number of loans not fully paid prediction:")
table(loansTest$not.fully.paid, loansTest$predicted.risk > 0.5)
'org_babel_R_eoe'
writeLines("\n :: Number of loans not fully paid prediction:")
table(loansTest$not.fully.paid, loansTest$predicted.risk >= 0.5)
'org_babel_R_eoe'
writeLines("\n :: Number of loans not fully paid prediction:")
table(loansTest$not.fully.paid, LoansTestprediction >= 0.5)
'org_babel_R_eoe'
writeLines("\n :: Test set predictions:")
LoansTestPrediction <- predict(LoansLog2, newdata = loansTest, type = "response")
summary(LoansTestPrediction)
'org_babel_R_eoe'
writeLines("\n :: Number of loans not fully paid prediction:")
table(loansTest$not.fully.paid, LoansTestPrediction >= 0.5)
'org_babel_R_eoe'
class(LoansTestPrediction)
writeLines("\n :: Number of loans not fully paid prediction:")
summary(LoansTestPrediction)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
## install.packages('ROCR', repos='http://cran.rstudio.com/')
library(ROCR)

writeLines("\n :: Bivariate Prediction function:")
ROCRpredBV <- prediction(Loanstestprediction, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the bivariate prediction function:")
as.numeric(performance(ROCRpred, "auc")@y.values)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
## install.packages('ROCR', repos='http://cran.rstudio.com/')
library(ROCR)

writeLines("\n :: Bivariate Prediction function:")
ROCRpredBV <- prediction(Loanstestprediction, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the bivariate prediction function:")
as.numeric(performance(ROCRpredBV, "auc")@y.values)
'org_babel_R_eoe'
writeLines("\n :: Install package only once:")
## install.packages('ROCR', repos='http://cran.rstudio.com/')
library(ROCR)

writeLines("\n :: Bivariate Prediction function:")
ROCRpredBV <- prediction(LoansTestPrediction, loansTest$not.fully.paid)

writeLines("\n :: The AUC for the bivariate prediction function:")
as.numeric(performance(ROCRpredBV, "auc")@y.values)
'org_babel_R_eoe'
q()
n
