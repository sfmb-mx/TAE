<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Assignment 6. The Analytics Edge</title>
<!-- 2015-07-22 Wed 08:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Sergio-Feliciano Mendoza-Barrera" />
<meta  name="description" content="Unit 6 homework of the TAE."
 />
<meta  name="keywords" content="R, data science, emacs, ESS, org-mode, TAE, clustering, k-means" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Assignment 6. The Analytics Edge</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Document clustering with daily KOS <code>[100%]</code></a>
<ul>
<li><a href="#sec-1-1">1.1. <span class="done DONE">DONE</span> Problem 1.1 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-1-2">1.2. <span class="done DONE">DONE</span> Problem 1.2 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-1-3">1.3. <span class="done DONE">DONE</span> Problem 1.3 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-1-4">1.4. <span class="done DONE">DONE</span> Problem 1.4 - Hierarchical Clustering (3 points possible)</a></li>
<li><a href="#sec-1-5">1.5. <span class="done DONE">DONE</span> Problem 1.5 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-1-6">1.6. <span class="done DONE">DONE</span> Problem 1.6 - Hierarchical Clustering (3 points possible)</a></li>
<li><a href="#sec-1-7">1.7. <span class="done DONE">DONE</span> Problem 2.1 - K-Means Clustering (3 points possible)</a></li>
<li><a href="#sec-1-8">1.8. <span class="done DONE">DONE</span> Problem 2.2 - K-Means Clustering (2 points possible)</a></li>
<li><a href="#sec-1-9">1.9. <span class="done DONE">DONE</span> Problem 2.3 - K-Means Clustering (1 point possible)</a></li>
<li><a href="#sec-1-10">1.10. <span class="done DONE">DONE</span> Problem 2.4 - K-Means Clustering (1 point possible)</a></li>
<li><a href="#sec-1-11">1.11. <span class="done DONE">DONE</span> Problem 2.5 - K-Means Clustering (1 point possible)</a></li>
<li><a href="#sec-1-12">1.12. <span class="done DONE">DONE</span> Problem 2.6 - K-Means Clustering (1 point possible)</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Market Segmentation For Airlines <code>[100%]</code></a>
<ul>
<li><a href="#sec-2-1">2.1. <span class="done DONE">DONE</span> Problem 1.1 - Normalizing the Data (2 points possible)</a></li>
<li><a href="#sec-2-2">2.2. <span class="done DONE">DONE</span> Problem 1.2 - Normalizing the Data (1 point possible)</a></li>
<li><a href="#sec-2-3">2.3. <span class="done DONE">DONE</span> Problem 1.3 - Normalizing the Data (2 points possible)</a></li>
<li><a href="#sec-2-4">2.4. <span class="done DONE">DONE</span> Problem 2.1 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-2-5">2.5. <span class="done DONE">DONE</span> Problem 2.2 - Hierarchical Clustering (1 point possible)</a></li>
<li><a href="#sec-2-6">2.6. <span class="done DONE">DONE</span> Problem 2.3 - Hierarchical Clustering (2 points possible)</a></li>
<li><a href="#sec-2-7">2.7. <span class="done DONE">DONE</span> Problem 2.4 - Hierarchical Clustering (2 points possible)</a></li>
<li><a href="#sec-2-8">2.8. <span class="done DONE">DONE</span> Problem 2.5 - Hierarchical Clustering (2 points possible)</a></li>
<li><a href="#sec-2-9">2.9. <span class="done DONE">DONE</span> Problem 2.6 - Hierarchical Clustering (2 points possible)</a></li>
<li><a href="#sec-2-10">2.10. <span class="done DONE">DONE</span> Problem 2.7 - Hierarchical Clustering (2 points possible)</a></li>
<li><a href="#sec-2-11">2.11. <span class="done DONE">DONE</span> Problem 3.1 - K-Means Clustering (1 point possible)</a></li>
<li><a href="#sec-2-12">2.12. <span class="done DONE">DONE</span> Problem 3.2 - K-Means Clustering (1 point possible)</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Predicting Stock Returns with Cluster-Then-Predict <code>[100%]</code></a>
<ul>
<li><a href="#sec-3-1">3.1. <span class="done DONE">DONE</span> Problem 1.1 - Exploring the Dataset (1 point possible)</a></li>
<li><a href="#sec-3-2">3.2. <span class="done DONE">DONE</span> Problem 1.2 - Exploring the Dataset (1 point possible)</a></li>
<li><a href="#sec-3-3">3.3. <span class="done DONE">DONE</span> Problem 1.3 - Exploring the Dataset (1 point possible)</a></li>
<li><a href="#sec-3-4">3.4. <span class="done DONE">DONE</span> Problem 1.4 - Exploring the Dataset (2 points possible)</a></li>
<li><a href="#sec-3-5">3.5. <span class="done DONE">DONE</span> Problem 2.1 - Initial Logistic Regression Model (2 points possible)</a></li>
<li><a href="#sec-3-6">3.6. <span class="done DONE">DONE</span> Problem 2.2 - Initial Logistic Regression Model (1 point possible)</a></li>
<li><a href="#sec-3-7">3.7. <span class="done DONE">DONE</span> Problem 2.3 - Initial Logistic Regression Model (1 point possible)</a></li>
<li><a href="#sec-3-8">3.8. <span class="done DONE">DONE</span> Problem 3.1 - Clustering Stocks (1 point possible)</a></li>
<li><a href="#sec-3-9">3.9. <span class="done DONE">DONE</span> Problem 3.2 - Clustering Stocks (2 points possible)</a></li>
<li><a href="#sec-3-10">3.10. <span class="done DONE">DONE</span> Problem 3.3 - Clustering Stocks (1 point possible)</a></li>
<li><a href="#sec-3-11">3.11. <span class="done DONE">DONE</span> Problem 3.4 - Clustering Stocks (1 point possible)</a></li>
<li><a href="#sec-3-12">3.12. <span class="done DONE">DONE</span> Problem 3.5 - Clustering Stocks (1 point possible)</a></li>
<li><a href="#sec-3-13">3.13. <span class="done DONE">DONE</span> Problem 4.1 - Cluster-Specific Predictions (1 point possible)</a></li>
<li><a href="#sec-3-14">3.14. <span class="done DONE">DONE</span> Problem 4.2 - Cluster-Specific Predictions (2 points possible)</a></li>
<li><a href="#sec-3-15">3.15. <span class="done DONE">DONE</span> Problem 4.3 - Cluster-Specific Predictions (6 points possible)</a></li>
<li><a href="#sec-3-16">3.16. <span class="done DONE">DONE</span> Problem 4.4 - Cluster-Specific Predictions (1 point possible)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="abstract">
<p>
The homework of the unit 6 of the Analytics Edge.
</p>

</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Document clustering with daily KOS <code>[100%]</code></h2>
<div class="outline-text-2" id="text-1">
<p>
Document clustering, or text clustering, is a very popular application
of clustering algorithms. A web search engine, like Google, often
returns thousands of results for a simple query. For example, if you
type the search term "jaguar" into Google, around 200 million results
are returned. This makes it very difficult to browse or find relevant
information, especially if the search term has multiple meanings. If
we search for "jaguar", we might be looking for information about the
animal, the car, or the Jacksonville Jaguars football team.
</p>

<p>
Clustering methods can be used to automatically group search results
into categories, making it easier to find relavent results. This
method is used in the search engines PolyMeta and Helioid, as well as
on FirstGov.gov, the official Web portal for the U.S. government. The
two most common algorithms used for document clustering are
Hierarchical and k-means.
</p>

<p>
In this problem, we'll be clustering articles published on <a href="https://www.dailykos.com">Daily Kos</a>,
an American political blog that publishes news and opinion articles
written from a progressive point of view. Daily Kos was founded by
Markos Moulitsas in 2002, and as of September 2014, the site had an
average weekday traffic of hundreds of thousands of visits.
</p>

<p>
The file <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/dailykos.csv">dailykos.csv</a> contains data on 3,430 news articles or blogs
that have been posted on Daily Kos. These articles were posted in
2004, leading up to the United States Presidential Election. The
leading candidates were incumbent President George W. Bush
(republican) and John Kerry (democratic). Foreign policy was a
dominant topic of the election, specifically, the 2003 invasion of
Iraq.
</p>

<p>
Each of the variables in the dataset is a word that has appeared in at
least 50 different articles (1,545 words in total). The set of  words
has been trimmed according to some of the techniques covered in the
previous week on text analytics (punctuation has been removed, and
stop words have been removed). For each document, the variable values
are the number of times that word appeared in the document.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> <span class="done DONE">DONE</span> Problem 1.1 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Let's start by building a hierarchical clustering model. First, read
the data set into R.
</p>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Download the data sets</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/dailykos.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"dailykos.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)
<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}
list.files(<span style="color: #ff6a6a;">"../data"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "mvtWeek1.csv"            "NBA_test.csv"
[33] "NBA_train.csv"           "parole.csv"
[35] "pisa2009test.csv"        "pisa2009train.csv"
[37] "PollingData_Imputed.csv" "PollingData.csv"
[39] "ProcterGambleStock.csv"  "quality.csv"
[41] "README.md"               "SampleSubmission.csv"
[43] "songs.csv"               "stevens.csv"
[45] "StocksCluster.csv"       "stopwords.txt"
[47] "tumor.csv"               "tweets.csv"
[49] "USDA.csv"                "WHO_Europe.csv"
[51] "WHO.csv"                 "wiki.csv"
[53] "wine_test.csv"           "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-1-1-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"    Loading data set into their data frame..."</span>)
dailykos <span style="color: #db7093;">&lt;-</span> read.table(<span style="color: #ff6a6a;">"../data/dailykos.csv"</span>, sep = <span style="color: #ff6a6a;">","</span>, header = <span style="color: #3cb371;">TRUE</span>)
</pre>
</div>

<pre class="example">
Loading data set into their data frame...
</pre>

<p>
Then, compute the distances (using method="euclidean"), and use hclust
to build the model (using method="ward.D"). You should cluster on all
of the variables.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Compute distances..."</span>)
kosDist <span style="color: #db7093;">&lt;-</span> dist(dailykos, method = <span style="color: #ff6a6a;">"euclidean"</span>)

writeLines(<span style="color: #ff6a6a;">"\n :: Hierarchical clustering..."</span>)
kosHierClust <span style="color: #db7093;">&lt;-</span> hclust(kosDist, method = <span style="color: #ff6a6a;">"ward.D"</span>)
</pre>
</div>

<pre class="example">
:: Compute distances...

:: Hierarchical clustering...
</pre>

<p>
Running the dist function will probably take you a while. Why? Select
all that apply.
</p>
</div>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> Answer <code>[2/4]</code></h4>
<div class="outline-text-4" id="text-1-1-3">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Dimensions of the kosDist matrix:"</span>)
dim(kosDist)

writeLines(<span style="color: #ff6a6a;">"\n :: Summary of the kosDist matrix:"</span>)
min(kosDist)

writeLines(<span style="color: #ff6a6a;">"\n :: Dimensions of distance vector:"</span>)
n <span style="color: #db7093;">&lt;-</span> length(kosDist)
n

writeLines(<span style="color: #ff6a6a;">"\n :: The number of calculations:"</span>)
(n*(n - 1)) / 2
</pre>
</div>

<pre class="example">
 :: Dimensions of the kosDist matrix:
NULL

 :: Summary of the kosDist matrix:
[1] 1.732051

 :: Dimensions of distance vector:
[1] 5880735

 :: The number of calculations:
[1] 1.729152e+13
</pre>

<ul class="org-ul">
<li><code>[X]</code> We have a lot of observations, so it takes a long time to
compute the distance between each pair of observations.
</li>

<li><code>[X]</code> We have a lot of variables, so the distance computation is long.
</li>

<li><code>[&#xa0;]</code> Our variables have a wide range of values, so the distances are
more complicated.
</li>

<li><code>[&#xa0;]</code> The euclidean distance is known to take a long time to compute,
regardless of the size of the data.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can read in the data set, compute the distances, and build the
hierarchical clustering model by using the following commands:
</p>

<p>
<code>dailykos = read.csv("dailykos.csv")</code>
</p>

<p>
<code>kosDist = dist(dailykos, method="euclidean")</code>
</p>

<p>
<code>kosHierClust = hclust(kosDist, method="ward.D")</code>
</p>

<p>
The distance computation can take a long time if you have a lot of
observations and/or if there are a lot of variables. As we saw in
recitation, it might not even work if you have too many of either!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> <span class="done DONE">DONE</span> Problem 1.2 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Plot the dendrogram of your hierarchical clustering model. Just
looking at the dendrogram, which of the following seem like good
choices for the number of clusters? Select all that apply.
</p>


<div id="fig:DailykosDendrogram" class="figure">
<p><img src="../graphs/DailykosDendrogram.png" alt="DailykosDendrogram.png" />
</p>
<p><span class="figure-number">Figure 1:</span> Dailykos dendrogram plot.</p>
</div>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Answer <code>[2/4]</code></h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li><code>[X]</code> 2
</li>
<li><code>[X]</code> 3
</li>
<li><code>[&#xa0;]</code> 5
</li>
<li><code>[&#xa0;]</code> 6
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can plot the dendrogram with the command:
</p>

<p>
<code>plot(kosHierClust)</code>
</p>

<p>
where <code>kosHierClust</code> is the name of your clustering model.
</p>

<p>
The choices 2 and 3 are good cluster choices according to the
dendrogram, because there is a lot of space between the horizontal
lines in the dendrogram in those cut off spots (draw a horizontal line
across the dendrogram where it crosses 2 or 3 vertical lines). The
choices of 5 and 6 do not seem good according to the dendrogram
because there is very little space.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> <span class="done DONE">DONE</span> Problem 1.3 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-3">
<p>
In this problem, we are trying to cluster news articles or blog posts
into groups. This can be used to show readers categories to choose
from when trying to decide what to read. Just thinking about this
application, what are good choices for the number of clusters? Select
all that apply.
</p>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Answer <code>[2/4]</code></h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> 2
</li>
<li><code>[&#xa0;]</code> 3
</li>
<li><code>[X]</code> 7
</li>
<li><code>[X]</code> 8
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Thinking about the application, it is probably better to show the
reader more categories than 2 or 3. These categories would probably be
too broad to be useful. Seven or eight categories seems more
reasonable.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> <span class="done DONE">DONE</span> Problem 1.4 - Hierarchical Clustering (3 points possible)</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Let's pick 7 clusters. This number is reasonable according to the
dendrogram, and also seems reasonable for the application. Use the
cutree function to split your data into 7 clusters.
</p>

<p>
Now, we don't really want to run tapply on every single variable when
we have over 1,000 different variables. Let's instead use the subset
function to subset our data by cluster. Create 7 new datasets, each
containing the observations from one of the clusters.
</p>


<div id="fig:Dailykos7Clusters" class="figure">
<p><img src="../graphs/Dailykos7Clusters.png" alt="Dailykos7Clusters.png" />
</p>
<p><span class="figure-number">Figure 2:</span> Split daily kos data in seven clusters</p>
</div>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Subsetting in 7 clusters..."</span>)
clusterGroups <span style="color: #db7093;">&lt;-</span> cutree(kosHierClust, k <span style="color: #db7093;">&lt;-</span> 7)

hcluster1 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==1)
hcluster2 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==2)
hcluster3 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==3)
hcluster4 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==4)
hcluster5 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==5)
hcluster6 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==6)
hcluster7 <span style="color: #db7093;">&lt;-</span> subset(dailykos, clusterGroups==7)
</pre>
</div>

<pre class="example">
 null device
          1

 :: Select 7 clusters:
null device
          1

 :: Subsetting in 7 clusters...
</pre>
</div>

<div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
How many observations are in cluster 3?
</p>
</div>

<div id="outline-container-sec-1-4-1-1" class="outline-5">
<h5 id="sec-1-4-1-1"><span class="section-number-5">1.4.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-4-1-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The cluster 3 dimensions:"</span>)
dim(hcluster3)
</pre>
</div>

<pre class="example">
 :: The cluster 3 dimensions:
[1]  374 1545
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> Question b</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Number of observations by cluster:"</span>)
c(nrow(hcluster1), nrow(hcluster2), nrow(hcluster3), nrow(hcluster4),
  nrow(hcluster5), nrow(hcluster6), nrow(hcluster7))
</pre>
</div>

<pre class="example">
 :: Number of observations by cluster:
[1] 1266  321  374  139  407  714  209
</pre>

<p>
Which cluster has the most observations?
</p>
</div>

<div id="outline-container-sec-1-4-2-1" class="outline-5">
<h5 id="sec-1-4-2-1"><span class="section-number-5">1.4.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-4-2-1">
<ul class="org-ul">
<li><code>[X]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-3" class="outline-4">
<h4 id="sec-1-4-3"><span class="section-number-4">1.4.3</span> Question c</h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
Which cluster has the fewest observations?
</p>
</div>

<div id="outline-container-sec-1-4-3-1" class="outline-5">
<h5 id="sec-1-4-3-1"><span class="section-number-5">1.4.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-4-3-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[X]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> <span class="done DONE">DONE</span> Problem 1.5 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Instead of looking at the average value in each variable individually,
we'll just look at the top 6 words in each cluster. To do this for
cluster 1, type the following in your R console (where <code>HierCluster1</code>
should be replaced with the name of your first cluster subset):
</p>

<p>
<code>tail(sort(colMeans(HierCluster1)))</code>
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The top 6 words in each cluster:"</span>)
tail(sort(colMeans(hcluster1)))
</pre>
</div>

<pre class="example">
:: The top 6 words in each cluster:
    state republican       poll   democrat      kerry       bush
0.7575039  0.7590837  0.9036335  0.9194313  1.0624013  1.7053712
</pre>

<p>
This computes the mean frequency values of each of the words in
cluster 1, and then outputs the 6 words that occur the most
frequently. The <code>colMeans</code> function computes the column (word) means,
the sort function orders the words in increasing order of the mean
values, and the tail function outputs the last 6 words listed, which
are the ones with the largest column means.
</p>

<p>
What is the most frequent word in this cluster, in terms of average
value? Enter the word exactly how you see it in the output:
</p>
</div>

<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
bush
</p>

<p>
<b>Explanation</b>
</p>

<p>
After running the R command given above, we can see that the most
frequent word on average is "bush". This corresponds to President
George W. Bush.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> <span class="done DONE">DONE</span> Problem 1.6 - Hierarchical Clustering (3 points possible)</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Now repeat the command given in the previous problem for each of the
other clusters, and answer the following questions.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 1:"</span>)
tail(sort(colMeans(hcluster1)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 2:"</span>)
tail(sort(colMeans(hcluster2)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 3:"</span>)
tail(sort(colMeans(hcluster3)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 4:"</span>)
tail(sort(colMeans(hcluster4)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 5:"</span>)
tail(sort(colMeans(hcluster5)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 6:"</span>)
tail(sort(colMeans(hcluster6)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 7:"</span>)
tail(sort(colMeans(hcluster7)))
</pre>
</div>

<pre class="example">
 :: Most frequent word for cluster 1:
     state republican       poll   democrat      kerry       bush
 0.7575039  0.7590837  0.9036335  0.9194313  1.0624013  1.7053712

 :: Most frequent word for cluster 2:
     bush  democrat challenge      vote      poll  november
 2.847352  2.850467  4.096573  4.398754  4.847352 10.339564

 :: Most frequent word for cluster 3:
     elect    parties      state republican   democrat       bush
  1.647059   1.665775   2.320856   2.524064   3.823529   4.406417

 :: Most frequent word for cluster 4:
campaign    voter presided     poll     bush    kerry
1.431655 1.539568 1.625899 3.589928 7.834532 8.438849

 :: Most frequent word for cluster 5:
      american       presided administration            war           iraq
      1.090909       1.120393       1.230958       1.776413       2.427518
          bush
      3.941032

 :: Most frequent word for cluster 6:
     race      bush     kerry     elect  democrat      poll
0.4579832 0.4887955 0.5168067 0.5350140 0.5644258 0.5812325

 :: Most frequent word for cluster 7:
democrat    clark   edward     poll    kerry     dean
2.148325 2.497608 2.607656 2.765550 3.952153 5.803828
</pre>
</div>

<div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
Which words best describe cluster 2?
</p>
</div>

<div id="outline-container-sec-1-6-1-1" class="outline-5">
<h5 id="sec-1-6-1-1"><span class="section-number-5">1.6.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-6-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> november, vote, edward, bush
</li>
<li><code>[&#xa0;]</code> kerry, bush, elect, poll
</li>
<li><code>[X]</code> november, poll, vote, challenge
</li>
<li><code>[&#xa0;]</code> bush, democrat, republican, state
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2"><span class="section-number-4">1.6.2</span> Question b</h4>
<div class="outline-text-4" id="text-1-6-2">
<p>
Which cluster could best be described as the cluster related to the
Iraq war?
</p>
</div>

<div id="outline-container-sec-1-6-2-1" class="outline-5">
<h5 id="sec-1-6-2-1"><span class="section-number-5">1.6.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-6-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[X]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3"><span class="section-number-4">1.6.3</span> Question c</h4>
<div class="outline-text-4" id="text-1-6-3">
<p>
In 2004, one of the candidates for the Democratic nomination for the
President of the United States was Howard Dean, John Kerry was the
candidate who won the democratic nomination, and John Edwards with the
running mate of John Kerry (the Vice President nominee). Given this
information, which cluster best corresponds to the democratic party?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[X]</code> Cluster 7
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can repeat the command on each of the clusters by typing the
following:
</p>

<p>
<code>tail(sort(colMeans(HierCluster2)))</code>
</p>

<p>
<code>tail(sort(colMeans(HierCluster3)))</code>
</p>

<p>
<code>tail(sort(colMeans(HierCluster4)))</code>
</p>

<p>
<code>tail(sort(colMeans(HierCluster5)))</code>
</p>

<p>
<code>tail(sort(colMeans(HierCluster6)))</code>
</p>

<p>
<code>tail(sort(colMeans(HierCluster7)))</code>
</p>

<p>
You can see that the words that best describe Cluster 2 are november,
poll, vote, and challenge. The most common words in Cluster 5 are
bush, iraq, war, and administration, so it is the cluster that can
best be described as corresponding to the Iraq war. And the most
common words in Cluster 7 are dean, kerry, poll, and edward, so it
looks like the democratic cluster.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> <span class="done DONE">DONE</span> Problem 2.1 - K-Means Clustering (3 points possible)</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Now, run k-means clustering, setting the seed to 1000 right before you
run the kmeans function. Again, pick the number of clusters equal
to 7. You don't need to add the iters.max argument.
</p>

<p>
Subset your data into the 7 clusters (7 new datasets) by using the
"cluster" variable of your kmeans output.
</p>

<div class="org-src-container">

<pre class="src src-R">set.seed(1000)
kosKmeans <span style="color: #db7093;">&lt;-</span> kmeans(dailykos, 7)
kosCluster <span style="color: #db7093;">&lt;-</span> kosKmeans$cluster
sort(table(kosCluster), decreasing = <span style="color: #3cb371;">TRUE</span>)
</pre>
</div>

<pre class="example">
kosCluster
   4    6    7    3    5    1    2
2063  329  308  277  163  146  144
</pre>
</div>

<div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
How many observations are in Cluster 3?
</p>
</div>

<div id="outline-container-sec-1-7-1-1" class="outline-5">
<h5 id="sec-1-7-1-1"><span class="section-number-5">1.7.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-7-1-1">
<p>
277
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><span class="section-number-4">1.7.2</span> Question b</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
Which cluster has the most observations?
</p>
</div>

<div id="outline-container-sec-1-7-2-1" class="outline-5">
<h5 id="sec-1-7-2-1"><span class="section-number-5">1.7.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-7-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[X]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-3" class="outline-4">
<h4 id="sec-1-7-3"><span class="section-number-4">1.7.3</span> Question</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
Which cluster has the fewest number of observations?
</p>
</div>

<div id="outline-container-sec-1-7-3-1" class="outline-5">
<h5 id="sec-1-7-3-1"><span class="section-number-5">1.7.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-7-3-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[X]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can run k-means clustering by using the following commands:
</p>

<p>
<code>set.seed(1000)</code>
</p>

<p>
<code>KmeansCluster = kmeans(dailykos, centers=7)</code>
</p>

<p>
Then, you can subset your data into the 7 clusters by using the
following commands:
</p>

<p>
<code>KmeansCluster1 = subset(dailykos, KmeansCluster$cluster == 1)</code>
</p>

<p>
<code>KmeansCluster2 = subset(dailykos, KmeansCluster$cluster == 2)</code>
</p>

<p>
<code>KmeansCluster3 = subset(dailykos, KmeansCluster$cluster == 3)</code>
</p>

<p>
<code>KmeansCluster4 = subset(dailykos, KmeansCluster$cluster == 4)</code>
</p>

<p>
<code>KmeansCluster5 = subset(dailykos, KmeansCluster$cluster == 5)</code>
</p>

<p>
<code>KmeansCluster6 = subset(dailykos, KmeansCluster$cluster == 6)</code>
</p>

<p>
<code>KmeansCluster7 = subset(dailykos, KmeansCluster$cluster == 7)</code>
</p>

<p>
Alternatively, you could answer these questions by looking at the
output of <code>table(KmeansCluster$cluster)</code>.
</p>

<p>
More Advanced Approach:
</p>

<p>
There is a very useful function in R called the <code>split</code>
function. Given a vector assigning groups like <code>KmeansCluster$cluster</code>,
you could split dailykos into the clusters by typing:
</p>

<p>
<code>KmeansCluster = split(dailykos, KmeansCluster$cluster)</code>
</p>

<p>
Then cluster 1 can be accessed by typing <code>KmeansCluster[ [ 1 ] ]</code>, cluster
2 can be accessed by typing <code>KmeansCluster[ [ 2 ] ]</code>, etc. If you have a
variable in your current R session called <code>split</code>, you will need to
remove it with rm(split) before using the split function.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> <span class="done DONE">DONE</span> Problem 2.2 - K-Means Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Now, output the six most frequent words in each cluster, like we did
in the previous problem, for each of the k-means clusters.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Subsetting each cluster content..."</span>)
kcluster1 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==1)
kcluster2 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==2)
kcluster3 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==3)
kcluster4 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==4)
kcluster5 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==5)
kcluster6 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==6)
kcluster7 <span style="color: #db7093;">&lt;-</span> subset(dailykos, kosCluster==7)

tail(sort(colMeans(kcluster3)))
tail(sort(colMeans(kcluster2)))
</pre>
</div>

<pre class="example">
 :: Subsetting each cluster content...
administration          iraqi       american           bush            war
      1.389892       1.610108       1.685921       2.610108       3.025271
          iraq
      4.093863
primaries  democrat    edward     clark     kerry      dean
 2.319444  2.694444  2.798611  3.090278  4.979167  8.277778
</pre>

<p>
Now we can obtain the six most frequent words in each cluster
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 1:"</span>)
tail(sort(colMeans(kcluster1)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 2:"</span>)
tail(sort(colMeans(kcluster2)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 3:"</span>)
tail(sort(colMeans(kcluster3)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 4:"</span>)
tail(sort(colMeans(kcluster4)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 5:"</span>)
tail(sort(colMeans(kcluster5)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 6:"</span>)
tail(sort(colMeans(kcluster6)))

writeLines(<span style="color: #ff6a6a;">"\n :: Most frequent word for cluster 7:"</span>)
tail(sort(colMeans(kcluster7)))
</pre>
</div>

<pre class="example">
 :: Most frequent word for cluster 1:
         state           iraq          kerry administration       presided
      1.609589       1.616438       1.636986       2.664384       2.767123
          bush
     11.431507

 :: Most frequent word for cluster 2:
primaries  democrat    edward     clark     kerry      dean
 2.319444  2.694444  2.798611  3.090278  4.979167  8.277778

 :: Most frequent word for cluster 3:
administration          iraqi       american           bush            war
      1.389892       1.610108       1.685921       2.610108       3.025271
          iraq
      4.093863

 :: Most frequent word for cluster 4:
     elect republican      kerry       poll   democrat       bush
 0.6010664  0.6175473  0.6495395  0.7474552  0.7891420  1.1473582

 :: Most frequent word for cluster 5:
      race     senate      state    parties republican   democrat
  2.484663   2.650307   3.521472   3.619632   4.638037   6.993865

 :: Most frequent word for cluster 6:
 democrat      bush challenge      vote      poll  november
 2.899696  2.960486  4.121581  4.446809  4.872340 10.370821

 :: Most frequent word for cluster 7:
presided    voter campaign     poll     bush    kerry
1.324675 1.334416 1.383117 2.788961 5.970779 6.480519
</pre>
</div>

<div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
Which k-means cluster best corresponds to the Iraq War?
</p>
</div>

<div id="outline-container-sec-1-8-1-1" class="outline-5">
<h5 id="sec-1-8-1-1"><span class="section-number-5">1.8.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-8-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[&#xa0;]</code> Cluster 2
</li>
<li><code>[X]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-2" class="outline-4">
<h4 id="sec-1-8-2"><span class="section-number-4">1.8.2</span> Question b</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
Which k-means cluster best corresponds to the democratic party?
(Remember that we are looking for the names of the key democratic
party leaders.)
</p>
</div>

<div id="outline-container-sec-1-8-2-1" class="outline-5">
<h5 id="sec-1-8-2-1"><span class="section-number-5">1.8.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-8-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[X]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
<li><code>[&#xa0;]</code> Cluster 4
</li>
<li><code>[&#xa0;]</code> Cluster 5
</li>
<li><code>[&#xa0;]</code> Cluster 6
</li>
<li><code>[&#xa0;]</code> Cluster 7
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> <span class="done DONE">DONE</span> Problem 2.3 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-9">
<p>
For the rest of this problem, we'll ask you to compare how
observations were assigned to clusters in the two different
methods. Use the table function to compare the cluster assignment of
hierarchical clustering to the cluster assignment of k-means
clustering.
</p>

<div class="org-src-container">

<pre class="src src-R">table(clusterGroups, kosCluster)
</pre>
</div>

<pre class="example">
             kosCluster
clusterGroups    1    2    3    4    5    6    7
            1    3   11   64 1045   32    0  111
            2    0    0    0    0    0  320    1
            3   85   10   42   79  126    8   24
            4   10    5    0    0    1    0  123
            5   48    0  171  145    3    1   39
            6    0    2    0  712    0    0    0
            7    0  116    0   82    1    0   10
</pre>
</div>

<div id="outline-container-sec-1-9-1" class="outline-4">
<h4 id="sec-1-9-1"><span class="section-number-4">1.9.1</span> Question</h4>
<div class="outline-text-4" id="text-1-9-1">
<p>
Which Hierarchical Cluster best corresponds to K-Means Cluster 2?
</p>
</div>

<div id="outline-container-sec-1-9-1-1" class="outline-5">
<h5 id="sec-1-9-1-1"><span class="section-number-5">1.9.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-9-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Hierarchical Cluster 1
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 2
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 3
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 4
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 5
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 6
</li>

<li><code>[X]</code> Hierarchical Cluster 7
</li>

<li><code>[&#xa0;]</code> No Hierarchical Cluster contains at least half of the points in
K-Means Cluster 2.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
From <code>table(hierGroups, KmeansCluster$cluster)</code>, we read that \(116\)
(\(80.6\%\)) of the observations in K-Means Cluster 2 also fall in
Hierarchical Cluster 7.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> <span class="done DONE">DONE</span> Problem 2.4 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-10">
</div>

<div id="outline-container-sec-1-10-1" class="outline-4">
<h4 id="sec-1-10-1"><span class="section-number-4">1.10.1</span> Question</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
Which Hierarchical Cluster best corresponds to K-Means Cluster 3?
</p>
</div>

<div id="outline-container-sec-1-10-1-1" class="outline-5">
<h5 id="sec-1-10-1-1"><span class="section-number-5">1.10.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-10-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Hierarchical Cluster 1
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 2
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 3
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 4
</li>

<li><code>[X]</code> Hierarchical Cluster 5
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 6
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 7
</li>

<li><code>[&#xa0;]</code> No Hierarchical Cluster contains at least half of the points in
K-Means Cluster 3.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
From <code>table(hierGroups, KmeansCluster$cluster)</code>, we read that \(171\)
(\(61.7\%\)) of the observations in K-Means Cluster 3 also fall in
Hierarchical Cluster 5.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> <span class="done DONE">DONE</span> Problem 2.5 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-11">
</div>

<div id="outline-container-sec-1-11-1" class="outline-4">
<h4 id="sec-1-11-1"><span class="section-number-4">1.11.1</span> Question</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
Which Hierarchical Cluster best corresponds to K-Means Cluster 7?
</p>
</div>

<div id="outline-container-sec-1-11-1-1" class="outline-5">
<h5 id="sec-1-11-1-1"><span class="section-number-5">1.11.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-11-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Hierarchical Cluster 1
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 2
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 3
</li>

<li><code>[X]</code> Hierarchical Cluster 4
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 5
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 6
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 7
</li>

<li><code>[&#xa0;]</code> No Hierarchical Cluster contains at least half of the points in
K-Means Cluster 7.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
From <code>table(hierGroups, KmeansCluster$cluster)</code>, we read that no more
than \(123\) (\(39.9\%\)) of the observations in K-Means Cluster 7 fall in
any hierarchical cluster.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> <span class="done DONE">DONE</span> Problem 2.6 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-1-12">
</div>

<div id="outline-container-sec-1-12-1" class="outline-4">
<h4 id="sec-1-12-1"><span class="section-number-4">1.12.1</span> Question</h4>
<div class="outline-text-4" id="text-1-12-1">
<p>
Which Hierarchical Cluster best corresponds to K-Means Cluster 6?
</p>
</div>

<div id="outline-container-sec-1-12-1-1" class="outline-5">
<h5 id="sec-1-12-1-1"><span class="section-number-5">1.12.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-12-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Hierarchical Cluster 1
</li>

<li><code>[X]</code> Hierarchical Cluster 2
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 3
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 4
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 5
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 6
</li>

<li><code>[&#xa0;]</code> Hierarchical Cluster 7
</li>

<li><code>[&#xa0;]</code> No Hierarchical Cluster contains at least half of the points in
K-Means Cluster 6.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
From <code>table(hierGroups, KmeansCluster$cluster)</code>, we read that \(320\)
(\(97.3\%\)) of observations in K-Means Cluster 6 fall in Hierarchical
Cluster 2.
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Market Segmentation For Airlines <code>[100%]</code></h2>
<div class="outline-text-2" id="text-2">
<p>
Market segmentation is a strategy that divides a broad target market
of customers into smaller, more similar groups, and then designs a
marketing strategy specifically for each group. Clustering is a common
technique for market segmentation since it automatically finds similar
groups given a data set.
</p>

<p>
In this problem, we'll see how clustering can be used to find similar
groups of customers who belong to an airline's frequent flyer
program. The airline is trying to learn more about its customers so
that it can target different customer segments with different types of
mileage offers.
</p>

<p>
The file <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/AirlinesCluster.csv">AirlinesCluster.csv</a> contains information on 3,999 members of
the frequent flyer program. This data comes from the textbook "Data
Mining for Business Intelligence," by Galit Shmueli, Nitin R. Patel,
and Peter C. Bruce. For more information, see the <a href="http://www.dataminingbook.com">website for the book</a>.
</p>

<p>
There are seven different variables in the dataset, described below:
</p>

<ul class="org-ul">
<li><b>Balance</b> = number of miles eligible for award travel
</li>

<li><b>QualMiles</b> = number of miles qualifying for TopFlight status
</li>

<li><b>BonusMiles</b> = number of miles earned from non-flight bonus
transactions in the past 12 months
</li>

<li><b>BonusTrans</b> = number of non-flight bonus transactions in the
past 12 months
</li>

<li><b>FlightMiles</b> = number of flight miles in the past 12 months
</li>

<li><b>FlightTrans</b> = number of flight transactions in the past 12
months
</li>

<li><b>DaysSinceEnroll</b> = number of days since enrolled in the
frequent flyer program
</li>
</ul>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> <span class="done DONE">DONE</span> Problem 1.1 - Normalizing the Data (2 points possible)</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Read the dataset AirlinesCluster.csv into R and call it "airlines".
</p>
</div>

<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> Download the data sets</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/AirlinesCluster.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"AirlinesCluster.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)
<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}
list.files(<span style="color: #ff6a6a;">"../data"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "mvtWeek1.csv"            "NBA_test.csv"
[33] "NBA_train.csv"           "parole.csv"
[35] "pisa2009test.csv"        "pisa2009train.csv"
[37] "PollingData_Imputed.csv" "PollingData.csv"
[39] "ProcterGambleStock.csv"  "quality.csv"
[41] "README.md"               "SampleSubmission.csv"
[43] "songs.csv"               "stevens.csv"
[45] "StocksCluster.csv"       "stopwords.txt"
[47] "tumor.csv"               "tweets.csv"
[49] "USDA.csv"                "WHO_Europe.csv"
[51] "WHO.csv"                 "wiki.csv"
[53] "wine_test.csv"           "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"    Loading data set into their data frame..."</span>)
airlines <span style="color: #db7093;">&lt;-</span> read.table(<span style="color: #ff6a6a;">"../data/AirlinesCluster.csv"</span>, sep = <span style="color: #ff6a6a;">","</span>,
                       header = <span style="color: #3cb371;">TRUE</span>)
summary(airlines)
</pre>
</div>

<pre class="example">
   Loading data set into their data frame...
   Balance          QualMiles         BonusMiles       BonusTrans
Min.   :      0   Min.   :    0.0   Min.   :     0   Min.   : 0.0
1st Qu.:  18528   1st Qu.:    0.0   1st Qu.:  1250   1st Qu.: 3.0
Median :  43097   Median :    0.0   Median :  7171   Median :12.0
Mean   :  73601   Mean   :  144.1   Mean   : 17145   Mean   :11.6
3rd Qu.:  92404   3rd Qu.:    0.0   3rd Qu.: 23800   3rd Qu.:17.0
Max.   :1704838   Max.   :11148.0   Max.   :263685   Max.   :86.0
 FlightMiles       FlightTrans     DaysSinceEnroll
Min.   :    0.0   Min.   : 0.000   Min.   :   2
1st Qu.:    0.0   1st Qu.: 0.000   1st Qu.:2330
Median :    0.0   Median : 0.000   Median :4096
Mean   :  460.1   Mean   : 1.374   Mean   :4119
3rd Qu.:  311.0   3rd Qu.: 1.000   3rd Qu.:5790
Max.   :30817.0   Max.   :53.000   Max.   :8296
</pre>
</div>
</div>

<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span> Question a</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Looking at the summary of airlines, which TWO variables have (on
average) the smallest values?
</p>
</div>

<div id="outline-container-sec-2-1-3-1" class="outline-5">
<h5 id="sec-2-1-3-1"><span class="section-number-5">2.1.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-1-3-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[X]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[X]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2-1-4" class="outline-4">
<h4 id="sec-2-1-4"><span class="section-number-4">2.1.4</span> Question b</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Which TWO variables have (on average) the largest values?
</p>

<ul class="org-ul">
<li><code>[X]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[X]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can read in the data and look at the summary with the following
commands:
</p>

<p>
<code>airlines = read.csv("AirlinesCluster.csv")</code>
</p>

<p>
<code>summary(airlines)</code>
</p>

<p>
For the smallest values, <code>BonusTrans</code> and <code>FlightTrans</code> are on the scale
of tens, whereas all other variables have values in the thousands.
</p>

<p>
For the largest values, <code>Balance</code> and <code>BonusMiles</code> have average values in
the tens of thousands.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> <span class="done DONE">DONE</span> Problem 1.2 - Normalizing the Data (1 point possible)</h3>
<div class="outline-text-3" id="text-2-2">
<p>
In this problem, we will normalize our data before we run the
clustering algorithms. Why is it important to normalize the data
before clustering?
</p>
</div>

<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Answer</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> If we don't normalize the data, the clustering algorithms will
not work (we will get an error in R).
</li>

<li><code>[&#xa0;]</code> If we don't normalize the data, it will be hard to interpret the
results of the clustering.
</li>

<li><code>[X]</code> If we don't normalize the data, the clustering will be dominated
by the variables that are on a larger scale.
</li>

<li><code>[&#xa0;]</code> If we don't normalize the data, the clustering will be dominated
by the variables that are on a smaller scale.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
If we don't normalize the data, the variables that are on a larger
scale will contribute much more to the distance calculation, and thus
will dominate the clustering.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> <span class="done DONE">DONE</span> Problem 1.3 - Normalizing the Data (2 points possible)</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Let's go ahead and normalize our data. You can normalize the variables
in a data frame by using the preProcess function in the "caret"
package. You should already have this package installed from Week 4,
but if not, go ahead and install it with
<code>install.packages("caret")</code>. Then load the package with
<code>library(caret)</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Install new package: caret ..."</span>)
<span style="color: #9932cc;">## </span><span style="color: #ba55d3;">install.packages('caret', repos='http://cran.rstudio.com/')</span>
writeLines(<span style="color: #ff6a6a;">"\n :: NOTE: Please comment after install once..."</span>)

<span style="color: #db7093;">library</span>(caret)
writeLines(<span style="color: #ff6a6a;">"\n :: Library caret loaded..."</span>)
</pre>
</div>

<pre class="example">
 :: Install new package: caret ...

 :: NOTE: Please comment after install once...
Loading required package: lattice
Loading required package: ggplot2

 :: Library caret loaded...
</pre>

<p>
Now, create a normalized data frame called "airlinesNorm" by running
the following commands:
</p>

<p>
The first command pre-processes the data, and the second command
performs the normalization. If you look at the summary of
airlinesNorm, you should see that all of the variables now have mean
zero. You can also see that each of the variables has standard
deviation 1 by using the sd() function.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Preprocessing the data..."</span>)
preproc <span style="color: #db7093;">&lt;-</span> preProcess(airlines)
airlinesNorm <span style="color: #db7093;">&lt;-</span> predict(preproc, airlines)
summary(airlinesNorm)

writeLines(<span style="color: #ff6a6a;">"\n :: Standard deviation of each variable:"</span>)
sd(airlinesNorm$Balance)
sd(airlinesNorm$BonusMiles)
sd(airlinesNorm$BonusTrans)
sd(airlinesNorm$DaysSinceEnroll)
sd(airlinesNorm$FlightMiles)
sd(airlinesNorm$FlightTrans)
sd(airlinesNorm$QualMiles)

writeLines(<span style="color: #ff6a6a;">"\n :: Maximum value in the variable:"</span>)
data.frame(x=sort(sapply(airlinesNorm, max)))

writeLines(<span style="color: #ff6a6a;">"\n :: Minimum value in the variable:"</span>)
data.frame(x=sort(sapply(airlinesNorm, min)))
</pre>
</div>

<pre class="example">
 :: Preprocessing the data...
    Balance          QualMiles         BonusMiles        BonusTrans
 Min.   :-0.7303   Min.   :-0.1863   Min.   :-0.7099   Min.   :-1.20805
 1st Qu.:-0.5465   1st Qu.:-0.1863   1st Qu.:-0.6581   1st Qu.:-0.89568
 Median :-0.3027   Median :-0.1863   Median :-0.4130   Median : 0.04145
 Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000
 3rd Qu.: 0.1866   3rd Qu.:-0.1863   3rd Qu.: 0.2756   3rd Qu.: 0.56208
 Max.   :16.1868   Max.   :14.2231   Max.   :10.2083   Max.   : 7.74673
  FlightMiles       FlightTrans       DaysSinceEnroll
 Min.   :-0.3286   Min.   :-0.36212   Min.   :-1.99336
 1st Qu.:-0.3286   1st Qu.:-0.36212   1st Qu.:-0.86607
 Median :-0.3286   Median :-0.36212   Median :-0.01092
 Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.00000
 3rd Qu.:-0.1065   3rd Qu.:-0.09849   3rd Qu.: 0.80960
 Max.   :21.6803   Max.   :13.61035   Max.   : 2.02284

 :: Standard deviation of each variable:
[1] 1
[1] 1
[1] 1
[1] 1
[1] 1
[1] 1
[1] 1

 :: Maximum value in the variable:
                        x
DaysSinceEnroll  2.022842
BonusTrans       7.746727
BonusMiles      10.208293
FlightTrans     13.610351
QualMiles       14.223084
Balance         16.186811
FlightMiles     21.680292

 :: Minimum value in the variable:
                         x
DaysSinceEnroll -1.9933614
BonusTrans      -1.2080518
Balance         -0.7303482
BonusMiles      -0.7099031
FlightTrans     -0.3621226
FlightMiles     -0.3285622
QualMiles       -0.1862754
</pre>
</div>

<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
In the normalized data, which variable has the largest maximum value?
</p>
</div>

<div id="outline-container-sec-2-3-1-1" class="outline-5">
<h5 id="sec-2-3-1-1"><span class="section-number-5">2.3.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-3-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[X]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
In the normalized data, which variable has the smallest minimum value?
</p>
</div>

<div id="outline-container-sec-2-3-2-1" class="outline-5">
<h5 id="sec-2-3-2-1"><span class="section-number-5">2.3.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-3-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[X]</code> DaysSinceEnroll
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
After running the two lines of code to normalize the data, you can
look at the summary of airlinesNorm with the command:
</p>

<p>
<code>summary(airlinesNorm)</code>
</p>

<p>
You can see from the output that FlightMiles now has the largest
maximum value, and DaysSinceEnroll now has the smallest minimum
value. Note that these were not the variables with the largest and
smallest values in the original dataset airlines.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> <span class="done DONE">DONE</span> Problem 2.1 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Compute the distances between data points (using euclidean distance)
and then run the Hierarchical clustering algorithm (using
method="ward.D") on the normalized data. It may take a few minutes for
the commands to finish since the dataset has a large number of
observations for hierarchical clustering.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Clustering with the hierarchial method..."</span>)
airDist <span style="color: #db7093;">&lt;-</span> dist(airlinesNorm, method = <span style="color: #ff6a6a;">"euclidean"</span>)
airHclust <span style="color: #db7093;">&lt;-</span> hclust(airDist, method = <span style="color: #ff6a6a;">"ward.D"</span>)
</pre>
</div>

<pre class="example">
:: Clustering with the hierarchial method...
</pre>

<p>
Then, plot the dendrogram of the hierarchical clustering
process. Suppose the airline is looking for somewhere between 2 and 10
clusters.
</p>


<div id="fig:AirlinesDendrogram" class="figure">
<p><img src="../graphs/AirlinesDendrogram.png" alt="AirlinesDendrogram.png" />
</p>
<p><span class="figure-number">Figure 3:</span> Airlines dendrogram plot</p>
</div>

<p>
According to the dendrogram, which of the following is NOT a good
choice for the number of clusters?
</p>
</div>

<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> Answer</h4>
<div class="outline-text-4" id="text-2-4-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> 2
</li>
<li><code>[&#xa0;]</code> 3
</li>
<li><code>[X]</code> 6
</li>
<li><code>[&#xa0;]</code> 7
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can plot the dendrogram with the command:
</p>

<p>
<code>plot(hierClust)</code>
</p>

<p>
If you run a horizontal line down the dendrogram, you can see that
there is a long time that the line crosses 2 clusters, 3 clusters, or
7 clusters. However, it it hard to see the horizontal line cross 6
clusters. This means that 6 clusters is probably not a good choice.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> <span class="done DONE">DONE</span> Problem 2.2 - Hierarchical Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Suppose that after looking at the dendrogram and discussing with the
marketing department, the airline decides to proceed with 5
clusters. Divide the data points into 5 clusters by using the cutree
function.
</p>

<div class="org-src-container">

<pre class="src src-R">clusterGroups <span style="color: #db7093;">&lt;-</span> cutree(airHclust, k = 5)
table(clusterGroups)
</pre>
</div>

<pre class="example">
 null device
          1
clusterGroups
   1    2    3    4    5
 776  519  494  868 1342
</pre>

<p>
How many data points are in Cluster 1?
</p>
</div>

<div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> Answer</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
776
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can divide the data points into 5 clusters with the following
command:
</p>

<p>
<code>clusterGroups = cutree(hierClust, k = 5)</code>
</p>

<p>
If you type table(clusterGroups), you can see that there are 776 data
points in the first cluster.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> <span class="done DONE">DONE</span> Problem 2.3 - Hierarchical Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Now, use tapply to compare the average values in each of the variables
for the 5 clusters (the centroids of the clusters). You may want to
compute the average values of the unnormalized data so that it is
easier to interpret. You can do this for the variable "Balance" with
the following command:
</p>

<p>
<code>tapply(airlines$Balance, clusterGroups, mean)</code>
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can compute the average values for all variables in each of the
clusters with the following commands:
</p>

<p>
<code>tapply(airlines$Balance, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$QualMiles, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$BonusMiles, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$BonusTrans, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$FlightMiles, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$FlightTrans, clusterGroups, mean)</code>
</p>

<p>
<code>tapply(airlines$DaysSinceEnroll, clusterGroups, mean)</code>
</p>

<p>
<b>Advanced Explanation</b>:
</p>

<p>
Instead of using tapply, you could have alternatively used colMeans
and subset, as follows:
</p>

<p>
<code>colMeans(subset(airlines, clusterGroups == 1))</code>
</p>

<p>
<code>colMeans(subset(airlines, clusterGroups == 2))</code>
</p>

<p>
<code>colMeans(subset(airlines, clusterGroups == 3))</code>
</p>

<p>
<code>colMeans(subset(airlines, clusterGroups == 4))</code>
</p>

<p>
<code>colMeans(subset(airlines, clusterGroups == 5))</code>
</p>

<p>
This only requires 5 lines of code instead of the 7 above. But an even
more compact way of finding the centroids would be to use the function
"split" to first split the data into clusters, and then to use the
function "lapply" to apply the function "colMeans" to each of the
clusters:
</p>

<p>
<code>lapply(split(airlines, clusterGroups), colMeans)</code>
</p>

<p>
In just one line, you get the same output as you do by running 7 lines
like we do above. To learn more about these functions, type ?split or
?lapply in your R console. Note that if you have a variable named
split in your R session, you will need to remove it with rm(split)
before you can use the split function.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Other way to calculate the same:"</span>)
lapply(split(airlines, clusterGroups), colMeans)
</pre>
</div>

<pre class="example">
 :: Other way to calculate the same:
$`1`
        Balance       QualMiles      BonusMiles      BonusTrans     FlightMiles
   5.786690e+04    6.443299e-01    1.036012e+04    1.082345e+01    8.318428e+01
    FlightTrans DaysSinceEnroll
   3.028351e-01    6.235365e+03

$`2`
        Balance       QualMiles      BonusMiles      BonusTrans     FlightMiles
   1.106693e+05    1.065983e+03    2.288176e+04    1.822929e+01    2.613418e+03
    FlightTrans DaysSinceEnroll
   7.402697e+00    4.402414e+03

$`3`
        Balance       QualMiles      BonusMiles      BonusTrans     FlightMiles
   1.981916e+05    3.034615e+01    5.579586e+04    1.966397e+01    3.276761e+02
    FlightTrans DaysSinceEnroll
   1.068826e+00    5.615709e+03

$`4`
        Balance       QualMiles      BonusMiles      BonusTrans     FlightMiles
   52335.913594        4.847926    20788.766129       17.087558      111.573733
    FlightTrans DaysSinceEnroll
       0.344470     2840.822581

$`5`
        Balance       QualMiles      BonusMiles      BonusTrans     FlightMiles
   3.625591e+04    2.511177e+00    2.264788e+03    2.973174e+00    1.193219e+02
    FlightTrans DaysSinceEnroll
   4.388972e-01    3.060081e+03
</pre>

<p>
A better way to calculate this is:
</p>

<div class="org-src-container">

<pre class="src src-R">out <span style="color: #db7093;">&lt;-</span> data.frame()

<span style="color: #4682b4;">for</span> (n <span style="color: #4682b4;">in</span> names(airlines)) {
  out <span style="color: #db7093;">&lt;-</span> rbind(out, tapply(airlines[,n], clusterGroups, mean))
}

names(out) <span style="color: #db7093;">&lt;-</span> 1:5
out <span style="color: #db7093;">&lt;-</span> data.frame(t(out))
names(out) <span style="color: #db7093;">&lt;-</span> names(airlines)
out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
Compared to the other clusters, Cluster 1 has the largest average
values in which variables (if any)? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-6-1-1" class="outline-5">
<h5 id="sec-2-6-1-1"><span class="section-number-5">2.6.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-6-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[X]</code> DaysSinceEnroll
</li>
<li><code>[&#xa0;]</code> None
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
The only variable for which Cluster 1 has large values is
<code>DaysSinceEnroll</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
How would you describe the customers in Cluster 1?
</p>
</div>

<div id="outline-container-sec-2-6-2-1" class="outline-5">
<h5 id="sec-2-6-2-1"><span class="section-number-5">2.6.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-6-2-1">
<div class="org-src-container">

<pre class="src src-R">out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Relatively new customers who don't use the airline very often. (5)
</li>

<li><code>[X]</code> Infrequent but loyal customers. (1)
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, mostly
through non-flight transactions. (3)
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, and the
ones with the largest number of flight transactions. (2)
</li>

<li><code>[&#xa0;]</code> Relatively new customers who seem to be accumulating miles,
mostly through non-flight transactions. (4)
</li>
</ul>

<p>
<b>Definitions</b>
</p>

<ul class="org-ul">
<li><b>Balance</b> = number of miles eligible for award travel
</li>

<li><b>QualMiles</b> = number of miles qualifying for TopFlight status
</li>

<li><b>BonusMiles</b> = number of miles earned from non-flight bonus
transactions in the past 12 months
</li>

<li><b>BonusTrans</b> = number of non-flight bonus transactions in the past
12 months
</li>

<li><b>FlightMiles</b> = number of flight miles in the past 12 months
</li>

<li><b>FlightTrans</b> = number of flight transactions in the past 12 months
</li>

<li><b>DaysSinceEnroll</b> = number of days since enrolled in the frequent
flyer program
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 1 mostly contains customers with few miles, but who have been
with the airline the longest.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> <span class="done DONE">DONE</span> Problem 2.4 - Hierarchical Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">

<pre class="src src-R">out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>
</div>

<div id="outline-container-sec-2-7-1" class="outline-4">
<h4 id="sec-2-7-1"><span class="section-number-4">2.7.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Compared to the other clusters, Cluster 2 has the largest average
values in which variables (if any)?
</p>

<p>
Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-7-1-1" class="outline-5">
<h5 id="sec-2-7-1-1"><span class="section-number-5">2.7.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-7-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[X]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[X]</code> FlightMiles
</li>
<li><code>[X]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
<li><code>[&#xa0;]</code> None
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 2 has the largest average values in the variables <code>QualMiles</code>,
<code>FlightMiles</code> and <code>FlightTrans</code>. This cluster also has relatively large
values in <code>BonusTrans</code> and <code>Balance</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-7-2" class="outline-4">
<h4 id="sec-2-7-2"><span class="section-number-4">2.7.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
How would you describe the customers in Cluster 2?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Relatively new customers who don't use the airline very often.
</li>

<li><code>[&#xa0;]</code> Infrequent but loyal customers.
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, mostly
through non-flight transactions.
</li>

<li><code>[X]</code> Customers who have accumulated a large amount of miles, and the
ones with the largest number of flight transactions. (2)
</li>

<li><code>[&#xa0;]</code> Relatively new customers who seem to be accumulating miles,
mostly through non-flight transactions.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 2 contains customers with a large amount of miles, mostly
accumulated through flight transactions.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> <span class="done DONE">DONE</span> Problem 2.5 - Hierarchical Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">

<pre class="src src-R">out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>
</div>

<div id="outline-container-sec-2-8-1" class="outline-4">
<h4 id="sec-2-8-1"><span class="section-number-4">2.8.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-8-1">
<p>
Compared to the other clusters, Cluster 3 has the largest average
values in which variables (if any)? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-8-1-1" class="outline-5">
<h5 id="sec-2-8-1-1"><span class="section-number-5">2.8.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-8-1-1">
<ul class="org-ul">
<li><code>[X]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[X]</code> BonusMiles
</li>
<li><code>[X]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
<li><code>[&#xa0;]</code> None
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 3 has the largest values in <code>Balance</code>, <code>BonusMiles</code>, and
<code>BonusTrans</code>. While it also has relatively large values in other
variables, these are the three for which it has the largest values.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-8-2" class="outline-4">
<h4 id="sec-2-8-2"><span class="section-number-4">2.8.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-8-2">
<p>
How would you describe the customers in Cluster 3?
</p>
</div>

<div id="outline-container-sec-2-8-2-1" class="outline-5">
<h5 id="sec-2-8-2-1"><span class="section-number-5">2.8.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-8-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Relatively new customers who don't use the airline very often.
</li>

<li><code>[&#xa0;]</code> Infrequent but loyal customers.
</li>

<li><code>[X]</code> Customers who have accumulated a large amount of miles, mostly
through non-flight transactions. (3)
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, and the
ones with the largest number of flight transactions.
</li>

<li><code>[&#xa0;]</code> Relatively new customers who seem to be accumulating miles,
mostly through non-flight transactions.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 3 mostly contains customers with a lot of miles, and who have
earned the miles mostly through bonus transactions.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9"><span class="section-number-3">2.9</span> <span class="done DONE">DONE</span> Problem 2.6 - Hierarchical Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-2-9">
<div class="org-src-container">

<pre class="src src-R">out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>
</div>

<div id="outline-container-sec-2-9-1" class="outline-4">
<h4 id="sec-2-9-1"><span class="section-number-4">2.9.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-9-1">
<p>
Compared to the other clusters, Cluster 4 has the largest average
values in which variables (if any)? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-9-1-1" class="outline-5">
<h5 id="sec-2-9-1-1"><span class="section-number-5">2.9.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-9-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
<li><code>[X]</code> None
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 4 does not have the largest values in any of the variables.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-9-2" class="outline-4">
<h4 id="sec-2-9-2"><span class="section-number-4">2.9.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-9-2">
<p>
How would you describe the customers in Cluster 4?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Relatively new customers who don't use the airline very often.
</li>

<li><code>[&#xa0;]</code> Infrequent but loyal customers.
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, mostly
through non-flight transactions.
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, and the
ones with the largest number of flight transactions.
</li>

<li><code>[X]</code> Relatively new customers who seem to be accumulating miles,
mostly through non-flight transactions. (4)
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 4 customers have the smallest value in <code>DaysSinceEnroll</code>, but
they are already accumulating a reasonable number of miles.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10"><span class="section-number-3">2.10</span> <span class="done DONE">DONE</span> Problem 2.7 - Hierarchical Clustering (2 points possible)</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">

<pre class="src src-R">out
</pre>
</div>

<pre class="example">
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081
</pre>
</div>

<div id="outline-container-sec-2-10-1" class="outline-4">
<h4 id="sec-2-10-1"><span class="section-number-4">2.10.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-10-1">
<p>
Compared to the other clusters, Cluster 5 has the largest average
values in which variables (if any)? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-10-1-1" class="outline-5">
<h5 id="sec-2-10-1-1"><span class="section-number-5">2.10.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-10-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Balance
</li>
<li><code>[&#xa0;]</code> QualMiles
</li>
<li><code>[&#xa0;]</code> BonusMiles
</li>
<li><code>[&#xa0;]</code> BonusTrans
</li>
<li><code>[&#xa0;]</code> FlightMiles
</li>
<li><code>[&#xa0;]</code> FlightTrans
</li>
<li><code>[&#xa0;]</code> DaysSinceEnroll
</li>
<li><code>[X]</code> None
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 5 does not have the largest values in any of the variables.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-10-2" class="outline-4">
<h4 id="sec-2-10-2"><span class="section-number-4">2.10.2</span> Question b</h4>
<div class="outline-text-4" id="text-2-10-2">
<p>
How would you describe the customers in Cluster 5?
</p>

<ul class="org-ul">
<li><code>[X]</code> Relatively new customers who don't use the airline very often. (5)
</li>

<li><code>[&#xa0;]</code> Infrequent but loyal customers.
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, mostly
through non-flight transactions.
</li>

<li><code>[&#xa0;]</code> Customers who have accumulated a large amount of miles, and the
ones with the largest number of flight transactions.
</li>

<li><code>[&#xa0;]</code> Relatively new customers who seem to be accumulating miles,
mostly through non-flight transactions.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Cluster 5 customers have lower than average values in all variables.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11"><span class="section-number-3">2.11</span> <span class="done DONE">DONE</span> Problem 3.1 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-2-11">
<p>
Now run the k-means clustering algorithm on the normalized data, again
creating 5 clusters. Set the seed to \(88\) right before running the
clustering algorithm, and set the argument <code>iter.max</code> to \(1000\).
</p>

<div class="org-src-container">

<pre class="src src-R">set.seed(88)
airKmeans <span style="color: #db7093;">&lt;-</span> kmeans(airlinesNorm, 5, iter.max = 1000)
airKclust <span style="color: #db7093;">&lt;-</span> airKmeans$cluster
sum(table(airKclust) &gt; 1000)
</pre>
</div>

<pre class="example">
[1] 2
</pre>

<p>
How many clusters have more than 1,000 observations?
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can run the k-means clustering algorithm with the following
commands:
</p>

<p>
<code>set.seed(88)</code>
</p>

<p>
<code>kmeansClust = kmeans(airlinesNorm, centers=5, iter.max=1000)</code>
</p>

<p>
And you can look at the number of observations in each cluster with
the following command:
</p>

<p>
<code>table(kmeansClust$cluster)</code>
</p>

<p>
There are <b>two</b> clusters with more than 1000 observations.
</p>
</div>
</div>

<div id="outline-container-sec-2-12" class="outline-3">
<h3 id="sec-2-12"><span class="section-number-3">2.12</span> <span class="done DONE">DONE</span> Problem 3.2 - K-Means Clustering (1 point possible)</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Now, compare the cluster centroids to each other either by dividing
the data points into groups and then using tapply, or by looking at
the output of <code>kmeansClust$centers</code>, where <code>kmeansClust</code> is the name of
the output of the <code>kmeans</code> function. (Note that the output of
<code>kmeansClust$centers</code> will be for the normalized data. If you want to
look at the average values for the unnormalized data, you need to use
tapply like we did for hierarchical clustering.)
</p>

<div class="org-src-container">

<pre class="src src-R">out2 = data.frame()
<span style="color: #4682b4;">for</span> (n <span style="color: #4682b4;">in</span> names(airlines)) {
  out2 = rbind(out2, tapply(airlines[,n], airKclust, mean))
}
names(out2) = 1:5
out2 = data.frame(t(out2))
names(out2) = names(airlines)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Centroids of hierarchial clustering:"</span>)
out

writeLines(<span style="color: #ff6a6a;">"\n :: Centroids of k-means clustering:"</span>)
out2
</pre>
</div>

<pre class="example">
 :: Centroids of hierarchial clustering:
    Balance    QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1  57866.90    0.6443299  10360.124  10.823454    83.18428   0.3028351
2 110669.27 1065.9826590  22881.763  18.229287  2613.41811   7.4026975
3 198191.57   30.3461538  55795.860  19.663968   327.67611   1.0688259
4  52335.91    4.8479263  20788.766  17.087558   111.57373   0.3444700
5  36255.91    2.5111773   2264.788   2.973174   119.32191   0.4388972
  DaysSinceEnroll
1        6235.365
2        4402.414
3        5615.709
4        2840.823
5        3060.081

 :: Centroids of k-means clustering:
    Balance QualMiles BonusMiles BonusTrans FlightMiles FlightTrans
1 219161.40 539.57843  62474.483  21.524510    623.8725   1.9215686
2 174431.51 673.16312  31985.085  28.134752   5859.2340  17.0000000
3  67977.44  34.99396  24490.019  18.429003    289.4713   0.8851964
4  60166.18  55.20812   8709.712   8.362098    203.2589   0.6294416
5  32706.67 126.46667   3097.478   4.284706    181.4698   0.5403922
  DaysSinceEnroll
1        5605.051
2        4684.901
3        3416.783
4        6109.540
5        2281.055
</pre>
</div>

<div id="outline-container-sec-2-12-1" class="outline-4">
<h4 id="sec-2-12-1"><span class="section-number-4">2.12.1</span> Question</h4>
<div class="outline-text-4" id="text-2-12-1">
<p>
Do you expect Cluster 1 of the K-Means clustering output to
necessarily be similar to Cluster 1 of the Hierarchical clustering
output?
</p>
</div>

<div id="outline-container-sec-2-12-1-1" class="outline-5">
<h5 id="sec-2-12-1-1"><span class="section-number-5">2.12.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-12-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Yes, because the clusters are displayed in order of size, so the
largest cluster will always be first.
</li>

<li><code>[&#xa0;]</code> Yes, because the clusters are displayed according to the
properties of the centroid, so the cluster order will be similar.
</li>

<li><code>[X]</code> No, because cluster ordering is not meaningful in either k-means
clustering or hierarchical clustering.
</li>

<li><code>[&#xa0;]</code> No, because the clusters produced by the k-means algorithm will
never be similar to the clusters produced by the Hierarchical
algorithm.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
The clusters are not displayed in a meaningful order, so while there
may be a cluster produced by the k-means algorithm that is similar to
Cluster 1 produced by the Hierarchical method, it will not necessarily
be shown first.
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Predicting Stock Returns with Cluster-Then-Predict <code>[100%]</code></h2>
<div class="outline-text-2" id="text-3">
<p>
In the second lecture sequence this week, we heard about
cluster-then-predict, a methodology in which you first cluster
observations and then build cluster-specific prediction models. In the
lecture sequence, we saw how this methodology helped improve the
prediction of heart attack risk. In this assignment, we'll use
cluster-then-predict to predict future stock prices using historical
stock data.
</p>

<p>
When selecting which stocks to invest in, investors seek to obtain
good future returns. In this problem, we will first use clustering to
identify clusters of stocks that have similar returns over time. Then,
we'll use logistic regression to predict whether or not the stocks
will have positive future returns.
</p>

<p>
For this problem, we'll use <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/StocksCluster.csv">StocksCluster.csv</a>, which contains monthly
stock returns from the NASDAQ stock exchange. The NASDAQ is the
second-largest stock exchange in the world, and it lists many
technology companies. The stock price data used in this problem was
obtained from <a href="http://www.infochimps.com/datasets/nasdaq-exchange-daily-1970-2010-open-close-high-low-and-volume">infochimps</a>, a website providing access to many datasets.
</p>

<p>
Each observation in the dataset is the monthly returns of a particular
company in a particular year. The years included are 2000-2009. The
companies are limited to tickers that were listed on the exchange for
the entire period 2000-2009, and whose stock price never fell below
$1. So, for example, one observation is for Yahoo in 2000, and another
observation is for Yahoo in 2001. Our goal will be to predict whether
or not the stock return in December will be positive, using the stock
returns for the first 11 months of the year.
</p>

<p>
This dataset contains the following variables:
</p>

<ul class="org-ul">
<li><b>ReturnJan</b> = the return for the company's stock during January (in
the year of the observation).
</li>

<li><b>ReturnFeb</b> = the return for the company's stock during February (in
the year of the observation).
</li>

<li><b>ReturnMar</b> = the return for the company's stock during March (in the
year of the observation).
</li>

<li><b>ReturnApr</b> = the return for the company's stock during April (in
the year of the observation).
</li>

<li><b>ReturnMay</b> = the return for the company's stock during May (in the
year of the observation).
</li>

<li><b>ReturnJune</b> = the return for the company's stock during June (in
the year of the observation).
</li>

<li><b>ReturnJuly</b> = the return for the company's stock during July (in
the year of the observation).
</li>

<li><b>ReturnAug</b> = the return for the company's stock during August (in
the year of the observation).
</li>

<li><b>ReturnSep</b> = the return for the company's stock during September
(in the year of the observation).
</li>

<li><b>ReturnOct</b> = the return for the company's stock during October (in
the year of the observation).
</li>

<li><b>ReturnNov</b> = the return for the company's stock during November (in
the year of the observation).
</li>

<li><b>PositiveDec</b> = whether or not the company's stock had a positive
return in December (in the year of the observation). This variable
takes value 1 if the return was positive, and value 0 if the return
was not positive.
</li>
</ul>

<p>
For the first 11 variables, the value stored is a proportional change
in stock value during that month. For instance, a value of 0.05 means
the stock increased in value 5% during the month, while a value of
-0.02 means the stock decreased in value 2% during the month.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> <span class="done DONE">DONE</span> Problem 1.1 - Exploring the Dataset (1 point possible)</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Load StocksCluster.csv into a data frame called <b>stocks</b>.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Download the data set</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/StocksCluster.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"StocksCluster.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)
<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}
list.files(<span style="color: #ff6a6a;">"../data/"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "mvtWeek1.csv"            "NBA_test.csv"
[33] "NBA_train.csv"           "parole.csv"
[35] "pisa2009test.csv"        "pisa2009train.csv"
[37] "PollingData_Imputed.csv" "PollingData.csv"
[39] "ProcterGambleStock.csv"  "quality.csv"
[41] "README.md"               "SampleSubmission.csv"
[43] "songs.csv"               "stevens.csv"
[45] "StocksCluster.csv"       "stopwords.txt"
[47] "tumor.csv"               "tweets.csv"
[49] "USDA.csv"                "WHO_Europe.csv"
[51] "WHO.csv"                 "wiki.csv"
[53] "wine_test.csv"           "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"    Loading data set into their data frame..."</span>)
stocks <span style="color: #db7093;">&lt;-</span> read.table(<span style="color: #ff6a6a;">"../data/StocksCluster.csv"</span>, sep = <span style="color: #ff6a6a;">","</span>, header = <span style="color: #3cb371;">TRUE</span>)
</pre>
</div>

<pre class="example">
Loading data set into their data frame...
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Question</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
How many observations are in the dataset?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Number of observations in the stock dataframe:"</span>)
nrow(stocks)
</pre>
</div>

<pre class="example">
 :: Number of observations in the stock dataframe:
[1] 11580
</pre>
</div>

<div id="outline-container-sec-3-1-3-1" class="outline-5">
<h5 id="sec-3-1-3-1"><span class="section-number-5">3.1.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-1-3-1">
<p>
<b>Explanation</b>
</p>

<p>
You can load the dataset with the <code>read.csv</code> function:
</p>

<p>
<code>stocks = read.csv("StocksCluster.csv")</code>
</p>

<p>
and see how many observations are included with either the str or nrow
function:
</p>

<p>
<code>str(stocks)</code>
</p>

<p>
<code>nrow(stocks)</code>
</p>

<p>
Both tell us that there are \(11580\) observations in this dataset.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> <span class="done DONE">DONE</span> Problem 1.2 - Exploring the Dataset (1 point possible)</h3>
<div class="outline-text-3" id="text-3-2">
<p>
What proportion of the observations have positive returns in December?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Proportion of positive returns in December:"</span>)
nrow(subset(stocks, stocks$PositiveDec == 1)) / nrow(stocks)

writeLines(<span style="color: #ff6a6a;">"\n :: Other way to calculate the proportion:"</span>)
prop.table(table(stocks$PositiveDec&gt;0))
</pre>
</div>

<pre class="example">
 :: Proportion of positive returns in December:
[1] 0.546114

 :: Other way to calculate the proportion:

   FALSE     TRUE
0.453886 0.546114
</pre>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> <span class="done DONE">DONE</span> Problem 1.3 - Exploring the Dataset (1 point possible)</h3>
<div class="outline-text-3" id="text-3-3">
<p>
What is the maximum correlation between any two return variables in
the dataset? You should look at the pairwise correlations between
ReturnJan, ReturnFeb, ReturnMar, ReturnApr, ReturnMay, ReturnJune,
ReturnJuly, ReturnAug, ReturnSep, ReturnOct, and ReturnNov.
</p>
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> Answer</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Install new package: corrplot ..."</span>)
<span style="color: #9932cc;">## </span><span style="color: #ba55d3;">install.packages('corrplot', repos='http://cran.rstudio.com/')</span>
writeLines(<span style="color: #ff6a6a;">"\n :: NOTE: Please comment after install once..."</span>)

<span style="color: #db7093;">library</span>(corrplot)
writeLines(<span style="color: #ff6a6a;">"\n :: Library corrplot loaded..."</span>)
</pre>
</div>

<pre class="example">
:: Install new package: corrplot ...

:: NOTE: Please comment after install once...

:: Library corrplot loaded...
</pre>


<div id="fig:StocksCorrelationPlot" class="figure">
<p><img src="../graphs/StocksCorrelationPlot.png" alt="StocksCorrelationPlot.png" />
</p>
<p><span class="figure-number">Figure 4:</span> Stocks dataframe correlation plot</p>
</div>

<div class="org-src-container">

<pre class="src src-R">head(sort(abs(cor(stocks)), decreasing = <span style="color: #3cb371;">TRUE</span>), 20)
</pre>
</div>

<pre class="example">
 null device
          1
 [1] 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
 [8] 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 0.1916728 0.1916728
[15] 0.1913519 0.1913519 0.1699945 0.1699945 0.1559833 0.1559833
</pre>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Correlation between stocks features:"</span>)
cor(stocks)
</pre>
</div>

<pre class="example">
 :: Correlation between stocks features:
               ReturnJan   ReturnFeb    ReturnMar    ReturnApr    ReturnMay
ReturnJan    1.000000000  0.06677458 -0.090496798 -0.037678006 -0.044411417
ReturnFeb    0.066774583  1.00000000 -0.155983263 -0.191351924 -0.095520920
ReturnMar   -0.090496798 -0.15598326  1.000000000  0.009726288 -0.003892789
ReturnApr   -0.037678006 -0.19135192  0.009726288  1.000000000  0.063822504
ReturnMay   -0.044411417 -0.09552092 -0.003892789  0.063822504  1.000000000
ReturnJune   0.092238307  0.16999448 -0.085905486 -0.011027752 -0.021074539
ReturnJuly  -0.081429765 -0.06177851  0.003374160  0.080631932  0.090850264
ReturnAug   -0.022792019  0.13155979 -0.022005400 -0.051756051 -0.033125658
ReturnSep   -0.026437153  0.04350177  0.076518327 -0.028920972  0.021962862
ReturnOct    0.142977229 -0.08732427 -0.011923758  0.048540025  0.017166728
ReturnNov    0.067632333 -0.15465828  0.037323535  0.031761837  0.048046590
PositiveDec  0.004728518 -0.03817318  0.022408661  0.094353528  0.058201934
             ReturnJune    ReturnJuly     ReturnAug     ReturnSep   ReturnOct
ReturnJan    0.09223831 -0.0814297650 -0.0227920187 -0.0264371526  0.14297723
ReturnFeb    0.16999448 -0.0617785094  0.1315597863  0.0435017706 -0.08732427
ReturnMar   -0.08590549  0.0033741597 -0.0220053995  0.0765183267 -0.01192376
ReturnApr   -0.01102775  0.0806319317 -0.0517560510 -0.0289209718  0.04854003
ReturnMay   -0.02107454  0.0908502642 -0.0331256580  0.0219628623  0.01716673
ReturnJune   1.00000000 -0.0291525996  0.0107105260  0.0447472692 -0.02263599
ReturnJuly  -0.02915260  1.0000000000  0.0007137558  0.0689478037 -0.05470891
ReturnAug    0.01071053  0.0007137558  1.0000000000  0.0007407139 -0.07559456
ReturnSep    0.04474727  0.0689478037  0.0007407139  1.0000000000 -0.05807924
ReturnOct   -0.02263599 -0.0547089088 -0.0755945614 -0.0580792362  1.00000000
ReturnNov   -0.06527054 -0.0483738369 -0.1164890345 -0.0197197998  0.19167279
PositiveDec  0.02340975  0.0743642097  0.0041669657  0.0416302863 -0.05257496
              ReturnNov  PositiveDec
ReturnJan    0.06763233  0.004728518
ReturnFeb   -0.15465828 -0.038173184
ReturnMar    0.03732353  0.022408661
ReturnApr    0.03176184  0.094353528
ReturnMay    0.04804659  0.058201934
ReturnJune  -0.06527054  0.023409745
ReturnJuly  -0.04837384  0.074364210
ReturnAug   -0.11648903  0.004166966
ReturnSep   -0.01971980  0.041630286
ReturnOct    0.19167279 -0.052574956
ReturnNov    1.00000000 -0.062346556
PositiveDec -0.06234656  1.000000000
</pre>

<p>
<b>Explanation</b>
</p>

<p>
From cor(stocks), we see the largest correlation coefficient is
0.19167279, between ReturnOct and ReturnNov.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> <span class="done DONE">DONE</span> Problem 1.4 - Exploring the Dataset (2 points possible)</h3>
<div class="outline-text-3" id="text-3-4">
</div>

<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> Question a</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
Which month (from January through November) has the largest mean
return across all observations in the dataset?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Means by feature:"</span>)
sort(colMeans(stocks[1:11]), decreasing = <span style="color: #3cb371;">TRUE</span>)
</pre>
</div>

<pre class="example">
:: Means by feature:
  ReturnApr    ReturnMay    ReturnMar    ReturnAug    ReturnJan    ReturnNov
0.026308147  0.024736591  0.019402336  0.016198265  0.012631602  0.011387440
 ReturnJune    ReturnOct   ReturnJuly    ReturnFeb    ReturnSep
0.005937902  0.005650844  0.003050863 -0.007604784 -0.014720768
</pre>
</div>

<div id="outline-container-sec-3-4-1-1" class="outline-5">
<h5 id="sec-3-4-1-1"><span class="section-number-5">3.4.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-4-1-1">
<p>
<b>April</b>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Question b</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
Which month (from January through November) has the smallest mean
return across all observations in the dataset?
</p>
</div>

<div id="outline-container-sec-3-4-2-1" class="outline-5">
<h5 id="sec-3-4-2-1"><span class="section-number-5">3.4.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-4-2-1">
<p>
<b>September</b>
</p>

<p>
<b>Explanation</b>
</p>

<p>
These can be determined using the summary function:
</p>

<p>
<code>summary(stocks)</code>
</p>

<p>
If you look at the mean value for each variable, you can see that
April has the largest mean value (0.026308), and September has the
smallest mean value (-0.014721).
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> <span class="done DONE">DONE</span> Problem 2.1 - Initial Logistic Regression Model (2 points possible)</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Run the following commands to split the data into a training set and
testing set, putting 70% of the data in the training set and 30% of
the data in the testing set:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Initial logistic regression model..."</span>)
<span style="color: #db7093;">library</span>(caTools)
set.seed(144)
spl <span style="color: #db7093;">&lt;-</span> sample.split(stocks$PositiveDec, SplitRatio = 0.7)
stocksTrain <span style="color: #db7093;">&lt;-</span> subset(stocks, spl == <span style="color: #3cb371;">TRUE</span>)
stocksTest <span style="color: #db7093;">&lt;-</span> subset(stocks, spl == <span style="color: #3cb371;">FALSE</span>)
</pre>
</div>

<pre class="example">
:: Initial logistic regression model...
</pre>

<p>
Then, use the stocksTrain data frame to train a logistic regression
model (name it StocksModel) to predict PositiveDec using all the other
variables as independent variables. Don't forget to add the argument
family=binomial to your glm command.
</p>

<div class="org-src-container">

<pre class="src src-R">StocksModel <span style="color: #db7093;">&lt;-</span> glm(PositiveDec  ~ ., stocksTrain, family = <span style="color: #ff6a6a;">"binomial"</span>)
StocksModelPred <span style="color: #db7093;">&lt;-</span> predict(StocksModel, stocksTrain, type = <span style="color: #ff6a6a;">"response"</span>)
ct <span style="color: #db7093;">&lt;-</span> table(stocksTrain$PositiveDec, StocksModelPred &gt;= 0.5)
(ct[1, 1] + ct[2, 2])/ nrow(stocksTrain)
</pre>
</div>

<pre class="example">
[1] 0.5711818
</pre>

<p>
What is the overall accuracy on the training set, using a threshold of
0.5?
</p>
</div>

<div id="outline-container-sec-3-5-1" class="outline-4">
<h4 id="sec-3-5-1"><span class="section-number-4">3.5.1</span> Answer</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
0.5711818
</p>

<p>
<b>Explanation</b>
</p>

<p>
We can train the model with:
</p>

<p>
<code>StocksModel = glm(PositiveDec ~ ., data=stocksTrain, family = binomial)</code>
</p>

<p>
Then, we can compute our predictions on the training set with:
</p>

<p>
<code>PredictTrain = predict(StocksModel, type="response")</code>
</p>

<p>
And construct a classification matrix with the table function:
</p>

<p>
<code>table(stocksTrain$PositiveDec, PredictTrain &gt; 0.5)</code>
</p>

<p>
The overall accuracy of the model is
</p>

<p>
$$
\frac{(990 + 3640)}{(990 + 2689 + 787 + 3640)} = 0.571
$$
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> <span class="done DONE">DONE</span> Problem 2.2 - Initial Logistic Regression Model (1 point possible)</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Now obtain test set predictions from StocksModel. What is the overall
accuracy of the model on the test, again using a threshold of 0.5?
</p>

<div class="org-src-container">

<pre class="src src-R">StocksModelPredTest <span style="color: #db7093;">&lt;-</span> predict(StocksModel, stocksTest, type = <span style="color: #ff6a6a;">"response"</span>)
ct = table(stocksTest$PositiveDec, StocksModelPredTest &gt;= 0.5)

writeLines(<span style="color: #ff6a6a;">"\n :: The overall accuracy un the testing set is:"</span>)
(ct[1, 1] + ct[2, 2]) / nrow(stocksTest)
</pre>
</div>

<pre class="example">
 :: The overall accuracy un the testing set is:
[1] 0.5670697
</pre>
</div>
</div>

<div id="outline-container-sec-3-7" class="outline-3">
<h3 id="sec-3-7"><span class="section-number-3">3.7</span> <span class="done DONE">DONE</span> Problem 2.3 - Initial Logistic Regression Model (1 point possible)</h3>
<div class="outline-text-3" id="text-3-7">
<p>
What is the accuracy on the test set of a baseline model that always
predicts the most common outcome (PositiveDec = 1)?
</p>

<div class="org-src-container">

<pre class="src src-R">sort(table(stocksTrain$PositiveDec))
writeLines(<span style="color: #ff6a6a;">"\n :: The baseline accuracy in the testing set:"</span>)
sum(stocksTest$PositiveDec == 1) / nrow(stocksTest)
</pre>
</div>

<pre class="example">
   0    1
3679 4427

 :: The baseline accuracy in the testing set:
[1] 0.5460564
</pre>

<p>
<b>Explanation</b>
</p>

<p>
This can be computed by making a table of the outcome variable in the
test set:
</p>

<p>
<code>table(stocksTest$PositiveDec)</code>
</p>

<p>
The baseline model would get all of the PositiveDec = 1 cases correct,
and all of the PositiveDec = 0 cases wrong, for an accuracy of
</p>

<p>
$$
\frac{1897}{(1577 + 1897)} = 0.5460564
$$
</p>
</div>
</div>

<div id="outline-container-sec-3-8" class="outline-3">
<h3 id="sec-3-8"><span class="section-number-3">3.8</span> <span class="done DONE">DONE</span> Problem 3.1 - Clustering Stocks (1 point possible)</h3>
<div class="outline-text-3" id="text-3-8">
<p>
Now, let's cluster the stocks. The first step in this process is to
remove the dependent variable using the following commands:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Cleaning the outcome feature for clustering purposes..."</span>)
limitedTrain <span style="color: #db7093;">&lt;-</span> stocksTrain
limitedTrain$PositiveDec = <span style="color: #3cb371;">NULL</span>

limitedTest <span style="color: #db7093;">&lt;-</span> stocksTest
limitedTest$PositiveDec = <span style="color: #3cb371;">NULL</span>
</pre>
</div>

<pre class="example">
:: Cleaning the outcome feature for clustering purposes...
</pre>
</div>

<div id="outline-container-sec-3-8-1" class="outline-4">
<h4 id="sec-3-8-1"><span class="section-number-4">3.8.1</span> Question</h4>
<div class="outline-text-4" id="text-3-8-1">
<p>
Why do we need to remove the dependent variable in the clustering
phase of the cluster-then-predict methodology?
</p>
</div>

<div id="outline-container-sec-3-8-1-1" class="outline-5">
<h5 id="sec-3-8-1-1"><span class="section-number-5">3.8.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-8-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Leaving in the dependent variable might lead to unbalanced
clusters
</li>

<li><code>[&#xa0;]</code> Removing the dependent variable decreases the computational
effort needed to cluster
</li>

<li><code>[X]</code> Needing to know the dependent variable value to assign an
observation to a cluster defeats the purpose of the methodology
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
In cluster-then-predict, our final goal is to predict the dependent
variable, which is unknown to us at the time of prediction. Therefore,
if we need to know the outcome value to perform the clustering, the
methodology is no longer useful for prediction of an unknown outcome
value.
</p>

<p>
This is an important point that is sometimes mistakenly overlooked. If
you use the outcome value to cluster, you might conclude your method
strongly outperforms a non-clustering alternative. However, this is
because it is using the outcome to determine the clusters, which is
not valid.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-9" class="outline-3">
<h3 id="sec-3-9"><span class="section-number-3">3.9</span> <span class="done DONE">DONE</span> Problem 3.2 - Clustering Stocks (2 points possible)</h3>
<div class="outline-text-3" id="text-3-9">
<p>
In the market segmentation assignment in this week's homework, you
were introduced to the preProcess command from the caret package,
which normalizes variables by subtracting by the mean and dividing by
the standard deviation.
</p>

<p>
In cases where we have a training and testing set, we'll want to
normalize by the mean and standard deviation of the variables in the
training set. We can do this by passing just the training set to the
preProcess function:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Preprocessing to normalization purposes.."</span>)
<span style="color: #db7093;">library</span>(caret)
preproc <span style="color: #db7093;">&lt;-</span> preProcess(limitedTrain)
normTrain <span style="color: #db7093;">&lt;-</span> predict(preproc, limitedTrain)
normTest <span style="color: #db7093;">&lt;-</span> predict(preproc, limitedTest)
</pre>
</div>

<pre class="example">
:: Preprocessing to normalization purposes..
</pre>
</div>

<div id="outline-container-sec-3-9-1" class="outline-4">
<h4 id="sec-3-9-1"><span class="section-number-4">3.9.1</span> Question a</h4>
<div class="outline-text-4" id="text-3-9-1">
<p>
What is the mean of the ReturnJan variable in normTrain?
</p>
</div>

<div id="outline-container-sec-3-9-1-1" class="outline-5">
<h5 id="sec-3-9-1-1"><span class="section-number-5">3.9.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-9-1-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The mean of the ReturnJan feature in the training set:"</span>)
mean(normTrain$ReturnJan)
</pre>
</div>

<pre class="example">
 :: The mean of the ReturnJan feature in the training set:
[1] 2.100586e-17
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-9-2" class="outline-4">
<h4 id="sec-3-9-2"><span class="section-number-4">3.9.2</span> Question b</h4>
<div class="outline-text-4" id="text-3-9-2">
<p>
What is the mean of the ReturnJan variable in normTest?
</p>
</div>

<div id="outline-container-sec-3-9-2-1" class="outline-5">
<h5 id="sec-3-9-2-1"><span class="section-number-5">3.9.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-9-2-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The mean of the ReturnJan feature in the testing set:"</span>)
mean(normTest$ReturnJan)
</pre>
</div>

<pre class="example">
 :: The mean of the ReturnJan feature in the testing set:
[1] -0.0004185886
</pre>

<p>
<b>Explanation</b>
</p>

<p>
After running the provided normalization commands, we can read the
means with mean(normTrain$ReturnJan) and mean(normTest$ReturnJan).
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-10" class="outline-3">
<h3 id="sec-3-10"><span class="section-number-3">3.10</span> <span class="done DONE">DONE</span> Problem 3.3 - Clustering Stocks (1 point possible)</h3>
<div class="outline-text-3" id="text-3-10">
<p>
Why is the mean ReturnJan variable much closer to 0 in normTrain than
in normTest?
</p>
</div>

<div id="outline-container-sec-3-10-1" class="outline-4">
<h4 id="sec-3-10-1"><span class="section-number-4">3.10.1</span> Answer</h4>
<div class="outline-text-4" id="text-3-10-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Small rounding errors exist in the normalization procedure
</li>

<li><code>[X]</code> The distribution of the ReturnJan variable is different in the
training and testing set
</li>

<li><code>[&#xa0;]</code> The distribution of the dependent variable is different in the
training and testing set
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
From <code>mean(stocksTrain$ReturnJan)</code> and <code>mean(stocksTest$ReturnJan)</code>,
we see that the average return in January is slightly higher in the
training set than in the testing set. Since <code>normTest</code> was constructed
by subtracting by the mean <code>ReturnJan</code> value from the training set, this
explains why the mean value of <code>ReturnJan</code> is slightly negative in
<code>normTest</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-11" class="outline-3">
<h3 id="sec-3-11"><span class="section-number-3">3.11</span> <span class="done DONE">DONE</span> Problem 3.4 - Clustering Stocks (1 point possible)</h3>
<div class="outline-text-3" id="text-3-11">
<p>
Set the random seed to 144 (it is important to do this again, even
though we did it earlier). Run k-means clustering with 3 clusters on
normTrain, storing the result in an object called <code>km</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">set.seed(144)
km <span style="color: #db7093;">&lt;-</span> kmeans(normTrain, 3)
kmClust <span style="color: #db7093;">&lt;-</span> km$cluster
table(kmClust)
</pre>
</div>

<pre class="example">
kmClust
   1    2    3
3157 4696  253
</pre>
</div>

<div id="outline-container-sec-3-11-1" class="outline-4">
<h4 id="sec-3-11-1"><span class="section-number-4">3.11.1</span> Question</h4>
<div class="outline-text-4" id="text-3-11-1">
<p>
Which cluster has the largest number of observations?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Cluster 1
</li>
<li><code>[X]</code> Cluster 2
</li>
<li><code>[&#xa0;]</code> Cluster 3
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
We can set the seed and run the k-means algorithm with:
</p>

<p>
<code>set.seed(144)</code>
</p>

<p>
<code>km = kmeans(normTrain, centers = 3)</code>
</p>

<p>
From <code>table(km$cluster)</code>, we can see that cluster 2 has the largest
number of observations. Alternatively, you can see the number of
observations in each cluster by typing km$size in your console.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-12" class="outline-3">
<h3 id="sec-3-12"><span class="section-number-3">3.12</span> <span class="done DONE">DONE</span> Problem 3.5 - Clustering Stocks (1 point possible)</h3>
<div class="outline-text-3" id="text-3-12">
<p>
Recall from the recitation that we can use the flexclust package to
obtain training set and testing set cluster assignments for our
observations (note that the call to as.kcca may take a while to
complete):
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(flexclust)
km.kcca <span style="color: #db7093;">&lt;-</span> as.kcca(km, normTrain)
clusterTrain <span style="color: #db7093;">&lt;-</span> predict(km.kcca)
clusterTest <span style="color: #db7093;">&lt;-</span> predict(km.kcca, newdata=normTest)

writeLines(<span style="color: #ff6a6a;">"\n :: The number of observations in the cluster 2 of the testing set:"</span>)
table(clusterTest)
</pre>
</div>

<pre class="example">
Loading required package: grid
Loading required package: modeltools
Loading required package: stats4

 :: The number of observations in the cluster 2 of the testing set:
clusterTest
   1    2    3
1298 2080   96
</pre>
</div>

<div id="outline-container-sec-3-12-1" class="outline-4">
<h4 id="sec-3-12-1"><span class="section-number-4">3.12.1</span> Question</h4>
<div class="outline-text-4" id="text-3-12-1">
<p>
How many test-set observations were assigned to Cluster 2?
</p>
</div>

<div id="outline-container-sec-3-12-1-1" class="outline-5">
<h5 id="sec-3-12-1-1"><span class="section-number-5">3.12.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-12-1-1">
<p>
2080
</p>

<p>
<b>Explanation</b>
</p>

<p>
After running the provided commands, we can obtain the breakdown of
the testing set clusters with <code>table(clusterTest)</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-13" class="outline-3">
<h3 id="sec-3-13"><span class="section-number-3">3.13</span> <span class="done DONE">DONE</span> Problem 4.1 - Cluster-Specific Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-3-13">
<p>
Using the <code>subset</code> function, build data frames <code>stocksTrain1</code>,
<code>stocksTrain2</code>, and <code>stocksTrain3</code>, containing the elements in the
<code>stocksTrain</code> data frame assigned to clusters 1, 2, and 3,
respectively (be careful to take subsets of <code>stocksTrain</code>, not of
<code>normTrain</code>). Similarly build <code>stocksTest1</code>, <code>stocksTest2</code>, and
<code>stocksTest3</code> from the stocksTest data frame.
</p>

<p>
Which training set data frame has the highest average value of the
dependent variable?
</p>

<div class="org-src-container">

<pre class="src src-R">stocksTrain1 <span style="color: #db7093;">&lt;-</span> subset(stocksTrain, clusterTrain == 1)
stocksTest1  <span style="color: #db7093;">&lt;-</span> subset(stocksTest,  clusterTest == 1)
stocksTrain2 <span style="color: #db7093;">&lt;-</span> subset(stocksTrain, clusterTrain == 2)
stocksTest2  <span style="color: #db7093;">&lt;-</span> subset(stocksTest,  clusterTest == 2)
stocksTrain3 <span style="color: #db7093;">&lt;-</span> subset(stocksTrain, clusterTrain == 3)
stocksTest3  <span style="color: #db7093;">&lt;-</span> subset(stocksTest,  clusterTest == 3)
sort(tapply(stocksTrain$PositiveDec, clusterTrain, mean))
</pre>
</div>

<pre class="example">
        3         2         1
0.4387352 0.5140545 0.6024707
</pre>

<p>
<b>Explanation</b>
</p>

<p>
We can obtain the necessary subsets with:
</p>

<p>
<code>stocksTrain1 = subset(stocksTrain, clusterTrain == 1)</code>
</p>

<p>
<code>stocksTrain2 = subset(stocksTrain, clusterTrain == 2)</code>
</p>

<p>
<code>stocksTrain3 = subset(stocksTrain, clusterTrain == 3)</code>
</p>

<p>
<code>stocksTest1 = subset(stocksTest, clusterTest == 1)</code>
</p>

<p>
<code>stocksTest2 = subset(stocksTest, clusterTest == 2)</code>
</p>

<p>
<code>stocksTest3 = subset(stocksTest, clusterTest == 3)</code>
</p>

<p>
From <code>mean(stocksTrain1$PositiveDec)</code>,
<code>mean(stocksTrain2$PositiveDec)</code>, and
<code>mean(stocksTrain3$PositiveDec)</code>, we see that <code>stocksTrain1</code> has the
observations with the highest average value of the dependent
variable.
</p>
</div>
</div>

<div id="outline-container-sec-3-14" class="outline-3">
<h3 id="sec-3-14"><span class="section-number-3">3.14</span> <span class="done DONE">DONE</span> Problem 4.2 - Cluster-Specific Predictions (2 points possible)</h3>
<div class="outline-text-3" id="text-3-14">
<p>
Build logistic regression models <code>StocksModel1</code>, <code>StocksModel2</code>, and
<code>StocksModel3</code>, which predict <code>PositiveDec</code>  using all the other
variables as independent variables. <code>StocksModel1</code> should be trained
on <code>stocksTrain1</code>, <code>StocksModel2</code> should be trained on <code>stocksTrain2</code>,
and <code>StocksModel3</code> should be trained on <code>stocksTrain3</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">StocksModel1 <span style="color: #db7093;">&lt;-</span> glm(PositiveDec ~ ., stocksTrain1, family = <span style="color: #ff6a6a;">"binomial"</span>)
StocksModel2 <span style="color: #db7093;">&lt;-</span> glm(PositiveDec ~ ., stocksTrain2, family = <span style="color: #ff6a6a;">"binomial"</span>)
StocksModel3 <span style="color: #db7093;">&lt;-</span> glm(PositiveDec ~ ., stocksTrain3, family = <span style="color: #ff6a6a;">"binomial"</span>)
sort( (StocksModel1$coef &gt; 0 | StocksModel2$coef &gt; 0 |
       StocksModel3$coef &gt; 0) &amp; (StocksModel1$coef &lt; 0 |
                               StocksModel2$coef &lt; 0 |
                               StocksModel3$coef &lt; 0))
</pre>
</div>

<pre class="example">
ReturnApr   ReturnMay  ReturnJuly   ReturnSep   ReturnNov (Intercept)
    FALSE       FALSE       FALSE       FALSE       FALSE        TRUE
ReturnJan   ReturnFeb   ReturnMar  ReturnJune   ReturnAug   ReturnOct
     TRUE        TRUE        TRUE        TRUE        TRUE        TRUE
</pre>
</div>

<div id="outline-container-sec-3-14-1" class="outline-4">
<h4 id="sec-3-14-1"><span class="section-number-4">3.14.1</span> Question</h4>
<div class="outline-text-4" id="text-3-14-1">
<p>
Which variables have a positive sign for the coefficient in at least
one of <code>StocksModel1</code>, <code>StocksModel2</code>, and <code>StocksModel3</code> and a
negative sign for the coefficient in at least one of <code>StocksModel1</code>,
<code>StocksModel2</code>, and <code>StocksModel3</code>? Select all that apply.
</p>
</div>

<div id="outline-container-sec-3-14-1-1" class="outline-5">
<h5 id="sec-3-14-1-1"><span class="section-number-5">3.14.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-14-1-1">
<ul class="org-ul">
<li><code>[X]</code> ReturnJan
</li>
<li><code>[X]</code> ReturnFeb
</li>
<li><code>[X]</code> ReturnMar
</li>
<li><code>[&#xa0;]</code> ReturnApr
</li>
<li><code>[&#xa0;]</code> ReturnMay
</li>
<li><code>[X]</code> ReturnJune
</li>
<li><code>[&#xa0;]</code> ReturnJuly
</li>
<li><code>[X]</code> ReturnAug
</li>
<li><code>[&#xa0;]</code> ReturnSep
</li>
<li><code>[X]</code> ReturnOct
</li>
<li><code>[&#xa0;]</code> ReturnNov
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
We can build the models with:
</p>

<p>
<code>StocksModel1 = glm(PositiveDec ~ ., data=stocksTrain1, family=binomial)</code>
</p>

<p>
<code>StocksModel2 = glm(PositiveDec ~ ., data=stocksTrain2, family=binomial)</code>
</p>

<p>
<code>StocksModel3 = glm(PositiveDec ~ ., data=stocksTrain3, family=binomial)</code>
</p>

<p>
From <code>summary(StocksModel1)</code>, <code>summary(StocksModel2)</code>, and
<code>summary(StocksModel3)</code>, <code>ReturnJan</code>, <code>ReturnFeb</code>, <code>ReturnMar</code>, <code>ReturnJune</code>,
<code>ReturnAug</code>, and <code>ReturnOct</code> differ in sign between the models.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-15" class="outline-3">
<h3 id="sec-3-15"><span class="section-number-3">3.15</span> <span class="done DONE">DONE</span> Problem 4.3 - Cluster-Specific Predictions (6 points possible)</h3>
<div class="outline-text-3" id="text-3-15">
<p>
Using <code>StocksModel1</code>, make test-set predictions called <code>PredictTest1</code>
on the data frame <code>stocksTest1</code>. Using <code>StocksModel2</code>, make test-set
predictions called <code>PredictTest2</code> on the data frame
<code>stocksTest2</code>. Using <code>StocksModel3</code>, make test-set predictions called
<code>PredictTest3</code> on the data frame <code>stocksTest3</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Predicting in the testing set..."</span>)
PredictTest1 <span style="color: #db7093;">&lt;-</span> predict(StocksModel1, stocksTest1, type=<span style="color: #ff6a6a;">"response"</span>)
PredictTest2 <span style="color: #db7093;">&lt;-</span> predict(StocksModel2, stocksTest2, type=<span style="color: #ff6a6a;">"response"</span>)
PredictTest3 <span style="color: #db7093;">&lt;-</span> predict(StocksModel3, stocksTest3, type=<span style="color: #ff6a6a;">"response"</span>)

writeLines(<span style="color: #ff6a6a;">"\n :: Overall accuracy for each model 1:"</span>)
ct1 <span style="color: #db7093;">&lt;-</span> table(stocksTest1$PositiveDec, PredictTest1&gt;=0.5)
(ct1[1,1]+ct1[2,2])/nrow(stocksTest1)

writeLines(<span style="color: #ff6a6a;">"\n :: Overall accuracy for each model 2:"</span>)
ct2 <span style="color: #db7093;">&lt;-</span> table(stocksTest2$PositiveDec, PredictTest2&gt;=0.5)
(ct2[1,1]+ct2[2,2])/nrow(stocksTest2)

writeLines(<span style="color: #ff6a6a;">"\n :: Overall accuracy for each model 3:"</span>)
ct3 <span style="color: #db7093;">&lt;-</span> table(stocksTest3$PositiveDec, PredictTest3&gt;=0.5)
(ct3[1,1]+ct3[2,2])/nrow(stocksTest3)
</pre>
</div>

<pre class="example">
 :: Predicting in the testing set...

 :: Overall accuracy for each model 1:
[1] 0.6194145

 :: Overall accuracy for each model 2:
[1] 0.5504808

 :: Overall accuracy for each model 3:
[1] 0.6458333
</pre>
</div>

<div id="outline-container-sec-3-15-1" class="outline-4">
<h4 id="sec-3-15-1"><span class="section-number-4">3.15.1</span> Question a</h4>
<div class="outline-text-4" id="text-3-15-1">
<p>
What is the overall accuracy of <code>StocksModel1</code> on the test set
<code>stocksTest1</code>, using a threshold of 0.5?
</p>
</div>

<div id="outline-container-sec-3-15-1-1" class="outline-5">
<h5 id="sec-3-15-1-1"><span class="section-number-5">3.15.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-15-1-1">
<p>
0.6194145
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-15-2" class="outline-4">
<h4 id="sec-3-15-2"><span class="section-number-4">3.15.2</span> Question b</h4>
<div class="outline-text-4" id="text-3-15-2">
<p>
What is the overall accuracy of <code>StocksModel2</code> on the test set
<code>stocksTest2</code>, using a threshold of 0.5?
</p>
</div>

<div id="outline-container-sec-3-15-2-1" class="outline-5">
<h5 id="sec-3-15-2-1"><span class="section-number-5">3.15.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-15-2-1">
<p>
0.5504808
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-15-3" class="outline-4">
<h4 id="sec-3-15-3"><span class="section-number-4">3.15.3</span> Question c</h4>
<div class="outline-text-4" id="text-3-15-3">
<p>
What is the overall accuracy of <code>StocksModel3</code> on the test set
<code>stocksTest3</code>, using a threshold of 0.5?
</p>
</div>

<div id="outline-container-sec-3-15-3-1" class="outline-5">
<h5 id="sec-3-15-3-1"><span class="section-number-5">3.15.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-3-15-3-1">
<p>
0.6458333
</p>

<p>
<b>Explanation</b>
</p>

<p>
The predictions can be obtained with:
</p>

<p>
<code>PredictTest1 = predict(StocksModel1, newdata = stocksTest1, type="response")</code>
</p>

<p>
<code>PredictTest2 = predict(StocksModel2, newdata = stocksTest2, type="response")</code>
</p>

<p>
<code>PredictTest3 = predict(StocksModel3, newdata = stocksTest3, type="response")</code>
</p>

<p>
And the classification matrices can be computed with:
</p>

<p>
<code>table(stocksTest1$PositiveDec, PredictTest1 &gt; 0.5)</code>
</p>

<p>
<code>table(stocksTest2$PositiveDec, PredictTest2 &gt; 0.5)</code>
</p>

<p>
<code>table(stocksTest3$PositiveDec, PredictTest3 &gt; 0.5)</code>
</p>

<p>
The overall accuracy of <code>StocksModel1</code> is
</p>

<p>
$$
\frac{(30 + 774)}{(30 + 471 + 23 + 774)} = 0.6194145
$$
</p>

<p>
the overall accuracy of <code>StocksModel2</code> is
</p>

<p>
$$
\frac{(388 + 757)}{(388 + 626 + 309 + 757)} = 0.5504808
$$
</p>

<p>
and the overall accuracy of <code>StocksModel3</code> is
</p>

<p>
$$
\frac{(49 + 13)}{(49 + 13 + 21 + 13)} = 0.6458333.
$$
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3-16" class="outline-3">
<h3 id="sec-3-16"><span class="section-number-3">3.16</span> <span class="done DONE">DONE</span> Problem 4.4 - Cluster-Specific Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-3-16">
<p>
To compute the overall test-set accuracy of the cluster-then-predict
approach, we can combine all the test-set predictions into a single
vector and all the true outcomes into a single vector:
</p>

<p>
<code>AllPredictions = c(PredictTest1, PredictTest2, PredictTest3)</code>
</p>

<p>
<code>AllOutcomes = c(stocksTest1$PositiveDec, stocksTest2$PositiveDec, stocksTest3$PositiveDec)</code>
</p>
</div>

<div id="outline-container-sec-3-16-1" class="outline-4">
<h4 id="sec-3-16-1"><span class="section-number-4">3.16.1</span> Question</h4>
<div class="outline-text-4" id="text-3-16-1">
<p>
What is the overall test-set accuracy of the cluster-then-predict
approach, again using a threshold of 0.5?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The overall test-set accuracy of the cluster-then-predict approach:"</span>)

AllPredictions <span style="color: #db7093;">&lt;-</span> c(PredictTest1, PredictTest2, PredictTest3)

AllOutcomes <span style="color: #db7093;">&lt;-</span> c(stocksTest1$PositiveDec, stocksTest2$PositiveDec,
                 stocksTest3$PositiveDec)

ct <span style="color: #db7093;">&lt;-</span> table(AllOutcomes, AllPredictions &gt;= 0.5)

(ct[1, 1] + ct[2, 2]) / length(AllPredictions)
</pre>
</div>

<pre class="example">
 :: The overall test-set accuracy of the cluster-then-predict approach:
[1] 0.5788716
</pre>

<p>
We see a modest improvement over the original logistic regression
model. Since predicting stock returns is a notoriously hard problem,
this is a good increase in accuracy. By investing in stocks for which
we are more confident that they will have positive returns (by
selecting the ones with higher predicted probabilities), this
cluster-then-predict model can give us an edge over the original
logistic regression model.
</p>

<p>
<b>Explanation</b>
</p>

<p>
After combining the predictions and outcomes with the provided code,
we can compute the overall test-set accuracy by creating a
classification matrix:
</p>

<p>
<code>table(AllOutcomes, AllPredictions &gt; 0.5)</code>
</p>

<p>
Which tells us that the overall accuracy is
</p>

<p>
$$
\frac{(467 + 1544)}{(467 + 1110 + 353 + 1544)} = 0.5788716.
$$
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 19/07/2015</p>
<p class="author">Author: Sergio-Feliciano Mendoza-Barrera</p>
<p class="date">Created: 2015-07-22 Wed 08:02</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
