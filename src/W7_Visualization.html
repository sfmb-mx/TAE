<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Unit 7 Visualization</title>
<!-- 2015-07-23 Thu 10:33 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Sergio-Feliciano Mendoza-Barrera" />
<meta  name="description" content="Visualization tools in R"
 />
<meta  name="keywords" content="R, data science, emacs, ESS, org-mode, visualization" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Unit 7 Visualization</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Visualizing the World: An Introduction to Visualization</a>
<ul>
<li><a href="#sec-1-1">1.1. Video 1: The Power of Visualizations</a></li>
<li><a href="#sec-1-2">1.2. Quick Question (1 point possible)</a></li>
<li><a href="#sec-1-3">1.3. Video 2: The World Health Organization (WHO)</a></li>
<li><a href="#sec-1-4">1.4. Quick Question (1 point possible)</a></li>
<li><a href="#sec-1-5">1.5. Video 3: What is Data Visualization?</a></li>
<li><a href="#sec-1-6">1.6. Quick Question (4/4 points)</a></li>
<li><a href="#sec-1-7">1.7. Video 4: Basic Scatterplots Using ggplot</a></li>
<li><a href="#sec-1-8">1.8. Quick Question (1 point possible)</a></li>
<li><a href="#sec-1-9">1.9. Video 5: Advanced Scatter plots Using ggplot</a></li>
<li><a href="#sec-1-10">1.10. Quick Question (1 point possible)</a></li>
</ul>
</li>
<li><a href="#sec-2">2. The Analytical Policeman: Visualization for Law and Order</a>
<ul>
<li><a href="#sec-2-1">2.1. Video 1: Predictive Policing</a></li>
<li><a href="#sec-2-2">2.2. Quick Question (1 point possible)</a></li>
<li><a href="#sec-2-3">2.3. Video 2: Visualizing Crime Over Time</a></li>
<li><a href="#sec-2-4">2.4. Quick Question (1 point possible)</a></li>
<li><a href="#sec-2-5">2.5. Video 3: A Line Plot</a></li>
<li><a href="#sec-2-6">2.6. Quick Question (2 points possible)</a></li>
<li><a href="#sec-2-7">2.7. Video 4: A Heatmap</a></li>
<li><a href="#sec-2-8">2.8. Quick Question (2 points possible)</a></li>
<li><a href="#sec-2-9">2.9. Video 5: A Geographical Hot Spot Map</a></li>
<li><a href="#sec-2-10">2.10. Quick Question (1 point possible)</a></li>
<li><a href="#sec-2-11">2.11. Video 6: A Heatmap on the United States</a></li>
<li><a href="#sec-2-12">2.12. Quick Question (1 point possible)</a></li>
<li><a href="#sec-2-13">2.13. Video 7: The Analytics Edge</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="abstract">
<p>
Unit 7, Visualization tools in R, part of the Analytics Edge course.
</p>

</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Visualizing the World: An Introduction to Visualization</h2>
<div class="outline-text-2" id="text-1">
<p>
This week, we'll be discussing the power of visualizations for
understanding worldwide trends and for using analytics to stop
crime. In the first lecture, we'll use data from the World Health
Organization to create visualizations that help us understand and
communicate global health trends.
</p>


<div class="figure">
<p><img src="../graphs/VIS-VisualizingTheWorld.png" alt="VIS-VisualizingTheWorld.png" />
</p>
</div>

<p>
In the second lecture, we'll discuss predictive policing, and how
police departments across the country are using data and analytics to
improve decision making.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Video 1: The Power of Visualizations</h3>
<div class="outline-text-3" id="text-1-1">
<p>
We'll discuss the idea of using visualization to better understand
data and to provide insights on the problem we're addressing.
</p>

<p>
<b>Why visualization?</b>
</p>

<p>
People often say that a picture is like a thousand words. In the same
spirit, John Tukey, a major statistician at Princeton, wrote that "the
picture-examining eye is the best finder we have of the wholly
unanticipated."
</p>


<div class="figure">
<p><img src="../graphs/VIS-WhyVisualization.png" alt="VIS-WhyVisualization.png" />
</p>
</div>

<p>
Visualization is further useful for initial data exploration, for
interpreting models, and for communicating results effectively.
</p>

<p>
Let us give some examples of different modes of visualization that
illustrate these points. The figure shows the miles per gallon of a
car as a function of the car's weight. The figure clearly illustrates
that as the weight of the car increases, the miles per gallon
decrease.
</p>


<div class="figure">
<p><img src="../graphs/VIS-InitialExploration.png" alt="VIS-InitialExploration.png" />
</p>
</div>

<p>
The same graph, but now colors of the points signify the number of
cylinders in the car: four for red, six for green, and eight in blue.
</p>


<div class="figure">
<p><img src="../graphs/VIS-ExploreFurther.png" alt="VIS-ExploreFurther.png" />
</p>
</div>

<p>
On the same data, we now plot a regression line that captures the
intuition that as the weight of the car increases, the miles per
gallon decrease.
</p>


<div class="figure">
<p><img src="../graphs/VIS-RegressionLine.png" alt="VIS-RegressionLine.png" />
</p>
</div>

<p>
In this plot, we'll visualize burglaries in the city of Houston by
combining data and geographical location in a map.
</p>


<div class="figure">
<p><img src="../graphs/VIS-GeographicalData.png" alt="VIS-GeographicalData.png" />
</p>
</div>

<p>
This plot illustrates, using a heat map, the usage of rented bicycles
from the Hubway company. The horizontal axis is the hour of the day,
and the vertical axis the day of the week, starting on Sunday. The
heat map shows that the usage increases during the morning and night
rush hours on weekdays.
</p>


<div class="figure">
<p><img src="../graphs/VIS-ShowRelationships.png" alt="VIS-ShowRelationships.png" />
</p>
</div>

<p>
The next plot helps us visualize histograms of different categories
using the Hubway data.
</p>


<div class="figure">
<p><img src="../graphs/VIS-ExploreCategories.png" alt="VIS-ExploreCategories.png" />
</p>
</div>

<p>
This plot shows US unemployment by state. The lighter colors
corresponding to smaller unemployment, and the darker colors
corresponding to larger unemployment rates.
</p>


<div class="figure">
<p><img src="../graphs/VIS-MapAccording2Data.png" alt="VIS-MapAccording2Data.png" />
</p>
</div>

<p>
The plan this week is to create all of these visualizations. We'll see
how visualizations can be used to better understand data, communicate
information more effectively, show the results of analytical models.
</p>


<div class="figure">
<p><img src="../graphs/VIS-Power.png" alt="VIS-Power.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Normally, a scatterplot only allows us to visualize two dimensions -
one on the x-axis, and one on the y-axis. In the previous video we
were able to show a third dimension on the scatterplot using what
attribute?
</p>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li><code>[X]</code> Color Color - correct
</li>
<li><code>[&#xa0;]</code> Shape
</li>
<li><code>[&#xa0;]</code> Location
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
On slide 3, we show the scatterplot from slide 2, but with the number
of cylinders shown by the color of the points. This allows us to
visualize a third dimension of our data.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Video 2: The World Health Organization (WHO)</h3>
<div class="outline-text-3" id="text-1-3">
<p>
The World Health Organization, WHO for short, is the authority for
health within the United Nations system.
</p>


<div class="figure">
<p><img src="../graphs/VIS-WHO.png" alt="VIS-WHO.png" />
</p>
</div>

<p>
WHO communicates information about global health in order to inform
citizens, donors, policymakers, and organizations around the world.
</p>


<div class="figure">
<p><img src="../graphs/VIS-WorldHealthReport.png" alt="VIS-WorldHealthReport.png" />
</p>
</div>

<p>
Their primary publication is <b>World Health Report</b>. Each issue focuses
on a specific aspect of global health, and includes statistics and
experts' assessments.
</p>

<p>
WHO also maintains an open, online repository of global health
data. WHO provides some data visualizations, which helps them
communicate more effectively with the public. As an example, the graph
shows the World Energy Consumption during 2001 to 2003.
</p>


<div class="figure">
<p><img src="../graphs/VIS-OnlineDataRepository.png" alt="VIS-OnlineDataRepository.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Why is it particularly helpful for WHO to provide data visualizations?
Select all that apply.
</p>
</div>

<div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> There is no other way to display information shown in
visualizations like the Energy Consumption one.
</li>

<li><code>[X]</code> When communicating information to the general public, a
visualization like the Energy Consumption one is much easier to
absorb than a table of numbers would be.
</li>

<li><code>[X]</code> Visualizations can easily be used by policymakers and others who
wish to present data from WHO.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
While there are other ways to display the data given in many
visualizations (like tables), visualizations help to better
communicate data to the public and can easily be used by others in
presentations.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Video 3: What is Data Visualization?</h3>
<div class="outline-text-3" id="text-1-5">
<p>
We will discuss the meaning of data visualization, and why it's often
useful to visualize your data to discover hidden trends and
properties.
</p>

<p>
Data visualization is defined as a mapping of data properties to
visual properties.
</p>

<p>
Data properties are usually numerical or categorical, like the mean of
a variable, the maximum value of a variable, or the number of
observations with a certain property.
</p>

<p>
Visual properties can be \((x,y)\) coordinates to plot points on a
graph, colors to assign labels, sizes, shapes, heights, etc. Both
types of properties are used to better understand the data, but in
different ways.
</p>


<div class="figure">
<p><img src="../graphs/VIS-WhatsIsDataVisualization.png" alt="VIS-WhatsIsDataVisualization.png" />
</p>
</div>

<p>
To motivate the need for data visualization, let's look at a famous
example called Anscombe's Quartet. Each of these tables corresponds to
a different data set. We have four data sets, each with two variables,
\(x\) and \(y\).
</p>

<p>
Just looking at the tables of data, it's hard to notice anything
special about it. It turns out that the mean and variance of the \(x\)
variable is the same for all four data sets, the mean and variance of
the \(y\) variable is the same for all four data sets, and the correlation
between \(x\) and \(y\), as well as the regression equation to predict \(y\) from
\(x\), is the exact same for all four data sets.
</p>


<div class="figure">
<p><img src="../graphs/VIS-AnscombeQ.png" alt="VIS-AnscombeQ.png" />
</p>
</div>

<p>
So just by looking at data properties, we might conclude that these
data sets are very similar. But if we plot the four data sets, they're
very different.
</p>

<p>
These plots show the four data sets, with the x variable on the
x-axis, and the y variable on the y-axis. Visually, these data sets
look very different. But without visualizing them, we might not have
noticed this.
</p>


<div class="figure">
<p><img src="../graphs/VIS-AnscombeQ02.png" alt="VIS-AnscombeQ02.png" />
</p>
</div>

<p>
This is one example of why visualizing data can be very important.
</p>

<p>
We'll use the <b>ggplot2</b> package in R to create data visualizations. This
package was created by Hadley Wickham, who described ggplot as "a
plotting system for R based on the grammar of graphics, which tries to
take the good parts of base and lattice graphics and none of the bad
parts.
</p>


<div class="figure">
<p><img src="../graphs/VIS-ggplot.png" alt="VIS-ggplot.png" />
</p>
</div>

<p>
So what do we gain from using ggplot over just making plots using the
basic R functions, or what's referred to as base R?
</p>

<p>
Well, in base R, each mapping of data properties to visual properties
is its own special case. When we create a scatter plot, or a box plot,
or a histogram, we have to use a completely different function.
</p>

<p>
It's challenging to create any sophisticated visualizations. It's also
difficult to add elements to existing plots.
</p>


<div class="figure">
<p><img src="../graphs/VIS-BaseVSggplot.png" alt="VIS-BaseVSggplot.png" />
</p>
</div>

<p>
But in ggplot, the mapping of data properties to visual properties is
done by just adding layers to the plot. This makes it much easier to
create sophisticated plots and to add to existing plots.
</p>

<p>
So what is the grammar of graphics that ggplot is based on? All ggplot
graphics consist of three elements. The first is data, in a data
frame. The second is an aesthetic mapping, which describes how
variables in the data frame are mapped to graphical attributes.
</p>

<p>
This is where we'll define which variables are on the x- and y-axes,
whether or not points should be colored or shaped by certain
attributes, etc.
</p>


<div class="figure">
<p><img src="../graphs/VIS-GrammarOfGraphics.png" alt="VIS-GrammarOfGraphics.png" />
</p>
</div>

<p>
The third element is which geometric objects we want to determine how
the data values are rendered graphically. This is where we indicate if
the plot should have points, lines, bars, boxes, etc.
</p>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Quick Question (4/4 points)</h3>
<div class="outline-text-3" id="text-1-6">
<p>
In this quick question, we'll be asking you questions about the
following three plots, that we saw in Video 1. We'll refer to them as
the "Scatterplot", the "Histogram", and the "US Map".
</p>

<p>
The Scatterplot:
</p>


<div class="figure">
<p><img src="../graphs/Scatterplot_Week8.jpg.png" alt="Scatterplot_Week8.jpg.png" />
</p>
</div>

<p>
The Histogram:
</p>


<div class="figure">
<p><img src="../graphs/Histogram_Week8.jpg.png" alt="Histogram_Week8.jpg.png" />
</p>
</div>

<p>
The US Map:
</p>


<div class="figure">
<p><img src="../graphs/USmap_Week8.jpg.png" alt="USmap_Week8.jpg.png" />
</p>
</div>
</div>

<div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
In the Scatterplot, what are the geometric objects?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Bars
</li>
<li><code>[X]</code> Points Points - correct
</li>
<li><code>[&#xa0;]</code> Lines
</li>
<li><code>[&#xa0;]</code> Polygons
</li>
<li><code>[&#xa0;]</code> Boxes
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2"><span class="section-number-4">1.6.2</span> Question</h4>
<div class="outline-text-4" id="text-1-6-2">
<p>
In the Histogram, what are the geometric objects?
</p>
</div>

<div id="outline-container-sec-1-6-2-1" class="outline-5">
<h5 id="sec-1-6-2-1"><span class="section-number-5">1.6.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-6-2-1">
<ul class="org-ul">
<li><code>[X]</code> Bars Bars - correct
</li>
<li><code>[&#xa0;]</code> Points
</li>
<li><code>[&#xa0;]</code> Lines
</li>
<li><code>[&#xa0;]</code> Polygons
</li>
<li><code>[&#xa0;]</code> Boxes
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3"><span class="section-number-4">1.6.3</span> Question</h4>
<div class="outline-text-4" id="text-1-6-3">
<p>
In the US Map, what are the geometric objects?
</p>
</div>

<div id="outline-container-sec-1-6-3-1" class="outline-5">
<h5 id="sec-1-6-3-1"><span class="section-number-5">1.6.3.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-6-3-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Bars
</li>
<li><code>[&#xa0;]</code> Points
</li>
<li><code>[&#xa0;]</code> Lines
</li>
<li><code>[X]</code> Polygons Polygons - correct
</li>
<li><code>[&#xa0;]</code> Boxes
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-4" class="outline-4">
<h4 id="sec-1-6-4"><span class="section-number-4">1.6.4</span> Question</h4>
<div class="outline-text-4" id="text-1-6-4">
<p>
All three of these plots defined a particular aesthetic property. What
is it?
</p>
</div>

<div id="outline-container-sec-1-6-4-1" class="outline-5">
<h5 id="sec-1-6-4-1"><span class="section-number-5">1.6.4.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-6-4-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> The x-axis label.
</li>
<li><code>[&#xa0;]</code> The y-axis label.
</li>
<li><code>[&#xa0;]</code> Different shapes for different types of observations.
</li>
<li><code>[X]</code> Colors. Colors. - correct
</li>
<li><code>[&#xa0;]</code> A legend.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
The geometric objects for the Scatterplot are points, for the
Histogram are bars, and for the US Map are polygons (the states). All
three plots defined colors in the plot.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Video 4: Basic Scatterplots Using ggplot</h3>
<div class="outline-text-3" id="text-1-7">
<p>
In the rest of this lecture, we'll be using the data file
<a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/WHO.csv">WHO.csv</a>. Please download this file to your computer, and save it to a
location that you will remember. This data comes from the
<a href="http://apps.who.int/gho/data/node.main">Global Health Observatory Data Repository</a>.
</p>

<p>
An R script file with all of the commands used in this lecture can be
downloaded <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/Unit7_WHO.R">here</a>.
</p>

<p>
Let's start by reading in our data. We'll be using the same data set
we used during week one, WHO.csv.
</p>
</div>

<div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Download the data sets</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/WHO.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"WHOu7.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)

<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}

list.files(<span style="color: #ff6a6a;">"../data"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "mvtWeek1.csv"            "NBA_test.csv"
[33] "NBA_train.csv"           "parole.csv"
[35] "pisa2009test.csv"        "pisa2009train.csv"
[37] "PollingData_Imputed.csv" "PollingData.csv"
[39] "ProcterGambleStock.csv"  "quality.csv"
[41] "README.md"               "SampleSubmission.csv"
[43] "songs.csv"               "stevens.csv"
[45] "StocksCluster.csv"       "stopwords.txt"
[47] "tumor.csv"               "tweets.csv"
[49] "USDA.csv"                "WHO_Europe.csv"
[51] "WHO.csv"                 "WHOu7.csv"
[53] "wiki.csv"                "wine_test.csv"
[55] "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><span class="section-number-4">1.7.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-1-7-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Loading data into their data frame."</span>)
WHO <span style="color: #db7093;">&lt;-</span> read.csv(<span style="color: #ff6a6a;">"../data/WHOu7.csv"</span>)
str(WHO)
</pre>
</div>

<pre class="example">
 :: Loading data into their data frame.
'data.frame':	194 obs. of  13 variables:
 $ Country                      : Factor w/ 194 levels "Afghanistan",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ Region                       : Factor w/ 6 levels "Africa","Americas",..: 3 4 1 4 1 2 2 4 6 4 ...
 $ Population                   : int  29825 3162 38482 78 20821 89 41087 2969 23050 8464 ...
 $ Under15                      : num  47.4 21.3 27.4 15.2 47.6 ...
 $ Over60                       : num  3.82 14.93 7.17 22.86 3.84 ...
 $ FertilityRate                : num  5.4 1.75 2.83 NA 6.1 2.12 2.2 1.74 1.89 1.44 ...
 $ LifeExpectancy               : int  60 74 73 82 51 75 76 71 82 81 ...
 $ ChildMortality               : num  98.5 16.7 20 3.2 163.5 ...
 $ CellularSubscribers          : num  54.3 96.4 99 75.5 48.4 ...
 $ LiteracyRate                 : num  NA NA NA NA 70.1 99 97.8 99.6 NA NA ...
 $ GNI                          : num  1140 8820 8310 NA 5230 ...
 $ PrimarySchoolEnrollmentMale  : num  NA NA 98.2 78.4 93.1 91.1 NA NA 96.9 NA ...
 $ PrimarySchoolEnrollmentFemale: num  NA NA 96.4 79.4 78.2 84.5 NA NA 97.5 NA ...
</pre>

<p>
We can see that we have 194 observations, or countries, and 13
different variables&#x2013; the name of the country, the region the
country's in, the population in thousands, the percentage of the
population under 15 or over 60, the fertility rate or average number
of children per woman, the life expectancy in years, the child
mortality rate, which is the number of children who die by age five
per 1,000 births, the number of cellular subscribers per 100
population, the literacy rate among adults older than 15, the gross
national income per capita, the percentage of male children enrolled
in primary school, and the percentage of female children enrolled in
primary school.
</p>

<p>
In week one, the very first plot we made in R was a scatterplot of
fertility rate versus gross national income. Let's make this plot
again, just like we did in week one.
</p>


<div id="fig:WHOw1Plot" class="figure">
<p><img src="../graphs/WHOw1Plot.png" alt="WHOw1Plot.png" />
</p>
<p><span class="figure-number">Figure 23:</span> WHO plot from week 1</p>
</div>

<p>
This plot shows us that a higher fertility rate is correlated with a
lower income. Now, let's redo this scatter plot, but this time using
ggplot.
</p>

<p>
We'll see how ggplot can be used to make more visually
appealing and complex scatter plots.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Install new package: ggplot2 ..."</span>)
<span style="color: #9932cc;">## </span><span style="color: #ba55d3;">install.packages('ggplot2', repos='http://cran.rstudio.com/')</span>
writeLines(<span style="color: #ff6a6a;">"\n :: NOTE: Please comment after install once..."</span>)

<span style="color: #db7093;">library</span>(ggplot2)
writeLines(<span style="color: #ff6a6a;">"\n :: Library ggplot2 loaded..."</span>)
</pre>
</div>

<pre class="example">
:: Install new package: ggplot2 ...

:: NOTE: Please comment after install once...

:: Library ggplot2 loaded...
</pre>

<p>
Now, remember we need at least three things to create a plot using
ggplot&#x2013; data, an aesthetic mapping of variables in the data frame to
visual output, and a geometric object. So first, let's create the
ggplot object with the data and the aesthetic mapping.
</p>

<p>
We'll save it to the variable scatter plot, and then use the ggplot
function, where the first argument is the name of our data set, WHO,
which specifies the data to use, and the second argument is the
aesthetic mapping, <code>aes</code>.
</p>


<div id="fig:WHOggplotExample" class="figure">
<p><img src="../graphs/WHOggplotExample.png" alt="WHOggplotExample.png" />
</p>
<p><span class="figure-number">Figure 24:</span> WHO scatter plot with ggplot</p>
</div>

<p>
Now, we need to tell ggplot what geometric objects to put in the
plot. We could use bars, lines, points, or something else. This is a
big difference between ggplot and regular plotting in R. You can build
different types of graphs by using the same ggplot object.
</p>

<p>
There's no need to learn one function for bar graphs, a completely
different function for line graphs, etc. So first, let's just create a
straightforward scatter plot. So the geometry we want to add is
points. We can do this by typing the name of our ggplot object,
scatter plot, and then adding the function, geom_point().
</p>

<p>
You should see a new plot in the Graphics window that looks similar to
our original plot, but there are already a few nice improvements. One
is that we don't have the data set name with a dollar  sign in front
of the label on each axis, just the variable name.
</p>

<p>
Another is that we have these nice grid lines in the background and
solid points that pop out from the background.
</p>

<p>
We could have made a line graph just as easily by changing point to
line.
</p>

<p>
In addition to specifying that the geometry we want is points, we can
add other options, like the color, shape, and size of the
points. Let's redo our plot with blue triangles instead of circles. In
the empty parentheses for <code>geom_point</code>, we're going to specify some
properties of the points.
</p>

<p>
<code>scatterplot + geom_point(color = "blue", size = 3, shape = 17)</code>
</p>

<p>
Change <code>blue</code> to <code>darkred</code>, and change shape to 8. Now, you should see
dark red stars. There are many different colors and shapes that you
can specify. We've provided some information in the text below this
video.
</p>

<p>
Now, let's save our plot to a file. We can do this by first saving our
plot to a variable.
</p>

<p>
<code>fertilityGNIplot = scatterplot +</code>
<code>geom_point(colour = "blue", size = 3, shape = 17) +
~ggtitle("Fertility Rate vs. Gross National Income")</code>
</p>

<p>
This will save our scatter plot to the variable,
<code>fertilityGNIplot</code>. Now, let's create a file we want to save our plot
to. We can do that with the <code>pdf</code> function.
</p>

<p>
<code>pdf("MyPlot.pdf")</code>
</p>

<p>
<code>print(fertilityGNIplot)</code>
</p>

<p>
<code>dev.off()</code>
</p>
</div>
</div>

<div id="outline-container-sec-1-7-3" class="outline-4">
<h4 id="sec-1-7-3"><span class="section-number-4">1.7.3</span> Colors and shapes in R</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
If you want to see all of the available colors in R, type in your R
console:
</p>

<p>
<code>colors()</code>
</p>

<p>
All of the available shapes are described in the following image:
</p>


<div class="figure">
<p><img src="../graphs/Shapes.jpg.png" alt="Shapes.jpg.png" />
</p>
</div>

<p>
The number 0 corresponds to an empty square, the number 6 corresponds
to an upside down triangle, etc.
</p>

<p>
Source: This image comes from <a href="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/">Cookbook for R</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> Question</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
In R, change the shape of your points to the number 15. What shape are
the points now?
</p>
</div>

<div id="outline-container-sec-1-8-1-1" class="outline-5">
<h5 id="sec-1-8-1-1"><span class="section-number-5">1.8.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-8-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Circles
</li>
<li><code>[&#xa0;]</code> Diamonds
</li>
<li><code>[&#xa0;]</code> Crosses
</li>
<li><code>[X]</code> Squares
</li>
<li><code>[&#xa0;]</code> Stars
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
If you type:
</p>

<p>
<code>scatterplot + geom_point(shape = 15)</code>
</p>

<p>
where scatterplot is the plot we created in the previous video, you
can see that the points are squares.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Video 5: Advanced Scatter plots Using ggplot</h3>
<div class="outline-text-3" id="text-1-9">
<p>
Now, let's color the points by region instead. This time, we want to
add a color option to our aesthetic, since we're assigning a variable
in our data set to the colors.
</p>


<div id="fig:WHObyRegion" class="figure">
<p><img src="../graphs/WHObyRegion.png" alt="WHObyRegion.png" />
</p>
<p><span class="figure-number">Figure 26:</span> Scatter plot of WHO by region</p>
</div>

<p>
Now, in our plot, we should see that each point is colored
corresponding to the region that country belongs in. So the countries
in Africa are colored red, the countries in the Americas are colored
gold, the countries in the Eastern Mediterranean are colored green,
etc.
</p>

<p>
This really helps us see something that we didn't see before. The
points from the different regions are really located in different
areas on the plot. Let's now instead color the points according to the
country's life expectancy.
</p>


<div id="fig:WHOscatterPlotLifeExpectancy" class="figure">
<p><img src="../graphs/WHOscatterPlotLifeExpectancy.png" alt="WHOscatterPlotLifeExpectancy.png" />
</p>
<p><span class="figure-number">Figure 27:</span> Who scatter plot by life expectancy</p>
</div>

<p>
Now, we should see that each point is colored according to the life
expectancy in that country. Notice that before, we were coloring by a
factor variable, Region.
</p>

<p>
So we had exactly seven different colors corresponding to the seven
different regions. Here, we're coloring by LifeExpectancy instead,
which is a numerical variable, so we get a gradient of colors, like
this.
</p>

<p>
Lighter blue corresponds to a higher life expectancy, and darker blue
corresponds to a lower life expectancy.
</p>

<p>
Suppose we were interested in seeing whether the fertility rate of a
country was a good predictor of the percentage of the population
under 15. Intuitively, we would expect these variables to be highly
correlated. But before trying any statistical models, let's explore
our data with a plot.
</p>


<div id="fig:WHOFertilityRateVSPopUnder15" class="figure">
<p><img src="../graphs/WHOFertilityRateVSPopUnder15.png" alt="WHOFertilityRateVSPopUnder15.png" />
</p>
<p><span class="figure-number">Figure 28:</span> WHO fertility rate vs. population under 15</p>
</div>

<p>
This is really interesting. It looks like the variables are certainly
correlated, but as the fertility rate increases, the variable,
<code>Under15</code> starts increasing less.
</p>

<p>
So this doesn't really look like a linear relationship. But we suspect
that a log transformation of <code>FertilityRate</code> will be better. Let's
give it a shot.
</p>


<div id="fig:WHOlogFertilityRateVSUnder15" class="figure">
<p><img src="../graphs/WHOlogFertilityRateVSUnder15.png" alt="WHOlogFertilityRateVSUnder15.png" />
</p>
<p><span class="figure-number">Figure 29:</span> WHO scatter plot of the logarithm of fertility rate vs under 15</p>
</div>

<p>
Let's try building in a simple linear regression model to predict the
percentage of the population under 15, using the log of the fertility
rate.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Simple linear regression model to predict the percentage\n of the population under 15, using the log of the fertility rate:"</span>)
mod <span style="color: #db7093;">&lt;-</span> lm(Under15 ~ log(FertilityRate), data = WHO)
summary(mod)
</pre>
</div>

<pre class="example">
 :: Simple linear regression model to predict the percentage
 of the population under 15, using the log of the fertility rate:

Call:
lm(formula = Under15 ~ log(FertilityRate), data = WHO)

Residuals:
     Min       1Q   Median       3Q      Max
-10.3131  -1.7742   0.0446   1.7440   7.7174

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)          7.6540     0.4478   17.09   &lt;2e-16 ***
log(FertilityRate)  22.0547     0.4175   52.82   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2.65 on 181 degrees of freedom
  (11 observations deleted due to missingness)
Multiple R-squared:  0.9391,	Adjusted R-squared:  0.9387
F-statistic:  2790 on 1 and 181 DF,  p-value: &lt; 2.2e-16
</pre>

<p>
Let's look at the summary of our model. It looks like the log of
<code>FertilityRate</code> is indeed a great predictor of <code>Under15</code>. The variable
is highly significant, and our <code>R-squared</code> is \(0.9391\).
</p>

<p>
Visualization was a great way for us to realize that the log
transformation would be better. If we instead had just used the
<code>FertilityRate</code>, the R-squared would have been \(0.87\). That's a pretty
significant decrease in <code>R-squared</code>.
</p>

<p>
So now, let's add this regression line to our plot. This is pretty
easy in ggplot. We just have to add another layer.
</p>


<div id="fig:WHOfetilityRvsUnder15LRmodel" class="figure">
<p><img src="../graphs/WHOfetilityRvsUnder15LRmodel.png" alt="WHOfetilityRvsUnder15LRmodel.png" />
</p>
<p><span class="figure-number">Figure 30:</span> WHO scatter plot of the fertility rate vs. under 15 with a linear regression model</p>
</div>

<p>
Now, you should see a blue line going through the data. This is our
regression line. By default, ggplot will draw a \(95\%\) confidence
interval shaded around the line.
</p>

<p>
We can change this by specifying options within the statistics layer.
</p>

<p>
This will give a \(99\%\) confidence interval.
</p>


<div id="fig:WHOFertilityRatevsUnder15LM99" class="figure">
<p><img src="../graphs/WHOFertilityRatevsUnder15LM99.png" alt="WHOFertilityRatevsUnder15LM99.png" />
</p>
<p><span class="figure-number">Figure 31:</span> WHO scatter plot of fertility rate vs under 15 with regression model with 99%</p>
</div>

<p>
We could instead take away the confidence interval altogether by
deleting
</p>

<p>
<code>level = 0.99</code>
</p>

<p>
and typing
</p>

<p>
<code>se = FALSE</code>
</p>

<p>
Now, we just have the regression line in blue.
</p>


<div id="fig:WHOFertilityRVsUnder15WlmOnly" class="figure">
<p><img src="../graphs/WHOFertilityRVsUnder15WlmOnly.png" alt="WHOFertilityRVsUnder15WlmOnly.png" />
</p>
<p><span class="figure-number">Figure 32:</span> WHO Fertility rate vs. Under 15 with LM only</p>
</div>

<p>
We could also change the color of the regression line
by typing as an option
</p>

<p>
~color = "orange"~
</p>


<div id="fig:WHOFerRateVsUnder15WlmOrange" class="figure">
<p><img src="../graphs/WHOFerRateVsUnder15WlmOrange.png" alt="WHOFerRateVsUnder15WlmOrange.png" />
</p>
<p><span class="figure-number">Figure 33:</span> WHO Fertility rate vs Under 15 with regression model in orange</p>
</div>

<p>
Now, we have an orange linear regression line. As we've seen in this
lecture, scatter plots are great for exploring data. However, there
are many other ways to represent data visually, such as box plots,
line charts, histograms, heat maps, and geographic maps.
</p>

<p>
In some cases, it may be better to choose one of these other ways of
visualizing your data.
</p>

<p>
Luckily, ggplot makes it easy to go from one type of visualization to
another, simply by adding the appropriate layer to the plot.
</p>

<p>
<b>So what is the edge of visualizations?</b>
</p>

<p>
The WHO data that we used here is used by citizens, policymakers, and
organizations around the world.
</p>


<div class="figure">
<p><img src="../graphs/VIS-TAE.png" alt="VIS-TAE.png" />
</p>
</div>

<p>
Visualizing the data facilitates the understanding of global health
trends at a glance.
</p>

<p>
By using ggplot in R, we're able to visualize data for exploration,
modeling, and sharing analytics results.
</p>
</div>
</div>

<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-1-10">
<p>
Create the fertility rate versus population under 15 plot again:
</p>

<p>
<code>ggplot(WHO, aes(x = FertilityRate, y = Under15)) + geom_point()</code>
</p>

<p>
Now, color the points by the Region variable.
</p>

<p>
Note: You can add <code>scale_color_brewer(palette="Dark2")</code> to your plot
if you are having a hard time distinguishing the colors (this color
palette is often better if you are colorblind). To use this option,
you should just add <code>scale_color_brewer(palette="Dark2")</code> to your
plotting command right after <code>geom_point()</code>. To find out more about
using ggplot in a colorblind-friendly way, please see this website.
</p>


<div id="fig:WHOFertRvsUnder15NewPalette" class="figure">
<p><img src="../graphs/WHOFertRvsUnder15NewPalette.png" alt="WHOFertRvsUnder15NewPalette.png" />
</p>
<p><span class="figure-number">Figure 35:</span> Using a new palette to improve the readability of the plot</p>
</div>

<p>
One region in particular has a lot of countries with a very low
fertility rate and a very low percentage of the population
under 15. Which region is it?
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> Africa
</li>
<li><code>[&#xa0;]</code> Americas
</li>
<li><code>[&#xa0;]</code> Eastern Mediterranean
</li>
<li><code>[X]</code> Europe
</li>
<li><code>[&#xa0;]</code> South-East Asia
</li>
<li><code>[&#xa0;]</code> Western Pacific
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
You can color the points by region if you adjust the command to the
following:
</p>

<p>
<code>ggplot(WHO, aes(x = FertilityRate, y = Under15, color=Region)) + geom_point()</code>
</p>

<p>
Most of the countries in Europe have a very low fertility rate and a
very low percentage of the population under 15.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> The Analytical Policeman: Visualization for Law and Order</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Video 1: Predictive Policing</h3>
<div class="outline-text-3" id="text-2-1">
<p>
We will discuss how visualization can offer insights in the area of
policing in urban environments.
</p>


<div class="figure">
<p><img src="../graphs/AP.png" alt="AP.png" />
</p>
</div>

<p>
The explosion of computerized data affects all parts of society,
including policing. In the past, human judgment and experience was the
only tool in identifying patterns in criminal behavior.
</p>


<div class="figure">
<p><img src="../graphs/AP-AnalyticalPoliceman.png" alt="AP-AnalyticalPoliceman.png" />
</p>
</div>

<p>
Los Angeles police worked for months to catch Manson and his
followers. These days the LAPD is on an offensive to prevent
crime. Its latest weapon is a computer program that can actually
predict where crimes will happen.
</p>

<p>
And justice correspondent Bob Orr has a first look at the results. In
the Foothill Division north of downtown Los Angeles, police are
patrolling the largely working-class neighborhoods with specially
marked maps. The small red squares are hot spots, where computers
project property crimes are most likely.
</p>

<p>
It's called predictive policing. A program which Captain Sean
Malinowski says puts officers on the scene before crimes occur. 65% of
our crimes are burglary, grand theft auto, and burglary for motor
vehicle. And that's what these boxes represent. That's a pretty small
box, 500 feet by 500 feet. Yes, it is a small area.
</p>

<p>
These crime prediction boxes come from the same kind of mathematical
calculation used to predict earthquakes and aftershocks.
</p>


<div class="figure">
<p><img src="../graphs/AP-PredictivePolicing.png" alt="AP-PredictivePolicing.png" />
</p>
</div>

<p>
By analyzing the times, dates, and places of recent crimes computers
project hot spots for burglaries, break-ins, and car thefts. LA's
Police Chief Charlie Beck says increasing police patrols inside those
boxes denies criminals opportunity. The real measure of this is not
how many people you catch, it's how much crime you prevent.
</p>

<p>
I love catching people. It's what I live for. But, what I'd rather do
is live in a place and work in a place where crime didn't happen.
</p>

<p>
Chief Beck, a 35-year veteran and the father of two LAPD officers, has
faced some skepticism in selling the predictive concept.
</p>

<ul class="org-ul">
<li>You're a street cop. -
</li>

<li>I am. -
</li>

<li>So somebody comes to you with a computer program that says, here
we're going to predict the future, we're going to tell you where
crime is going to occur.
</li>
</ul>

<p>
Aren't some of the guys on the street just going to roll their eyes
and say, oh come on?
</p>

<ul class="org-ul">
<li>Well, of course.
</li>

<li>I mean, that's the nature of human beings.
</li>
</ul>

<p>
I mean everybody thinks that they do their profession as well as it
can be done already, so they don't need any help.
</p>

<p>
If this old street cop can change the way that he thinks about this
stuff, then I know that my kids can do the same.
</p>

<p>
The LAPD began testing the predictive policing model here in the
Foothill Division in November, and the early results are encouraging.
</p>

<p>
The LAPD began testing the predictive policing model here in the
Foothill Division in November, and the early results are
encouraging. Burglaries are down 33%, and violent crime is also down
21%.
</p>

<p>
That success will allow Beck to expand the program to other parts of
the city and leverage limited resources.
</p>

<ul class="org-ul">
<li>I'm not going to get more money. I'm not going to get more cops. But
I have to be better at using what I have, and that's what predictive
policing is about.
</li>
</ul>

<p>
It's also about driving the crime rate lower. Crime here has dropped
nine straight years. With these small red boxes, LA is aiming
for 10. Bob Orr, CBS News, Los Angeles. (End TV report).
</p>

<p>
The Los Angeles Police Chief Charlie Beck writes, "I'm not going to
get more money. I'm not going to get more cops.
</p>


<div class="figure">
<p><img src="../graphs/AP-LAPoliceDept.png" alt="AP-LAPoliceDept.png" />
</p>
</div>

<p>
Let me comment on the role of analytics. The analytical tools you have
learned in this class can be used to make these predictive policing
models possible.
</p>

<p>
However, communicating the results of these models is critical. A
linear regression output table will not be of use to a police person
on patrol. Visualization bridges the gap between the analytics and the
end user.
</p>


<div class="figure">
<p><img src="../graphs/AP-RoleOfAnalytics.png" alt="AP-RoleOfAnalytics.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Question</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
The Los Angeles Police Department sees the benefits of predictive
policing as which of the following? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-2-1-1" class="outline-5">
<h5 id="sec-2-2-1-1"><span class="section-number-5">2.2.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<ul class="org-ul">
<li><code>[X]</code> Allowing more intelligent officer deployment
</li>
<li><code>[&#xa0;]</code> Eliminating the need for police officers
</li>
<li><code>[X]</code> Preventing crime
</li>
<li><code>[&#xa0;]</code> Catching criminals
</li>
<li><code>[X]</code> Using resources more effectively
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
According the the Los Angeles Police Department, predictive policing
does not eliminate the need for police officers or increase the rate
at which they catch criminals. It does, however, allow more
intelligent officer deployment, prevents crime, and helps them use
resources more effectively.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Video 2: Visualizing Crime Over Time</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We will discuss how we can create visualizations that are used in
predictive policing models. In almost every application, before we
even consider a predictive model, we should try to understand the
historical data.
</p>


<div class="figure">
<p><img src="../graphs/AP-UnderstandingThePast.png" alt="AP-UnderstandingThePast.png" />
</p>
</div>

<p>
We will use data from the city of Chicago, in the United States, about
motor vehicle thefts.
</p>


<div class="figure">
<p><img src="../graphs/AP-CrimeOverTime.png" alt="AP-CrimeOverTime.png" />
</p>
</div>

<p>
Given this data on crimes, suppose we wanted to communicate crime
patterns over the course of an average week. We could display daily
crime averages using a line graph, like the one shown here, but this
doesn't seem too useful.
</p>

<p>
We can see that crime tends to be higher on Saturday, but when on
Saturday, and where?
</p>

<p>
We could replace our x-axis with the hour of the day and have a
different line for every day of the week to understand when crime
occurs in more detail. But this would be a jumbled mess with seven
lines, and probably very hard to read.
</p>

<p>
We could instead use no visualization at all, and instead present
information in a table, like the one shown here. For each hour and
day, we have the total number of crimes that occurred. This is a valid
representation of the data, but large tables of numbers can be hard to
read and understand.
</p>


<div class="figure">
<p><img src="../graphs/AP-CrimeOverTime02.png" alt="AP-CrimeOverTime02.png" />
</p>
</div>

<p>
<b>So how can we make the table more interesting and usable?</b> A great
way to visualize information in a two-dimensional table is with a heat
map.
</p>

<p>
Heat maps visualize data using three attributes. Two of the attributes
are on the x and y-axes, typically displayed horizontally and
vertically.
</p>

<p>
The third attribute is represented by shades of color. In this
example, lower values in the third attribute correspond to colors
closer to blue, and higher values in the third attribute correspond to
colors closer to red.
</p>


<div class="figure">
<p><img src="../graphs/AP-Heatmaps.png" alt="AP-Heatmaps.png" />
</p>
</div>

<p>
For example, the x-axis could be hours of the day, the y-axis could be
days of the week, and the colors could correspond to the amount of
crime.
</p>

<p>
In a heat map, we can pick different color schemes based on the type
of data to convey different messages.
</p>

<p>
In crime, a yellow to red color scheme might be appropriate because it
can highlight some of the more dangerous areas in red. Your eye is
naturally drawn to the red areas of the plot.
</p>

<p>
In other applications, both high and low values are meaningful, so
having a more varied color scheme might be useful.
</p>

<p>
And in other applications, you might only want to see cells with high
values, so you could use a gray scale to make the cells with low
values white.
</p>

<p>
The x and y-axes in a heat map don't need to be continuous. In our
example, we have a categorical or factor variable &#x2013; the day of the
week. And we can even combine a heat map with a geographical map,
which we'll discuss later in this lecture.
</p>


<div class="figure">
<p><img src="../graphs/AP-Heatmaps02.png" alt="AP-Heatmaps02.png" />
</p>
</div>

<p>
This type of heat map is frequently used in predictive policing to
show crime hot spots in a city. In this lecture, we'll use Chicago
motor vehicle theft data to explore patterns of crime, both over days
of the week, and over hours of the day.
</p>


<div class="figure">
<p><img src="../graphs/AP-AChicagoCrimeHeatmap.png" alt="AP-AChicagoCrimeHeatmap.png" />
</p>
</div>

<p>
We are interested in analyzing the total number of car thefts that
occur in any particular hour of a day of the week over our whole data
set.
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> Question</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
For which of the following situations would a heat map be an
appropriate visualization choice? Select all that apply.
</p>
</div>

<div id="outline-container-sec-2-4-1-1" class="outline-5">
<h5 id="sec-2-4-1-1"><span class="section-number-5">2.4.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-4-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Determining if crime is higher or lower on warmer days
</li>
<li><code>[X]</code> Visualizing the areas on a geographical map with the most crime
</li>
<li><code>[X]</code> Comparing crime counts by police district and time throughout a
city
</li>
<li><code>[&#xa0;]</code> Analyzing which months of the year have the most crime on
average
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
A heatmap would be useful for the middle two options, because they are
trying to visualize crime counts relative to two variables. For the
first option, you could use a basic scatterplot with time on the
x-axis and amount of crime on the y-axis. For the last option, you
could use a bar plot with a bar for each month and the height being
the average amount of crime in that month.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Video 3: A Line Plot</h3>
<div class="outline-text-3" id="text-2-5">
<p>
In the next few videos, we'll be using the dataset <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/mvt.csv">mvt.csv</a>. Please
download this dataset before starting this video. This data comes from
the <a href="http://gis.chicagopolice.org">Chicago Police Department</a>.
</p>

<p>
An R script file with all of the commands used in this lecture can be
downloaded <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/Unit7_Crime.R">here</a>.
</p>
</div>

<div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> Download the data sets</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/mvt.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"mvt.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)

<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}

list.files(<span style="color: #ff6a6a;">"../data"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "mvt.csv"                 "mvtWeek1.csv"
[33] "NBA_test.csv"            "NBA_train.csv"
[35] "parole.csv"              "pisa2009test.csv"
[37] "pisa2009train.csv"       "PollingData_Imputed.csv"
[39] "PollingData.csv"         "ProcterGambleStock.csv"
[41] "quality.csv"             "README.md"
[43] "SampleSubmission.csv"    "songs.csv"
[45] "stevens.csv"             "StocksCluster.csv"
[47] "stopwords.txt"           "tumor.csv"
[49] "tweets.csv"              "USDA.csv"
[51] "WHO_Europe.csv"          "WHO.csv"
[53] "WHOu7.csv"               "wiki.csv"
[55] "wine_test.csv"           "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-2-5-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Loading data into their data frame."</span>)
mvt <span style="color: #db7093;">&lt;-</span> read.csv(<span style="color: #ff6a6a;">"../data/mvt.csv"</span>, stringsAsFactors=<span style="color: #3cb371;">FALSE</span>)
str(mvt)
</pre>
</div>

<pre class="example">
 :: Loading data into their data frame.
'data.frame':   191641 obs. of  3 variables:
 $ Date     : chr  "12/31/12 23:15" "12/31/12 22:00" "12/31/12 22:00" "12/31/12 22:00" ...
 $ Latitude : num  41.8 41.9 42 41.8 41.8 ...
 $ Longitude: num  -87.6 -87.7 -87.8 -87.7 -87.6 ...
</pre>

<p>
We will create a basic line plot to visualize crime trends. Let's
start by reading in our data. We'll call it mvt for motor vehicle
thefts.
</p>

<p>
Let's take a look at the structure of our data using the <code>str</code>
function. We have over 190,000 observations of three different
variables&#x2013; the date of the crime, and the location of the crime, in
terms of latitude and longitude.
</p>

<p>
We want to first convert the Date variable to a format that R will
recognize so that we can extract the day of the week and the hour of
the day.
</p>

<p>
We can do this using the <code>strptime</code> function. So we want to replace
our variable, Date, with the output of the <code>strptime</code> function.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Convert the Date variable to a format that R will recognize..."</span>)
mvt$Date <span style="color: #db7093;">&lt;-</span> strptime(mvt$Date, format = <span style="color: #ff6a6a;">"%m/%d/%y %H:%M"</span>)
</pre>
</div>

<pre class="example">
:: Convert the Date variable to a format that R will recognize...
</pre>

<p>
In this format, we can extract the hour and the day of the week from
the Date variable, and we can add these as new variables to our data
frame. We can do this by first defining our new variable.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Extract the hour and the day of the week..."</span>)
mvt$Weekday <span style="color: #db7093;">&lt;-</span> weekdays(mvt$Date)
mvt$Hour <span style="color: #db7093;">&lt;-</span> mvt$Date$hour
</pre>
</div>

<pre class="example">
:: Extract the hour and the day of the week...
</pre>

<p>
Let's take a look at the structure of our data again to see what it
looks like.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Revising the structure of the dataframe mvt:"</span>)
str(mvt)
</pre>
</div>

<pre class="example">
 :: Revising the structure of the dataframe mvt:
'data.frame':   191641 obs. of  5 variables:
 $ Date     : POSIXlt, format: "2012-12-31 23:15:00" "2012-12-31 22:00:00" ...
 $ Latitude : num  41.8 41.9 42 41.8 41.8 ...
 $ Longitude: num  -87.6 -87.7 -87.8 -87.7 -87.6 ...
 $ Weekday  : chr  "Monday" "Monday" "Monday" "Monday" ...
 $ Hour     : int  23 22 22 22 21 20 20 20 19 18 ...
</pre>

<p>
Now, we have two more variables&#x2013; Weekday, which gives the day of the
week, and Hour, which gives the hour of the day. Now, we're ready to
make some line plots. Let's start by creating the line plot we saw in
the previous video with just one line and a value  for every day of
the week.
</p>

<p>
We want to plot as that value the total number of crimes on each day
of the week.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Need the total number of crimes on each day of the week:"</span>)
sort(table(mvt$Weekday), decreasing = <span style="color: #3cb371;">TRUE</span>)
</pre>
</div>

<pre class="example">
:: Need the total number of crimes on each day of the week:

  Friday Wednesday    Monday  Thursday  Saturday   Tuesday    Sunday
   29284     27416     27397     27319     27118     26791     26316
</pre>

<p>
This gives the total amount of crime on each day of the week. Let's
save this table as a data frame so that we can pass it to ggplot as
our data.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Save this table as a data frame:"</span>)
WeekdayCounts <span style="color: #db7093;">&lt;-</span> as.data.frame(table(mvt$Weekday))
str(WeekdayCounts)
</pre>
</div>

<pre class="example">
 :: Save this table as a data frame:
'data.frame':   7 obs. of  2 variables:
 $ Var1: Factor w/ 7 levels "Friday","Monday",..: 1 2 3 4 5 6 7
 $ Freq: int  29284 27397 27118 26316 27319 26791 27416
</pre>

<p>
We can see that our data frame has seven observations, one for each
day of the week, and two different variables.  The first variable,
called Var1, gives the name of the day of the week, and the second
variable, called Freq, for frequency, gives the total amount of crime
on that day of the week.
</p>

<p>
Now, we're ready to make our plot. First, we need to load the ggplot2
package.
</p>


<div id="fig:MVTCrimePlot01" class="figure">
<p><img src="../graphs/MVTCrimePlot01.png" alt="MVTCrimePlot01.png" />
</p>
<p><span class="figure-number">Figure 47:</span> MVT Chicago crime plot</p>
</div>

<p>
Now, we just need to add <code>geom_line(aes(group=1))</code>. This just groups
all of our data into one line, since we want one line in our plot.
</p>

<p>
We can see that this is very close to the plot we want. We have the
total number of crime plotted by day of the week, but our days of the
week are a little bit out of order. We have Friday first, then Monday,
then Saturday, then Sunday, etc.
</p>

<p>
What <code>ggplot</code> did was it put the days of the week in alphabetical
order. But we actually want the days of the week in chronological
order to make this plot a bit easier to read. We can do this by making
the <code>Var1</code> variable an ordered factor variable.
</p>

<p>
This signals to ggplot that the ordering is meaningful. We can do this
by using the factor function.
</p>


<div id="fig:MVTCrimeplot02" class="figure">
<p><img src="../graphs/MVTCrimeplot02.png" alt="MVTCrimeplot02.png" />
</p>
<p><span class="figure-number">Figure 48:</span> MVT Chicago crime plot v2</p>
</div>

<p>
We have the total crime by day of the week with the days of the week
in chronological order. The last thing we'll want to do to our plot is
just change the x- and y-axis labels, since they're not very helpful
as they are now.
</p>


<div id="fig:MVTCrimeplot03" class="figure">
<p><img src="../graphs/MVTCrimeplot03.png" alt="MVTCrimeplot03.png" />
</p>
<p><span class="figure-number">Figure 49:</span> MVT Chicago crime plot v3</p>
</div>

<p>
Now, this is the plot we were trying to generate with descriptive
labels on the x- and y-axis.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Quick Question (2 points possible)</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Create a new line plot, like the one in Video 3, but add the argument
<code>linetype = 2</code>. So the geom_line part of the plotting command should
look like:
</p>

<p>
<code>geom_line(aes(group=1), linetype=2)</code>
</p>


<div id="fig:MVTCrimeplot04" class="figure">
<p><img src="../graphs/MVTCrimeplot04.png" alt="MVTCrimeplot04.png" />
</p>
<p><span class="figure-number">Figure 50:</span> MVT Chicago crime plot v4</p>
</div>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
What does this do?
</p>
</div>

<div id="outline-container-sec-2-6-1-1" class="outline-5">
<h5 id="sec-2-6-1-1"><span class="section-number-5">2.6.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-6-1-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Makes the line thicker
</li>
<li><code>[&#xa0;]</code> Changes the color of the line to blue
</li>
<li><code>[X]</code> Makes the line dashed
</li>
<li><code>[&#xa0;]</code> Makes the line lighter in color
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> Question</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
Now, change the alpha parameter to 0.3 by replacing <code>linetype = 2</code>
with <code>alpha = 0.3</code> in the plot command. What does this do?
</p>


<div id="fig:MVTCrimeplot05" class="figure">
<p><img src="../graphs/MVTCrimeplot05.png" alt="MVTCrimeplot05.png" />
</p>
<p><span class="figure-number">Figure 51:</span> MVT Chicago crime plot v5</p>
</div>
</div>

<div id="outline-container-sec-2-6-2-1" class="outline-5">
<h5 id="sec-2-6-2-1"><span class="section-number-5">2.6.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-6-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Makes the line thicker
</li>
<li><code>[&#xa0;]</code> Changes the color of the line to blue
</li>
<li><code>[&#xa0;]</code> Makes the line dashed
</li>
<li><code>[X]</code> Makes the line lighter in color
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
The linetype parameter makes the line dashed, and the alpha parameter
makes the line lighter in color, or more transparent. The two plots
can be generated with the following commands:
</p>

<p>
<code>ggplot(WeekdayCounts, aes(x = Var1, y = Freq)) +</code>
<code>geom_line(aes(group=1), linetype=2) + xlab("Day of the Week") +</code>
<code>ylab("Total Motor Vehicle Thefts")</code>
</p>

<p>
<code>ggplot(WeekdayCounts, aes(x = Var1, y = Freq)) +</code>
<code>geom_line(aes(group=1), alpha=0.3) + xlab("Day of the Week") +</code>
<code>ylab("Total Motor Vehicle Thefts")</code>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> Video 4: A Heatmap</h3>
<div class="outline-text-3" id="text-2-7">
<p>
we'll add the hour of the day to our line plot, and then create an
alternative visualization using a heat map. We can do this by creating
a line for each day of the week and making the x-axis the hour of the
day. We first need to create a counts table for the weekday, and hour.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Create a counts table for the weekday and hour:"</span>)
table(mvt$Weekday, mvt$Hour)
</pre>
</div>

<pre class="example">
:: Create a counts table for the weekday and hour:

              0    1    2    3    4    5    6    7    8    9   10   11   12
 Friday    1873  932  743  560  473  602  839 1203 1268 1286  938  822 1207
 Monday    1900  825  712  527  415  542  772 1123 1323 1235  971  737 1129
 Saturday  2050 1267  985  836  652  508  541  650  858 1039  946  789 1204
 Sunday    2028 1236 1019  838  607  461  478  483  615  864  884  787 1192
 Thursday  1856  816  696  508  400  534  799 1135 1298 1301  932  731 1093
 Tuesday   1691  777  603  464  414  520  845 1118 1175 1174  948  786 1108
 Wednesday 1814  790  619  469  396  561  862 1140 1329 1237  947  763 1225

             13   14   15   16   17   18   19   20   21   22   23
 Friday     857  937 1140 1165 1318 1623 1652 1736 1881 2308 1921
 Monday     824  958 1059 1136 1252 1518 1503 1622 1815 2009 1490
 Saturday   767  963 1086 1055 1084 1348 1390 1570 1702 2078 1750
 Sunday     789  959 1037 1083 1160 1389 1342 1706 1696 2079 1584
 Thursday   752  831 1044 1131 1258 1510 1537 1668 1776 2134 1579
 Tuesday    762  908 1071 1090 1274 1553 1496 1696 1816 2044 1458
 Wednesday  804  863 1075 1076 1289 1580 1507 1718 1748 2093 1511
</pre>

<p>
This table gives, for each day of the week and each hour, the total
number of motor vehicle thefts that occurred. For example, on Friday
at 4 AM, there were 473 motor vehicle thefts, whereas on Saturday at
midnight, there were 2,050 motor vehicle thefts. Let's save this table
to a data frame so that we can use it in our visualizations.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Save this to a data frame:"</span>)
DayHourCounts <span style="color: #db7093;">&lt;-</span> as.data.frame(table(mvt$Weekday, mvt$Hour))
str(DayHourCounts)
</pre>
</div>

<pre class="example">
 :: Save this to a data frame:
'data.frame':   168 obs. of  3 variables:
 $ Var1: Factor w/ 7 levels "Friday","Monday",..: 1 2 3 4 5 6 7 1 2 3 ...
 $ Var2: Factor w/ 24 levels "0","1","2","3",..: 1 1 1 1 1 1 1 2 2 2 ...
 $ Freq: int  1873 1900 2050 2028 1856 1691 1814 932 825 1267 ...
</pre>

<p>
Let's take a look at the structure of the data frame we just
created. We can see that we have 168 observations&#x2013; one for each day
of the week and hour pair, and three different variables.
</p>

<p>
The first variable, <code>Var1, gives the day of the week. The second
variable, ~Var2</code>, gives the hour of the day. And the third variable,
<code>Freq</code> for frequency, gives the total crime count.
</p>

<p>
Let's convert the second variable, <code>Var2</code>, to actual numbers and call
it <code>Hour</code>, since this is the hour of the day, and it makes sense that
it's numerical.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Convert the second variable, Var2, to numbers and call it Hour..."</span>)
DayHourCounts$Hour <span style="color: #db7093;">&lt;-</span> as.numeric(as.character(DayHourCounts$Var2))
</pre>
</div>

<pre class="example">
:: Convert the second variable, Var2, to numbers and call it Hour...
</pre>

<p>
This is how we convert a factor variable to a numeric variable. Now
we're ready to create our plot. We just need to change the group to
<code>Var1</code>, which is the day of the week.
</p>


<div id="fig:MVTHeatCrimePlot01" class="figure">
<p><img src="../graphs/MVTHeatCrimePlot01.png" alt="MVTHeatCrimePlot01.png" />
</p>
<p><span class="figure-number">Figure 52:</span> MVT Chicago heat plot v1</p>
</div>

<p>
You should see a new plot show up in the graphics window. It has seven
lines, one for each day of the week. While this is interesting, we
can't tell which line is which day, so let's change the colors of the
lines to correspond to the days of the week.
</p>


<div id="fig:MVTHeatCrimePlot02" class="figure">
<p><img src="../graphs/MVTHeatCrimePlot02.png" alt="MVTHeatCrimePlot02.png" />
</p>
<p><span class="figure-number">Figure 53:</span> MVT heat crime plot v2</p>
</div>

<p>
Now in our plot, each line is colored corresponding to the day of the
week. This helps us see that on Saturday and Sunday, for example, the
green and the teal lines, there's less motor vehicle thefts in the
morning.
</p>

<p>
Working a little with the plot:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Separate the weekends from the weekdays..."</span>)
DayHourCounts$Type <span style="color: #db7093;">&lt;-</span> ifelse((DayHourCounts$Var1 == <span style="color: #ff6a6a;">"Sunday"</span>) |
                                     (DayHourCounts$Var1 ==
                                              <span style="color: #ff6a6a;">"Saturday"</span>), <span style="color: #ff6a6a;">"Weekend"</span>,
                             <span style="color: #ff6a6a;">"Weekday"</span>)
</pre>
</div>

<pre class="example">
:: Separate the weekends from the weekdays...
</pre>


<div id="fig:MVTHeatCrimePlot03" class="figure">
<p><img src="../graphs/MVTHeatCrimePlot03.png" alt="MVTHeatCrimePlot03.png" />
</p>
<p><span class="figure-number">Figure 54:</span> MVT heat plot previous v3</p>
</div>

<p>
This configuration is little hard to read too, we can try again and
see if is possible to improve the visualization.
</p>


<div id="fig:MVtHeatCrimePlot04" class="figure">
<p><img src="../graphs/MVtHeatCrimePlot04.png" alt="MVtHeatCrimePlot04.png" />
</p>
<p><span class="figure-number">Figure 55:</span> MVT heat crime plot v4</p>
</div>

<p>
While we can get some information from this plot, it's still quite
hard to interpret. Seven lines is a lot.
</p>

<p>
Let's instead visualize the same information with a heat map. To make
a heat map, we'll use our data in our data frame
<code>DayHourCounts</code>. First, though, we need to fix the order of the days
so that they'll show up in chronological order instead of in
alphabetical order.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Fix the order of the days..."</span>)
DayHourCounts$Var1 <span style="color: #db7093;">&lt;-</span> factor(DayHourCounts$Var1, ordered = <span style="color: #3cb371;">TRUE</span>,
                             levels = c(<span style="color: #ff6a6a;">"Monday"</span>, <span style="color: #ff6a6a;">"Tuesday"</span>,
                                        <span style="color: #ff6a6a;">"Wednesday"</span>, <span style="color: #ff6a6a;">"Thursday"</span>,
                                        <span style="color: #ff6a6a;">"Friday"</span>, <span style="color: #ff6a6a;">"Saturday"</span>,
                                        <span style="color: #ff6a6a;">"Sunday"</span>))
</pre>
</div>

<pre class="example">
:: Fix the order of the days...
</pre>

<p>
Now let's make our heat map. In the aesthetic for our tiles, we want
the fill to be equal to <code>Freq</code>. This will define the colors of the
rectangles in our heat map to correspond to the total crime.
</p>


<div id="fig:MVTHeatCrimeMapR1" class="figure">
<p><img src="../graphs/MVTHeatCrimeMapR1.png" alt="MVTHeatCrimeMapR1.png" />
</p>
<p><span class="figure-number">Figure 56:</span> New MVT heat Chicago crime plot v1</p>
</div>

<p>
<b>So how do we read this?</b> For each hour and each day of the week, we
have a rectangle in our heat map. The color of that rectangle
indicates the frequency, or the number of crimes that occur in that
hour and on that day.
</p>

<p>
Our legend tells us that lighter colors correspond to more crime. So
we can see that a lot of crime happens around midnight, particularly
on the weekends.
</p>

<p>
We can change the label on the legend, and get rid of the y label to
make our plot a little nicer.
</p>


<div id="fig:MVTHeatCrimeMapR2" class="figure">
<p><img src="../graphs/MVTHeatCrimeMapR2.png" alt="MVTHeatCrimeMapR2.png" />
</p>
<p><span class="figure-number">Figure 57:</span> MVT Chicago's heat crime plot v2</p>
</div>

<p>
We can also change the color scheme.
</p>


<div id="fig:MVTHeatCrimeMapR3" class="figure">
<p><img src="../graphs/MVTHeatCrimeMapR3.png" alt="MVTHeatCrimeMapR3.png" />
</p>
<p><span class="figure-number">Figure 58:</span> MVT Chicago's heat crime plot v3</p>
</div>

<p>
This is a common color scheme in policing. It shows the hot spots, or
the places with more crime, in red. So now the most crime is shown by
the red spots and the least crime is shown by the lighter areas.
</p>

<p>
It looks like Friday night is a pretty common time for motor vehicle
thefts. We saw something that we didn't really see in the heat map
before.
</p>

<p>
It's often useful to change the color scheme depending on whether you
want high values or low values to pop out, and the feeling you want
the plot to portray.
</p>
</div>
</div>

<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> Quick Question (2 points possible)</h3>
<div class="outline-text-3" id="text-2-8">
<p>
In this quick question, we'll ask you questions about the following
plots. Plot (1) is the heat map we generated at the end of
Video 4. Plot (2) and Plot (3) were generated by changing argument
values of the command used to generate Plot (1).
</p>

<p>
<b>Plot (1)</b>
</p>


<div class="figure">
<p><img src="../graphs/Week8_Crime_QQ4_1.png" alt="Week8_Crime_QQ4_1.png" />
</p>
</div>

<p>
<b>Plot (2)</b>
</p>


<div class="figure">
<p><img src="../graphs/Week8_Crime_QQ4_2.png" alt="Week8_Crime_QQ4_2.png" />
</p>
</div>

<p>
<b>Plot (3)</b>
</p>


<div class="figure">
<p><img src="../graphs/Week8_Crime_QQ4_3.png" alt="Week8_Crime_QQ4_3.png" />
</p>
</div>
</div>


<div id="outline-container-sec-2-8-1" class="outline-4">
<h4 id="sec-2-8-1"><span class="section-number-4">2.8.1</span> Question a</h4>
<div class="outline-text-4" id="text-2-8-1">

<div id="fig:MVTQQa" class="figure">
<p><img src="../graphs/MVTQQa.png" alt="MVTQQa.png" />
</p>
<p><span class="figure-number">Figure 62:</span> Rotating MVT heat plot QQa</p>
</div>

<p>
Which argument(s) did we change to get Plot (2)? Select all that
apply.
</p>

<ul class="org-ul">
<li><code>[X]</code> x
</li>
<li><code>[X]</code> y
</li>
<li><code>[&#xa0;]</code> fill
</li>
<li><code>[&#xa0;]</code> name
</li>
<li><code>[&#xa0;]</code> low
</li>
<li><code>[&#xa0;]</code> high
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
To get Plot (2), we changed the arguments "x" and "y" (we flipped
them). Plot (2) can be generated with the following code:
</p>

<p>
<code>ggplot(DayHourCounts, aes(x = Var1, y = Hour)) +</code>
<code>geom_tile(aes(fill=Freq)) + scale_fill_gradient(name="Total MV</code>
<code>Thefts", low="white", high="red") +</code>
<code>theme(axis.title.y=element_blank())</code>
</p>
</div>
</div>

<div id="outline-container-sec-2-8-2" class="outline-4">
<h4 id="sec-2-8-2"><span class="section-number-4">2.8.2</span> Question</h4>
<div class="outline-text-4" id="text-2-8-2">

<div id="fig:MVTQQb" class="figure">
<p><img src="../graphs/MVTQQb.png" alt="MVTQQb.png" />
</p>
<p><span class="figure-number">Figure 63:</span> MVT heat plot QQb</p>
</div>

<p>
Which argument(s) did we change to get Plot (3)? Select all that
apply.
</p>

<ul class="org-ul">
<li><code>[&#xa0;]</code> x
</li>
<li><code>[&#xa0;]</code> y
</li>
<li><code>[&#xa0;]</code> fill
</li>
<li><code>[&#xa0;]</code> name
</li>
<li><code>[&#xa0;]</code> low
</li>
<li><code>[X]</code> high
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
To get Plot (3), we changed the argument "high" to "black". Plot (3)
can be generated with the following code:
</p>

<p>
<code>ggplot(DayHourCounts, aes(x = Hour, y = Var1)) +</code>
<code>geom_tile(aes(fill=Freq)) + scale_fill_gradient(name="Total MV</code>
<code>Thefts", low="white", high="black") +</code>
<code>theme(axis.title.y=element_blank())</code>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9"><span class="section-number-3">2.9</span> Video 5: A Geographical Hot Spot Map</h3>
<div class="outline-text-3" id="text-2-9">
<p>
We will plot crime on a map of Chicago. First, we need to install and
load two new packages, the <code>maps</code> package and the <code>ggmap</code> package.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Install new package: maps ..."</span>)
<span style="color: #9932cc;">## </span><span style="color: #ba55d3;">install.packages(c('maps', 'ggmap'), repos='http://cran.rstudio.com/')</span>
writeLines(<span style="color: #ff6a6a;">"\n :: NOTE: Please comment after install once..."</span>)

<span style="color: #db7093;">library</span>(maps)
<span style="color: #db7093;">library</span>(ggmap)
writeLines(<span style="color: #ff6a6a;">"\n :: Library maps loaded..."</span>)
</pre>
</div>

<pre class="example">
 :: Install new package: maps ...

 :: NOTE: Please comment after install once...
Google Maps API Terms of Service: http://developers.google.com/maps/terms.
Please cite ggmap if you use it: see citation('ggmap') for details.

 :: Library maps loaded...
</pre>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Load a map of Chicago into R..."</span>)
chicago <span style="color: #db7093;">&lt;-</span> get_map(location = <span style="color: #ff6a6a;">"chicago"</span>, zoom = 11)
</pre>
</div>

<pre class="example">
 :: Load a map of Chicago into R...
Map from URL : http://maps.googleapis.com/maps/api/staticmap?center=chicago&amp;zoom=11&amp;size=640x640&amp;scale=2&amp;maptype=terrain&amp;language=en-EN&amp;sensor=false
Information from URL : http://maps.googleapis.com/maps/api/geocode/json?address=chicago&amp;sensor=false
</pre>


<div id="fig:MVTChicagoMap01" class="figure">
<p><img src="../graphs/MVTChicagoMap01.png" alt="MVTChicagoMap01.png" />
</p>
<p><span class="figure-number">Figure 64:</span> MVT Chicago's crime map v1</p>
</div>

<p>
You should see a geographical map of the city of Chicago. Now let's
plot the first 100 motor vehicle thefts in our data set on this map.
</p>


<div id="fig:MVTChicagoMap02" class="figure">
<p><img src="../graphs/MVTChicagoMap02.png" alt="MVTChicagoMap02.png" />
</p>
<p><span class="figure-number">Figure 65:</span> MVT Chicago's crime map v2</p>
</div>

<p>
You should see the map of Chicago with black points marking where the
first 100 motor vehicle thefts were. If we plotted all 190,000 motor
vehicle thefts, we would just see a big black box, which wouldn't be
helpful at all.
</p>

<p>
We're more interested in whether or not an area has a high amount of
crime, so let's round our latitude and longitude to two digits of
accuracy and create a crime counts data frame for each area.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Round our latitude and longitude to 2 digits of accuracy,\nand create a crime counts data frame for each area:"</span>)
LatLonCounts <span style="color: #db7093;">&lt;-</span> as.data.frame(table(round(mvt$Longitude, 2),
                                    round(mvt$Latitude, 2)))
str(LatLonCounts)
</pre>
</div>

<pre class="example">
 :: Round our latitude and longitude to 2 digits of accuracy,
and create a crime counts data frame for each area:
'data.frame':   1638 obs. of  3 variables:
 $ Var1: Factor w/ 42 levels "-87.93","-87.92",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ Var2: Factor w/ 39 levels "41.64","41.65",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Freq: int  0 0 0 0 0 0 0 0 0 0 ...
</pre>

<p>
This gives us the total crimes at every point on a grid. Let's take a
look at our data frame using the <code>str</code> function. We have 1,638
observations and three variables.
</p>

<p>
The first two variables, <code>Var1</code> and <code>Var2</code>, are the latitude and
longitude coordinates, and the third variable is the number of motor
vehicle thefts that occur in that area.
</p>

<p>
Let's convert our longitude and latitude variables to numbers and call
them <code>Lat</code> and <code>Long</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Convert our Longitude and Latitude variable to numbers..."</span>)
LatLonCounts$Long <span style="color: #db7093;">&lt;-</span> as.numeric(as.character(LatLonCounts$Var1))
LatLonCounts$Lat <span style="color: #db7093;">&lt;-</span> as.numeric(as.character(LatLonCounts$Var2))
</pre>
</div>

<pre class="example">
:: Convert our Longitude and Latitude variable to numbers...
</pre>

<p>
Now, let's plot these points on our map, making the size and color of
the points depend on the total number of motor vehicle thefts.
</p>


<div id="fig:MVTChicagoMap03" class="figure">
<p><img src="../graphs/MVTChicagoMap03.png" alt="MVTChicagoMap03.png" />
</p>
<p><span class="figure-number">Figure 66:</span> MVT Chicago's crime map v3</p>
</div>

<p>
So we can see that the lighter and larger points correspond to more
motor vehicle thefts. This helps us see where in Chicago more crimes
occur. If we want to change the color scheme,
</p>


<div id="fig:MVTChicagoMap04" class="figure">
<p><img src="../graphs/MVTChicagoMap04.png" alt="MVTChicagoMap04.png" />
</p>
<p><span class="figure-number">Figure 67:</span> MVT Chicago's crime map v4</p>
</div>

<p>
you should see the same plot as before, but this time, the areas with
more crime are closer to red and the areas with less crime are closer
to yellow.
</p>

<p>
We can also use geom_tile to make something that looks more like a
traditional heat map.
</p>


<div id="fig:MVTChicagoMap05" class="figure">
<p><img src="../graphs/MVTChicagoMap05.png" alt="MVTChicagoMap05.png" />
</p>
<p><span class="figure-number">Figure 68:</span> MVT Chicago's crime map v5</p>
</div>

<p>
We have <code>alpha=Freq</code>. This will define how to scale the colors on the
heat map according to the crime counts.
</p>

<p>
We've created a geographical heat map, which in our case shows a
visualization of the data, but it could also show the predictions of a
model. Now that our heat map is loaded, let's take a look.
</p>

<p>
In each area of Chicago, now that area is colored in red by the amount
of crime there. This looks more like a map that people use for
predictive policing.
</p>
</div>
</div>

<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10"><span class="section-number-3">2.10</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-2-10">
<p>
In the previous video, our heatmap was plotting squares out in the
water, which seems a little strange. We can fix this by removing the
observations from our data frame that have <code>Freq = 0</code>.
</p>

<p>
Take a subset of <code>LatLonCounts</code>, only keeping the observations for which
<code>Freq &gt; 0</code>, and call it <code>LatLonCounts2</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: removing the observations that have Freq = 0..."</span>)
str(LatLonCounts)
LatLonCounts2 <span style="color: #db7093;">&lt;-</span> subset(LatLonCounts, LatLonCounts$Freq &gt; 0)

writeLines(<span style="color: #ff6a6a;">"\n :: The number of observations removed:"</span>)
nrow(LatLonCounts) - nrow(LatLonCounts2)
</pre>
</div>

<pre class="example">
 :: removing the observations that have Freq = 0...
'data.frame':	1638 obs. of  5 variables:
 $ Var1: Factor w/ 42 levels "-87.93","-87.92",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ Var2: Factor w/ 39 levels "41.64","41.65",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Freq: int  0 0 0 0 0 0 0 0 0 0 ...
 $ Long: num  -87.9 -87.9 -87.9 -87.9 -87.9 ...
 $ Lat : num  41.6 41.6 41.6 41.6 41.6 ...

 :: The number of observations removed:
[1] 952
</pre>

<p>
Redo the heatmap from the end of Video 5, using <code>LatLonCounts2</code>
instead of <code>LatLonCounts</code>. You should no longer see any squares out in
the water, or in any areas where there were no motor vehicle thefts.
</p>


<div id="fig:MVTChicagoMap06" class="figure">
<p><img src="../graphs/MVTChicagoMap06.png" alt="MVTChicagoMap06.png" />
</p>
<p><span class="figure-number">Figure 69:</span> MVT Chicago's crime map v6</p>
</div>
</div>

<div id="outline-container-sec-2-10-1" class="outline-4">
<h4 id="sec-2-10-1"><span class="section-number-4">2.10.1</span> Question</h4>
<div class="outline-text-4" id="text-2-10-1">
<p>
How many observations did we remove?
</p>
</div>

<div id="outline-container-sec-2-10-1-1" class="outline-5">
<h5 id="sec-2-10-1-1"><span class="section-number-5">2.10.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-2-10-1-1">
<p>
952
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can take a subset of LatLonCounts, only keeping the observations
for which <code>Freq &gt; 0</code> with the following command:
</p>

<p>
<code>LatLonCounts2 = subset(LatLonCounts, Freq &gt; 0)</code>
</p>

<p>
Then, you can generate the new heatmap with the following command:
</p>

<p>
<code>ggmap(chicago) +</code>
<code>geom_tile(data=LatLonCounts2, aes(x = Long, y = Lat, alpha=Freq), fill="red")</code>
4
The number of observations in <code>LatLonCounts2</code> is $686, and the number of
observations in <code>LatLonCounts</code> is \(1638\). These numbers can be found by
using <code>nrow</code> or <code>str</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11"><span class="section-number-3">2.11</span> Video 6: A Heatmap on the United States</h3>
<div class="outline-text-3" id="text-2-11">
<p>
In this video, we'll be using the dataset <a href="https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/murders.csv">murders.csv</a>. This data is
provided by the U.S. Census Bureau and the FBI, and is described
<a href="http://en.wikipedia.org/wiki/Gun_violence_in_the_United_States_by_state">here</a>.
</p>

<p>
We will create a heat map on a map of the United States. We'll be
using the data set murders.csv, which is data provided by the FBI
giving the total number of murders in the United States by state.
</p>
</div>

<div id="outline-container-sec-2-11-1" class="outline-4">
<h4 id="sec-2-11-1"><span class="section-number-4">2.11.1</span> Download the data sets</h4>
<div class="outline-text-4" id="text-2-11-1">
<p>
In this part we can download the data
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/murders.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"murders.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)

<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}

list.files(<span style="color: #ff6a6a;">"../data"</span>)
</pre>
</div>

<pre class="example">
 [1] "AirlinesCluster.csv"     "AnonymityPoll.csv"
 [3] "baseball.csv"            "BoeingStock.csv"
 [5] "boston.csv"              "ClaimsData.csv"
 [7] "ClaimsData.csv.zip"      "climate_change.csv"
 [9] "clinical_trial.csv"      "ClusterMeans.ods"
[11] "CocaColaStock.csv"       "CountryCodes.csv"
[13] "CPSData.csv"             "dailykos.csv"
[15] "eBayiPadTest.csv"        "eBayiPadTrain.csv"
[17] "emails.csv"              "energy_bids.csv"
[19] "flower.csv"              "FluTest.csv"
[21] "FluTrain.csv"            "framingham.csv"
[23] "gerber.csv"              "GEStock.csv"
[25] "healthy.csv"             "IBMStock.csv"
[27] "loans_imputed.csv"       "loans.csv"
[29] "MetroAreaCodes.csv"      "movieLens.txt"
[31] "murders.csv"             "mvt.csv"
[33] "mvtWeek1.csv"            "NBA_test.csv"
[35] "NBA_train.csv"           "parole.csv"
[37] "pisa2009test.csv"        "pisa2009train.csv"
[39] "PollingData_Imputed.csv" "PollingData.csv"
[41] "ProcterGambleStock.csv"  "quality.csv"
[43] "README.md"               "SampleSubmission.csv"
[45] "songs.csv"               "stevens.csv"
[47] "StocksCluster.csv"       "stopwords.txt"
[49] "tumor.csv"               "tweets.csv"
[51] "USDA.csv"                "WHO_Europe.csv"
[53] "WHO.csv"                 "WHOu7.csv"
[55] "wiki.csv"                "wine_test.csv"
[57] "wine.csv"
</pre>
</div>
</div>

<div id="outline-container-sec-2-11-2" class="outline-4">
<h4 id="sec-2-11-2"><span class="section-number-4">2.11.2</span> Load the data set</h4>
<div class="outline-text-4" id="text-2-11-2">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Loading data into their data frame."</span>)
murders <span style="color: #db7093;">&lt;-</span> read.csv(<span style="color: #ff6a6a;">"../data/murders.csv"</span>)
str(murders)
</pre>
</div>

<pre class="example">
 :: Loading data into their data frame.
'data.frame':   51 obs. of  6 variables:
 $ State            : Factor w/ 51 levels "Alabama","Alaska",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ Population       : int  4779736 710231 6392017 2915918 37253956 5029196 3574097 897934 601723 19687653 ...
 $ PopulationDensity: num  94.65 1.26 57.05 56.43 244.2 ...
 $ Murders          : int  199 31 352 130 1811 117 131 48 131 987 ...
 $ GunMurders       : int  135 19 232 93 1257 65 97 38 99 669 ...
 $ GunOwnership     : num  0.517 0.578 0.311 0.553 0.213 0.347 0.167 0.255 0.036 0.245 ...
</pre>

<p>
Let's take a look at the structure of this data using the <code>str</code>
function. We have 51 observations for the 50 states plus Washington,
DC, and six different variables:
</p>

<p>
The name of the state, the population, the population density, the
number of murders, the number of murders that used guns, and the rate
of gun ownership.
</p>

<p>
A map of the United States is included in R. Let's load the map and
call it <code>statesMap</code>.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Load the map of the US..."</span>)
statesMap <span style="color: #db7093;">&lt;-</span> map_data(<span style="color: #ff6a6a;">"state"</span>)
str(statesMap)
</pre>
</div>

<pre class="example">
 :: Load the map of the US...
'data.frame':   15537 obs. of  6 variables:
 $ long     : num  -87.5 -87.5 -87.5 -87.5 -87.6 ...
 $ lat      : num  30.4 30.4 30.4 30.3 30.3 ...
 $ group    : num  1 1 1 1 1 1 1 1 1 1 ...
 $ order    : int  1 2 3 4 5 6 7 8 9 10 ...
 $ region   : chr  "alabama" "alabama" "alabama" "alabama" ...
 $ subregion: chr  NA NA NA NA ...
</pre>

<p>
Let's see what this looks like by typing in <code>str(statesMap)</code>. This is
just a data frame summarizing how to draw the United States. To plot
the map, we'll use the polygons geometry of <code>ggplot</code>.
</p>


<div id="fig:USMurderMap01" class="figure">
<p><img src="../graphs/USMurderMap01.png" alt="USMurderMap01.png" />
</p>
<p><span class="figure-number">Figure 70:</span> US murder map v1</p>
</div>

<p>
Now in your R graphics window, you should see a map of the United
States. Before we can plot our data on this map, we need to make sure
that the state names are the same in the <code>murders</code> data frame and in the
<code>statesMap</code> data frame.
</p>

<p>
In the <code>murders</code> data frame, our state names are in the <code>State</code> variable,
and they start with a capital letter. But in the <code>statesMap</code> data frame,
our state names are in the <code>region</code> variable, and they're all
lowercase.
</p>

<p>
So let's create a new variable called <code>region</code> in our <code>murders</code> data
frame to match the state name variable in the <code>statesMap</code> data
frame. So we'll add to our murders data frame the variable <code>region</code>,
which will be equal to the lowercase version&#x2013; using the <code>tolower</code>
function that we used in the text analytics lectures.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Create a new variable called region with the\nlowercase names to match the statesMap..."</span>)
murders$region <span style="color: #db7093;">&lt;-</span> tolower(murders$State)
</pre>
</div>

<pre class="example">
 :: Create a new variable called region with the
lowercase names to match the statesMap...
</pre>

<p>
This will just convert the <code>State</code> variable to all lowercase letters
and store it as a new variable called <code>region</code>.
</p>

<p>
Now we can join the <code>statesMap</code> data frame with the <code>murders</code> data
frame by using the <code>merge</code> function, which matches rows of a data
frame based on a shared identifier.
</p>

<p>
We just defined the variable <code>region</code>, which exists in both data
frames.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Join the statesMap data and the murders data into one dataframe:"</span>)
murderMap <span style="color: #db7093;">&lt;-</span> merge(statesMap, murders, by = <span style="color: #ff6a6a;">"region"</span>)
str(murderMap)
</pre>
</div>

<pre class="example">
 :: Join the statesMap data and the murders data into one dataframe:
'data.frame':	15537 obs. of  12 variables:
 $ region           : chr  "alabama" "alabama" "alabama" "alabama" ...
 $ long             : num  -87.5 -87.5 -87.5 -87.5 -87.6 ...
 $ lat              : num  30.4 30.4 30.4 30.3 30.3 ...
 $ group            : num  1 1 1 1 1 1 1 1 1 1 ...
 $ order            : int  1 2 3 4 5 6 7 8 9 10 ...
 $ subregion        : chr  NA NA NA NA ...
 $ State            : Factor w/ 51 levels "Alabama","Alaska",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Population       : int  4779736 4779736 4779736 4779736 4779736 4779736 4779736 4779736 4779736 4779736 ...
 $ PopulationDensity: num  94.7 94.7 94.7 94.7 94.7 ...
 $ Murders          : int  199 199 199 199 199 199 199 199 199 199 ...
 $ GunMurders       : int  135 135 135 135 135 135 135 135 135 135 ...
 $ GunOwnership     : num  0.517 0.517 0.517 0.517 0.517 0.517 0.517 0.517 0.517 0.517 ...
</pre>

<p>
We have the same number of observations here that we had in the
<code>statesMap</code> data frame, but now we have both the variables from the
<code>statesMap</code> data frame and the variables from the <code>murders</code> data
frame, which were matched up based on the region variable.
</p>

<p>
So now, let's plot the number of murders on our map of the United
States.
</p>


<div id="fig:USMurderMap02" class="figure">
<p><img src="../graphs/USMurderMap02.png" alt="USMurderMap02.png" />
</p>
<p><span class="figure-number">Figure 71:</span> US murder map v2</p>
</div>

<p>
Look at your graphics window now, you should see that each of the
states is colored by the number of murders in that state. States with
a larger number of murders are more red. So it looks like California
and Texas have the largest number of murders.
</p>

<p>
But <b>is that just because they're the most populous states?</b> Let's
create a map of the population of each state to check.
</p>


<div id="fig:USPopulationMapv1" class="figure">
<p><img src="../graphs/USPopulationMapv1.png" alt="USPopulationMapv1.png" />
</p>
<p><span class="figure-number">Figure 72:</span> US population map v1</p>
</div>

<p>
We have a population map here which looks exactly the same as our
murders map. So we need to plot the murder rate instead of the number
of murders to make sure we're not just plotting a population map.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Create a new variable that is the number of murders per\n\t100,000 population..."</span>)
murderMap$MurderRate <span style="color: #db7093;">&lt;-</span> murderMap$Murders / murderMap$Population * 100000
</pre>
</div>

<pre class="example">
:: Create a new variable that is the number of murders per
       100,000 population...
</pre>

<p>
So we've created a new variable that's the number of murders per
100,000 population.
</p>

<p>
Now let's redo our plot with the fill equal to <code>MurderRate</code>.
</p>


<div id="fig:USMurderMap03" class="figure">
<p><img src="../graphs/USMurderMap03.png" alt="USMurderMap03.png" />
</p>
<p><span class="figure-number">Figure 73:</span> US murder map v3</p>
</div>

<p>
If you look at your graphics window now, you should see that the plot
is surprisingly maroon-looking. There aren't really any red states.
</p>

<p>
<b>Why?</b>
</p>

<p>
It turns out that Washington, DC is an outlier with a very high murder
rate, but it's such a small region on the map that we can't even see
it.
</p>

<p>
So let's redo our plot, removing any observations with murder rates
above 10, which we know will only exclude Washington, DC. Keep in mind
that when interpreting and explaining the resulting plot, you should
always note what you did to create it: removed Washington, DC from the
data.
</p>


<div id="fig:USMurderMap03" class="figure">
<p><img src="../graphs/USMurderMap03.png" alt="USMurderMap03.png" />
</p>
<p><span class="figure-number">Figure 74:</span> US murder map v3 (Removing Washington DC.)</p>
</div>

<p>
Now if you look back at your graphics window, you can see a range of
colors on the map. In this video, we saw how we can make a heat map on
a map of the United States, which is very useful for organizations
like the World Health Organization or government entities who want to
show data to the public organized by state or country.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-12" class="outline-3">
<h3 id="sec-2-12"><span class="section-number-3">2.12</span> Quick Question (1 point possible)</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Redo the map from Video 6, but this time fill each state with the
variable <code>GunOwnership</code>. This shows the percentage of people in each
state who own a gun.
</p>


<div id="fig:USMurderMapGunOwnership" class="figure">
<p><img src="../graphs/USMurderMapGunOwnership.png" alt="USMurderMapGunOwnership.png" />
</p>
<p><span class="figure-number">Figure 75:</span> US murder map filled with GunOwnership variable</p>
</div>

<p>
Which of the following states has the highest gun ownership rate? To
see the state labels, take a look at the World Atlas map <a href="http://www.worldatlas.com/webimage/testmaps/usanames.htm">here</a>.
</p>


<div class="figure">
<p><img src="../graphs/USNameStates.png" alt="USNameStates.png" />
</p>
</div>

<p>
<b>Explanation</b>
</p>

<p>
You can generate the gun ownership plot using the following command:
</p>

<p>
<code>ggplot(murderMap, aes(x = long, y = lat, group=group, fill =</code>
<code>GunOwnership)) + geom_polygon(color="black") + scale_fill_gradient(low</code>
<code>= "black", high = "red", guide="legend")</code>
</p>

<p>
Of these five states, the one that is the most red is <b>Montana</b>.
</p>
</div>
</div>

<div id="outline-container-sec-2-13" class="outline-3">
<h3 id="sec-2-13"><span class="section-number-3">2.13</span> Video 7: The Analytics Edge</h3>
<div class="outline-text-3" id="text-2-13">
<p>
Let me comment on the merits of heatmaps as a way of representing data
in the context of representing crime activity.
</p>


<div class="figure">
<p><img src="../graphs/AP-EyeOnCrime.png" alt="AP-EyeOnCrime.png" />
</p>
</div>

<p>
<b>What is the edge of predictive policing?</b> Many police forces are
exploiting their databases to focus finite resources on problem areas.
</p>


<div class="figure">
<p><img src="../graphs/AP-PredictivePolicing02.png" alt="AP-PredictivePolicing02.png" />
</p>
</div>

<p>
The application of analytics to data like this is new and growing,
with companies like <b>PredPol</b> and <b>Palantir</b> leading the effort.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 22/07/2015</p>
<p class="author">Author: Sergio-Feliciano Mendoza-Barrera</p>
<p class="date">Created: 2015-07-23 Thu 10:33</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
