<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Assignment 7. Visualization</title>
<!-- 2015-07-25 Sat 08:29 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Sergio-Feliciano Mendoza-Barrera" />
<meta  name="description" content="Unit 7 Visualization Assignment of the Analytical Edge course"
 />
<meta  name="keywords" content="R, data science, emacs, ESS, org-mode, the analytical edge, visualization" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Assignment 7. Visualization</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Election Forecasting Revisited</a>
<ul>
<li><a href="#sec-1-1">1.1. Problem 1.1 - Drawing a Map of the US (1 point possible)</a></li>
<li><a href="#sec-1-2">1.2. Problem 1.2 - Drawing a Map of the US (1 point possible)</a></li>
<li><a href="#sec-1-3">1.3. Problem 2.1 - Coloring the States by Predictions (2 points possible)</a></li>
<li><a href="#sec-1-4">1.4. Problem 2.2 - Coloring the States by Predictions (2 points possible)</a></li>
<li><a href="#sec-1-5">1.5. Problem 2.3 - Coloring the States by Predictions (1 point possible)</a></li>
<li><a href="#sec-1-6">1.6. Problem 2.4 - Coloring the States by Predictions (1 point possible)</a></li>
<li><a href="#sec-1-7">1.7. Problem 2.5 - Coloring the States by Predictions (1 point possible)</a></li>
<li><a href="#sec-1-8">1.8. Problem 3.1 - Understanding the Predictions (1 point possible)</a></li>
<li><a href="#sec-1-9">1.9. Problem 3.2 - Understanding the Predictions (2 points possible)</a></li>
<li><a href="#sec-1-10">1.10. Problem 4 - Parameter Settings</a></li>
<li><a href="#sec-1-11">1.11. Problem 4.1 - Parameter Settings (2/2 points)</a></li>
<li><a href="#sec-1-12">1.12. Problem 4.2 - Parameter Settings (1 point possible)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="abstract">
<p>
Unit 7 Visualization assignment of The Analytical Edge course from MIT.
</p>

</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Election Forecasting Revisited</h2>
<div class="outline-text-2" id="text-1">
<p>
In the recitation from Unit 3, we used logistic regression on polling
data in order to construct US presidential election predictions. We
separated our data into a training set, containing data from 2004 and
2008 polls, and a test set, containing the data from 2012 polls. We
then proceeded to develop a logistic regression model to forecast the
2012 US presidential election.
</p>

<p>
In this homework problem, we'll revisit our logistic regression model
from Unit 3, and learn how to plot the output on a map of the United
States. Unlike what we did in the Crime lecture, this time we'll be
plotting predictions rather than data!
</p>

<p>
First, load the <code>ggplot2</code>, <code>maps</code>, and <code>ggmap</code> packages using the
library function. All three packages should be installed on your
computer from lecture, but if not, you may need to install them too
using the <code>install.packages</code> function.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Loading the necessary libraries..."</span>)
<span style="color: #db7093;">library</span>(ggplot2)
<span style="color: #db7093;">library</span>(maps)
<span style="color: #db7093;">library</span>(ggmap)
</pre>
</div>

<pre class="example">
 :: Loading the necessary libraries...
Google Maps API Terms of Service: http://developers.google.com/maps/terms.
Please cite ggmap if you use it: see citation('ggmap') for details.
</pre>

<p>
Then, load the US map and save it to the variable statesMap, like we
did during the Crime lecture:
</p>

<p>
<code>statesMap = map_data("state")</code>
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Load the US map in R..."</span>)
statesMap <span style="color: #db7093;">&lt;-</span> map_data(<span style="color: #ff6a6a;">"state"</span>)
</pre>
</div>

<pre class="example">
:: Load the US map in R...
</pre>

<p>
The maps package contains other built-in maps, including a US county
map, a world map, and maps for France and Italy.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Problem 1.1 - Drawing a Map of the US (1 point possible)</h3>
<div class="outline-text-3" id="text-1-1">
<p>
If you look at the structure of the statesMap data frame using the <code>str</code>
function, you should see that there are 6 variables. One of the
variables, group, defines the different shapes or polygons on the
map. Sometimes a state may have multiple groups, for example, if it
includes islands.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Showing the structure of stateMap:"</span>)
str(statesMap)
</pre>
</div>

<pre class="example">
 :: Showing the structure of stateMap:
'data.frame':   15537 obs. of  6 variables:
 $ long     : num  -87.5 -87.5 -87.5 -87.5 -87.6 ...
 $ lat      : num  30.4 30.4 30.4 30.3 30.3 ...
 $ group    : num  1 1 1 1 1 1 1 1 1 1 ...
 $ order    : int  1 2 3 4 5 6 7 8 9 10 ...
 $ region   : chr  "alabama" "alabama" "alabama" "alabama" ...
 $ subregion: chr  NA NA NA NA ...
</pre>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Question</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
How many different groups are there?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The number of groups:"</span>)
str(factor(statesMap$group))

writeLines(<span style="color: #ff6a6a;">"\n :: Another useful way:"</span>)
table(statesMap$group)

writeLines(<span style="color: #ff6a6a;">"\n :: Yet another way to calculate:"</span>)
length(table(statesMap$group))
</pre>
</div>

<pre class="example">
 :: The number of groups:
 Factor w/ 63 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...

 :: Another useful way:

   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16
 202  149  312  516   79   91   94   10  872  381  233  329  257  256  113  397
  17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32
 650  399  566   36  220   30  460  370  373  382  315  238  208   70  125  205
  33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   48
  78   16  290   21  168   37  733   12  105  238  284  236  172   66  304  166
  49   50   51   52   53   54   55   56   57   58   59   60   61   62   63
 289 1088   59  129   96   15  623   17   17   19   44  448  373  388   68

 :: Yet another way to calculate:
[1] 63
</pre>
</div>

<div id="outline-container-sec-1-1-1-1" class="outline-5">
<h5 id="sec-1-1-1-1"><span class="section-number-5">1.1.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<p>
63
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can count the number of different values of the group variable by
using the command <code>table(statesMap$group)</code>. There are \(63\) different
values.
</p>

<p>
Alternatively, you could use the command
</p>

<p>
<code>length(table(statesMap$group))</code>
</p>

<p>
as a shortcut to counting the number of groups in the table output.
</p>

<p>
The variable <code>order</code> defines the order to connect the points within
each group, and the variable <code>region</code> gives the name of the state.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Problem 1.2 - Drawing a Map of the US (1 point possible)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
You can draw a map of the United States by typing the following in
your R console:
</p>


<div id="fig:USmapHW01" class="figure">
<p><img src="../graphs/USmapHW01.png" alt="USmapHW01.png" />
</p>
<p><span class="figure-number">Figure 1:</span> United States map in R</p>
</div>

<p>
We specified two colors in geom_polygon &#x2013; <code>fill</code> and <code>color</code>. Which
one defined the color of the outline of the states?
</p>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> fill
</li>
<li><code>[X]</code> color color - correct
</li>
<li><code>[&#xa0;]</code> Neither
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
In our plot, the states are outlined in black, which is the color we
specified for the option <code>color</code>. To confirm that this is changing the
outline color of the states, you can try re-running the command with a
different color:
</p>


<div id="fig:USMapHW02" class="figure">
<p><img src="../graphs/USMapHW02.png" alt="USMapHW02.png" />
</p>
<p><span class="figure-number">Figure 2:</span> United States map in other outline color</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Problem 2.1 - Coloring the States by Predictions (2 points possible)</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Now, let's color the map of the US according to our 2012 US
presidential election predictions from the Unit 3 Recitation. We'll
rebuild the model here, using the dataset <code>PollingImputed.csv</code>. Be sure
to use this file so that you don't have to redo the imputation to fill
in the missing values, like we did in the Unit 3 Recitation.
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #db7093;">library</span>(parallel)

<span style="color: #4682b4;">if</span>(!file.exists(<span style="color: #ff6a6a;">"../data"</span>)) {
        dir.create(<span style="color: #ff6a6a;">"../data"</span>)
}

fileUrl <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"https://courses.edx.org/asset-v1:MITx+15.071x_2a+2T2015+type@asset+block/PollingImputed.csv"</span>
fileName <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"PollingImputed.csv"</span>
dataPath <span style="color: #db7093;">&lt;-</span> <span style="color: #ff6a6a;">"../data"</span>

filePath <span style="color: #db7093;">&lt;-</span> paste(dataPath, fileName, sep = <span style="color: #ff6a6a;">"/"</span>)

<span style="color: #4682b4;">if</span>(!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method = <span style="color: #ff6a6a;">"curl"</span>)
}

writeLines(<span style="color: #ff6a6a;">"\n :: File downloaded..."</span>)
</pre>
</div>

<pre class="example">
:: File downloaded...
</pre>

<p>
Load the data using the <code>read.csv</code> function, and call it <code>polling</code>. Then
split the data using the subset function into a training set called
<code>Train</code> that has observations from 2004 and 2008, and a testing set
called <code>Test</code> that has observations from 2012.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"    Loading the imputed data into their data frame."</span>)
polling <span style="color: #db7093;">&lt;-</span> read.table(<span style="color: #ff6a6a;">"../data/PollingImputed.csv"</span>, sep = <span style="color: #ff6a6a;">","</span>, header = <span style="color: #3cb371;">TRUE</span>)
str(polling)
table(polling$Year)
summary(polling)
</pre>
</div>

<pre class="example">
    Loading the imputed data into their data frame.
'data.frame':	145 obs. of  7 variables:
 $ State     : Factor w/ 50 levels "Alabama","Alaska",..: 1 1 2 2 3 3 3 4 4 4 ...
 $ Year      : int  2004 2008 2004 2008 2004 2008 2012 2004 2008 2012 ...
 $ Rasmussen : int  11 21 19 16 5 5 8 7 10 13 ...
 $ SurveyUSA : int  18 25 21 18 15 3 5 5 7 21 ...
 $ DiffCount : int  5 5 1 6 8 9 4 8 5 2 ...
 $ PropR     : num  1 1 1 1 1 ...
 $ Republican: int  1 1 1 1 1 1 1 1 1 1 ...

2004 2008 2012
  50   50   45
         State          Year        Rasmussen         SurveyUSA
 Arizona    :  3   Min.   :2004   Min.   :-41.000   Min.   :-33.000
 Arkansas   :  3   1st Qu.:2004   1st Qu.:-10.000   1st Qu.:-11.000
 California :  3   Median :2008   Median :  3.000   Median :  1.000
 Colorado   :  3   Mean   :2008   Mean   :  2.048   Mean   :  1.359
 Connecticut:  3   3rd Qu.:2012   3rd Qu.: 12.000   3rd Qu.: 16.000
 Florida    :  3   Max.   :2012   Max.   : 39.000   Max.   : 30.000
 (Other)    :127
   DiffCount           PropR          Republican
 Min.   :-19.000   Min.   :0.0000   Min.   :0.0000
 1st Qu.: -6.000   1st Qu.:0.0000   1st Qu.:0.0000
 Median :  1.000   Median :0.6250   Median :1.0000
 Mean   : -1.269   Mean   :0.5259   Mean   :0.5103
 3rd Qu.:  4.000   3rd Qu.:1.0000   3rd Qu.:1.0000
 Max.   : 11.000   Max.   :1.0000   Max.   :1.0000
</pre>

<p>
Splitting the dataset in two data frames <code>Train</code> and <code>Test</code> data frames.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Subset data into training set and test set"</span>)
Train <span style="color: #db7093;">&lt;-</span> subset(polling, Year == 2004 | Year == 2008)
Test <span style="color: #db7093;">&lt;-</span> subset(polling, Year == 2012)
</pre>
</div>

<pre class="example">
:: Subset data into training set and test set
</pre>

<p>
Note that we only have 45 states in our testing set, since we are
missing observations for Alaska, Delaware, Alabama, Wyoming, and
Vermont, so these states will not appear colored in our map.
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Revising the Testing data frame structure:"</span>)
str(Test)
</pre>
</div>

<pre class="example">
 :: Revising the Testing data frame structure:
'data.frame':	45 obs. of  7 variables:
 $ State     : Factor w/ 50 levels "Alabama","Alaska",..: 3 4 5 6 7 9 10 11 12 13 ...
 $ Year      : int  2012 2012 2012 2012 2012 2012 2012 2012 2012 2012 ...
 $ Rasmussen : int  8 13 -12 3 -7 2 5 -22 31 -22 ...
 $ SurveyUSA : int  5 21 -14 -2 -13 0 8 -24 24 -16 ...
 $ DiffCount : int  4 2 -6 -5 -8 6 4 -2 1 -5 ...
 $ PropR     : num  0.833 1 0 0.308 0 ...
 $ Republican: int  1 1 0 0 0 0 1 0 1 0 ...
</pre>

<p>
Then, create a logistic regression model and make predictions on the
test set using the following commands:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Creating the Logistic Regression model..."</span>)
mod2 <span style="color: #db7093;">&lt;-</span> glm(Republican ~ SurveyUSA + DiffCount, data = Train,
            family = <span style="color: #ff6a6a;">"binomial"</span>)

writeLines(<span style="color: #ff6a6a;">"\n :: Making preditions from Testing data set..."</span>)
TestPrediction <span style="color: #db7093;">&lt;-</span> predict(mod2, newdata = Test, type = <span style="color: #ff6a6a;">"response"</span>)
</pre>
</div>

<pre class="example">
:: Creating the Logistic Regression model...

:: Making preditions from Testing data set...
</pre>

<p>
<code>TestPrediction</code> gives the predicted probabilities for each state, but
let's also create a vector of Republican/Democrat predictions by using
the following command:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Creting binary preditions with a threshold of 50%..."</span>)
TestPredictionBinary <span style="color: #db7093;">&lt;-</span> as.numeric(TestPrediction &gt; 0.5)
</pre>
</div>

<pre class="example">
:: Creting binary preditions with a threshold of 50%...
</pre>

<p>
Now, put the predictions and state labels in a data.frame so that we
can use <code>ggplot</code>:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: New data frame for plotting purposes..."</span>)
predictionDataFrame <span style="color: #db7093;">&lt;-</span> data.frame(TestPrediction,
                                  TestPredictionBinary, Test$State)
</pre>
</div>

<pre class="example">
:: New data frame for plotting purposes...
</pre>

<p>
To make sure everything went smoothly, answer the following
questions.
</p>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
For how many states is our binary prediction 1 (for 2012),
corresponding to Republican?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Number of states with TestPredictionbinary == 1:"</span>)
nrow(subset(predictionDataFrame, predictionDataFrame$TestPredictionBinary == 1))
</pre>
</div>

<pre class="example">
 :: Number of states with TestPredictionbinary == 1:
[1] 22
</pre>
</div>

<div id="outline-container-sec-1-3-1-1" class="outline-5">
<h5 id="sec-1-3-1-1"><span class="section-number-5">1.3.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-3-1-1">
<p>
22
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> Question</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
What is the average predicted probability of our model (on the Test
set, for 2012)?
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The average predicted probability of our model:"</span>)
mean(predictionDataFrame$TestPrediction)
</pre>
</div>

<pre class="example">
 :: The average predicted probability of our model:
[1] 0.4852626
</pre>
</div>

<div id="outline-container-sec-1-3-2-1" class="outline-5">
<h5 id="sec-1-3-2-1"><span class="section-number-5">1.3.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-3-2-1">
<p>
0.4852626
</p>

<p>
<b>Explanation</b>
</p>

<p>
You can create the data frame predictionDataFrame by running the
following lines of R code:
</p>

<p>
<code>polling = read.csv("PollingImputed.csv")</code>
</p>

<p>
<code>Train = subset(polling, Year &lt; 2012)</code>
</p>

<p>
<code>Test = subset(polling, Year == 2012)</code>
</p>

<p>
<code>mod2 = glm(Republican~SurveyUSA+DiffCount, data=Train, family="binomial")</code>
</p>

<p>
<code>TestPrediction = predict(mod2, newdata=Test, type="response")</code>
</p>

<p>
TestPredictionBinary = as.numeric(TestPrediction &gt; 0.5)~
</p>

<p>
<code>predictionDataFrame = data.frame(TestPrediction, TestPredictionBinary, Test$State)</code>
</p>

<p>
You can answer the two questions with the functions
<code>table(TestPredictionBinary)</code> and <code>mean(TestPrediction)</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Problem 2.2 - Coloring the States by Predictions (2 points possible)</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Now, we need to merge <code>predictionDataFrame</code> with the map data
<code>statesMap</code>, like we did in lecture. Before doing so, we need to
convert the <code>Test.State</code> variable to lowercase, so that it matches the
region variable in <code>statesMap</code>. Do this by typing the following in your
R console:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: convert the Test.State variable to lowercase..."</span>)
predictionDataFrame$region <span style="color: #db7093;">&lt;-</span> tolower(predictionDataFrame$Test.State)
</pre>
</div>

<pre class="example">
:: convert the Test.State variable to lowercase...
</pre>

<p>
Now, merge the two data frames using the following command:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Merging the two data frames..."</span>)
predictionMap <span style="color: #db7093;">&lt;-</span> merge(statesMap, predictionDataFrame, by = <span style="color: #ff6a6a;">"region"</span>)
</pre>
</div>

<pre class="example">
:: Merging the two data frames...
</pre>

<p>
Lastly, we need to make sure the observations are in order so that the
map is drawn properly, by typing the following:
</p>

<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Ordering the map data..."</span>)
predictionMap <span style="color: #db7093;">&lt;-</span> predictionMap[order(predictionMap$order),]
</pre>
</div>

<pre class="example">
:: Ordering the map data...
</pre>
</div>

<div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Question</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
How many observations are there in <code>predictionMap</code>?
</p>
</div>

<div id="outline-container-sec-1-4-1-1" class="outline-5">
<h5 id="sec-1-4-1-1"><span class="section-number-5">1.4.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-4-1-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Number of observations in the predition map:"</span>)
nrow(predictionMap)
</pre>
</div>

<pre class="example">
 :: Number of observations in the predition map:
[1] 15034
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> Question</h4>
<div class="outline-text-4" id="text-1-4-2">
<p>
How many observations are there in <code>statesMap</code>?
</p>
</div>

<div id="outline-container-sec-1-4-2-1" class="outline-5">
<h5 id="sec-1-4-2-1"><span class="section-number-5">1.4.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-4-2-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: Number of observations in the states map:"</span>)
nrow(statesMap)
</pre>
</div>

<pre class="example">
 :: Number of observations in the states map:
[1] 15537
</pre>

<p>
<b>Explanation</b>
</p>

<p>
If you type <code>str(predictionMap)</code>, you should see that there are \(15034\)
observations, and if you type <code>str(statesMap)</code> you should see that there
are \(15537\) observations.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Problem 2.3 - Coloring the States by Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-1-5">
<p>
When we merged the data in the previous problem, it caused the number
of observations to change. Why? Check out the help page for merge by
typing ?merge to help you answer this question.
</p>
</div>

<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-5-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Merging the data just combines the two data frames like it would
if we used rbind, so the number of observations increased.
</li>

<li><code>[&#xa0;]</code> We have more observations for each state now, because some
observations have the statesMap data, and some observations have the
prediction data.
</li>

<li><code>[X]</code> Because we only make predictions for 45 states, we no longer
have observations for some of the states. These observations were
removed in the merging process.
</li>

<li><code>[&#xa0;]</code> We merged the observations for which our predictions are
identical.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
When we merge data, it only merged the observations that exist in both
data sets. So since we are merging based on the region variable, we
will lose all observations that have a value of <code>region</code> that doesn't
exist in both data frames.
</p>

<p>
You can change this default behavior by using the <code>all.x</code> and <code>all.y</code>
arguments of the merge function. For more information, look at the
help page for the merge function by typing <code>?merge</code> in your R console.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Problem 2.4 - Coloring the States by Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Now we are ready to color the US map with our predictions! You can
color the states according to our binary predictions by typing the
following in your R console:
</p>


<div id="fig:USElectionsPredictions01" class="figure">
<p><img src="../graphs/USElectionsPredictions01.png" alt="USElectionsPredictions01.png" />
</p>
<p><span class="figure-number">Figure 3:</span> US Presidential predictions map v1</p>
</div>

<p>
The states appear light blue and dark blue in this map. Which color
represents a Republican prediction?
</p>
</div>

<div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-6-1">
<ul class="org-ul">
<li><code>[X]</code> Light blue
</li>
<li><code>[&#xa0;]</code> Dark blue
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
Our logistic regression model assigned \(1\) to <b>Republican</b> and \(0\) to
<b>Democrat</b>. As we can see from the legend, \(1\) corresponds to a <b>light
blue</b> color on the map and \(0\) corresponds to a <b>dark blue</b> color on
the map.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Problem 2.5 - Coloring the States by Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-1-7">
<p>
We see that the legend displays a <b>blue</b> gradient for outcomes between
\(0\) and \(1\). However, when plotting the binary predictions there are
only two possible outcomes: \(0\) or \(1\). Let's replot the map with
discrete outcomes. We can also change the color scheme to <b>blue</b> and
<b>red</b>, to match the <b>blue</b> color associated with the <b>Democratic
Party</b> in the US and the <b>red</b> color associated with the <b>Republican
Party</b> in the US. This can be done with the following command:
</p>


<div id="fig:USElectionsPredictions02" class="figure">
<p><img src="../graphs/USElectionsPredictions02.png" alt="USElectionsPredictions02.png" />
</p>
<p><span class="figure-number">Figure 4:</span> US presidential election map v2</p>
</div>


<p>
Alternatively, we could plot the probabilities instead of the binary
predictions. Change the <code>plot</code> command above to instead color the
states by the variable <code>TestPrediction</code>. You should see a gradient of
colors ranging from <b>red</b> to <b>blue</b>. Do the colors of the states in
the map for <code>TestPrediction</code> look different from the colors of the
states in the map with <code>TestPredictionBinary</code>? Why or why not?
</p>

<p>
NOTE: If you have a hard time seeing the red/blue gradient, feel free
to change the color scheme, by changing the arguments ~low = "blue"~ and
~high = "red"~ to colors of your choice (to see all of the color options
in R, type colors() in your R console). You can even change it to a
gray scale, by changing the low and high colors to <code>gray</code> and
<code>black</code>.
</p>


<div id="fig:USElectionsPredictions03" class="figure">
<p><img src="../graphs/USElectionsPredictions03.png" alt="USElectionsPredictions03.png" />
</p>
<p><span class="figure-number">Figure 5:</span> US Presidential Election map v3</p>
</div>
</div>

<div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-7-1">
<ul class="org-ul">
<li><code>[X]</code> The two maps look very similar. This is because most of our
predicted probabilities are close to 0 or close to 1. The two maps
look very similar. This is because most of our predicted
probabilities are close to 0 or close to 1. - correct
</li>

<li><code>[&#xa0;]</code> The two maps look very similar. This is because <code>TestPrediction</code>
  and TestPredictionBinary have the exact same values.
</li>

<li><code>[&#xa0;]</code> The two maps look very different. This is because we have
switched from plotting discrete values to plotting continuous
values.
</li>

<li><code>[&#xa0;]</code> The two maps look very different. This is because our predicted
probabilites have a wide range of values, and we were not sure about
many states.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
This plot can be generated by using the command:
</p>

<p>
<code>ggplot(predictionMap, aes(x = long, y = lat, group = group, fill =</code>
<code>TestPrediction)) + geom_polygon(color = "black") +</code>
<code>scale_fill_gradient(low = "blue", high = "red", name = "Prediction</code>
<code>2012")</code>
</p>

<p>
The only state that appears <b>purple</b> (the color between <b>red</b> and
<b>blue</b>) is the state of Iowa, so the maps look very similar. If you
take a look at <code>TestPrediction</code>, you can see that most of our
predicted probabilities are very close to \(0\) or very close to \(1\). In
fact, we don't have a single predicted probability between \(0.065\) and
\(0.93\).
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Problem 3.1 - Understanding the Predictions (1 point possible)</h3>
<div class="outline-text-3" id="text-1-8">
<p>
In the 2012 election, the state of <b>Florida</b> ended up being a very close
race. It was ultimately won by the <b>Democratic</b> party. Did we predict
this state correctly or incorrectly? To see the names and locations of
the different states, take a look at the World Atlas map here.
</p>
</div>

<div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-8-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> We correctly predicted that this state would be won by the
Democratic party.
</li>

<li><code>[X]</code> We incorrectly predicted this state by predicting that it would
be won by the Republican party.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
In our prediction map, the state of Florida is colored <b>red</b>, meaning
that we predicted Republican. So <b>we incorrectly predicted this
state</b>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Problem 3.2 - Understanding the Predictions (2 points possible)</h3>
<div class="outline-text-3" id="text-1-9">
</div><div id="outline-container-sec-1-9-1" class="outline-4">
<h4 id="sec-1-9-1"><span class="section-number-4">1.9.1</span> Question a</h4>
<div class="outline-text-4" id="text-1-9-1">
<p>
What was our predicted probability for the state of Florida?
</p>
</div>

<div id="outline-container-sec-1-9-1-1" class="outline-5">
<h5 id="sec-1-9-1-1"><span class="section-number-5">1.9.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-9-1-1">
<div class="org-src-container">

<pre class="src src-R">writeLines(<span style="color: #ff6a6a;">"\n :: The predicted probability for Florida:"</span>)
head(predictionMap[predictionMap$region == <span style="color: #ff6a6a;">"florida"</span>, ], 1)
</pre>
</div>

<pre class="example">
 :: The predicted probability for Florida:
      region      long      lat group order subregion TestPrediction
1150 florida -85.01548 30.99702     9  1462      &lt;NA&gt;      0.9640395
     TestPredictionBinary Test.State
1150                    1    Florida
</pre>

<p>
Predicted probability: \(0.9640395\)
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-2" class="outline-4">
<h4 id="sec-1-9-2"><span class="section-number-4">1.9.2</span> Question b</h4>
<div class="outline-text-4" id="text-1-9-2">
<p>
What does this imply?
</p>
</div>

<div id="outline-container-sec-1-9-2-1" class="outline-5">
<h5 id="sec-1-9-2-1"><span class="section-number-5">1.9.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-9-2-1">
<ul class="org-ul">
<li><code>[&#xa0;]</code> Our prediction model did a good job of correctly predicting the
state of Florida, and we were very confident in our prediction.
</li>

<li><code>[&#xa0;]</code> Our prediction model did a good job of correctly predicting the
state of Florida, but we were not very confident in the prediction.
</li>

<li><code>[&#xa0;]</code> Our prediction model did not do a very good job of correctly
predicting the state of Florida, but we were not very confident in
our prediction.
</li>

<li><code>[X]</code> Our prediction model did not do a very good job of correctly
predicting the state of Florida, and we were very confident in our
incorrect prediction.
</li>
</ul>

<p>
<b>Explanation</b>
</p>

<p>
We predicted Republican for the state of Florida with high
probability, meaning that we were very confident in our incorrect
prediction! Historically, Florida is usually a close race, but our
model doesn't know this. The model only uses polling results for the
particular year. For Florida in 2012, Survey USA predicted a tie, but
other polls predicted Republican, so our model predicted Republican.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Problem 4 - Parameter Settings</h3>
<div class="outline-text-3" id="text-1-10">
<p>
In this part, we'll explore what the different parameter settings of
<code>geom_polygon</code> do. Throughout the problem, use the help page for
<code>geom_polygon</code>, which can be accessed by ?geom_polygon. To see more
information about a certain parameter, just type a question mark and
then the parameter name to get the help page for that
parameter. Experiment with different parameter settings to try and
replicate the plots!
</p>

<p>
We'll be asking questions about the following three plots:
</p>

<p>
<b>Plot (1)</b>
</p>


<div class="figure">
<p><img src="../graphs/ElectionForecastingMap1.png" alt="ElectionForecastingMap1.png" />
</p>
</div>

<p>
<b>Plot (2)</b>
</p>


<div class="figure">
<p><img src="../graphs/ElectionForecastingMap2.png" alt="ElectionForecastingMap2.png" />
</p>
</div>

<p>
<b>Plot (3)</b>
</p>


<div class="figure">
<p><img src="../graphs/ElectionForecastingMap3.png" alt="ElectionForecastingMap3.png" />
</p>
</div>
</div>

<div id="outline-container-sec-1-10-1" class="outline-4">
<h4 id="sec-1-10-1"><span class="section-number-4">1.10.1</span> Answer</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
Recreating <b>plot (1)</b>
</p>


<div id="fig:RecreatingPlot01" class="figure">
<p><img src="../graphs/RecreatingPlot01.png" alt="RecreatingPlot01.png" />
</p>
<p><span class="figure-number">Figure 9:</span> Recreating plot 1</p>
</div>

<p>
Now we will recreate the <b>Plot (2)</b>
</p>


<div id="fig:RecreatingPlot02" class="figure">
<p><img src="../graphs/RecreatingPlot02.png" alt="RecreatingPlot02.png" />
</p>
<p><span class="figure-number">Figure 10:</span> Recreating the plot 2</p>
</div>

<p>
Now let recreate the <b>plot (3)</b>
</p>


<div id="fig:RecreatingPlot03" class="figure">
<p><img src="../graphs/RecreatingPlot03.png" alt="RecreatingPlot03.png" />
</p>
<p><span class="figure-number">Figure 11:</span> Recreating the plot 3</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> Problem 4.1 - Parameter Settings (2/2 points)</h3>
<div class="outline-text-3" id="text-1-11">
<p>
Plots (1) and (2) were created by setting different parameters of
geom_polygon to the value 3.
</p>
</div>

<div id="outline-container-sec-1-11-1" class="outline-4">
<h4 id="sec-1-11-1"><span class="section-number-4">1.11.1</span> Question</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
What is the name of the parameter we set to have value 3 to create
plot (1)?
</p>
</div>

<div id="outline-container-sec-1-11-1-1" class="outline-5">
<h5 id="sec-1-11-1-1"><span class="section-number-5">1.11.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-11-1-1">
<p>
<code>linetype</code>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-11-2" class="outline-4">
<h4 id="sec-1-11-2"><span class="section-number-4">1.11.2</span> Question</h4>
<div class="outline-text-4" id="text-1-11-2">
<p>
What is the name of the parameter we set to have value 3 to create
plot (2)?
</p>
</div>

<div id="outline-container-sec-1-11-2-1" class="outline-5">
<h5 id="sec-1-11-2-1"><span class="section-number-5">1.11.2.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-11-2-1">
<p>
<code>size</code>
</p>

<p>
<b>Explanation</b>
</p>

<p>
The first plot can be generated by setting the parameter <code>linetype=3</code>:
</p>

<p>
<code>ggplot(predictionMap, aes(x = long, y = lat, group = group, fill =</code>
<code>TestPrediction))+</code>
<code>geom_polygon(color = "black", linetype=3) +</code>
<code>scale_fill_gradient(low = "blue", high = "red", guide</code>
<code>= "legend", breaks = c(0,1), labels = c("Democrat", "Republican") , name</code>
<code>= "Prediction 2012")</code>
</p>

<p>
The second plot can be generated by setting the parameter <code>size = 3</code>:
</p>

<p>
<code>ggplot(predictionMap, aes(x = long, y = lat, group = group, fill =</code>
<code>TestPrediction))+ geom_polygon(color = "black", size=3) +</code>
<code>scale_fill_gradient(low = "blue", high = "red", guide</code>
<code>= "legend", breaks= c(0,1), labels = c("Democrat", "Republican"),name</code>
<code>= "Prediction 2012")</code>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> Problem 4.2 - Parameter Settings (1 point possible)</h3>
<div class="outline-text-3" id="text-1-12">
</div><div id="outline-container-sec-1-12-1" class="outline-4">
<h4 id="sec-1-12-1"><span class="section-number-4">1.12.1</span> Question</h4>
<div class="outline-text-4" id="text-1-12-1">
<p>
Plot (3) was created by changing the value of a different geom_polygon
parameter to have value 0.3. Which parameter did we use?
</p>
</div>

<div id="outline-container-sec-1-12-1-1" class="outline-5">
<h5 id="sec-1-12-1-1"><span class="section-number-5">1.12.1.1</span> Answer</h5>
<div class="outline-text-5" id="text-1-12-1-1">
<p>
<b>alpha</b>
</p>

<p>
<b>Explanation</b>
</p>

<p>
Plot (3) can be created by changing the alpha parameter:
</p>

<p>
<code>ggplot(predictionMap, aes(x = long, y = lat, group = group, fill =</code>
<code>TestPrediction))+ geom_polygon(color = "black", alpha=0.3) +</code>
<code>scale_fill_gradient(low = "blue", high = "red", guide</code>
<code>= "legend", breaks= c(0,1), labels = c("Democrat", "Republican"),name</code>
<code>= "Prediction 2012")</code>
</p>

<p>
The <code>alpha</code> parameter controls the transparency or darkness of the
color. A smaller value of alpha will make the colors lighter.
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 24/07/2015</p>
<p class="author">Author: Sergio-Feliciano Mendoza-Barrera</p>
<p class="date">Created: 2015-07-25 Sat 08:29</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
